var zy=Object.create;var Ba=Object.defineProperty;var Vy=Object.getOwnPropertyDescriptor;var Ky=Object.getOwnPropertyNames;var Yy=Object.getPrototypeOf,Xy=Object.prototype.hasOwnProperty;var X=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var Me=(r,e)=>()=>(r&&(e=r(r=0)),e);var J=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Tf=(r,e)=>{for(var t in e)Ba(r,t,{get:e[t],enumerable:!0})},Qy=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ky(e))!Xy.call(r,s)&&s!==t&&Ba(r,s,{get:()=>e[s],enumerable:!(n=Vy(e,s))||n.enumerable});return r};var zr=(r,e,t)=>(t=r!=null?zy(Yy(r)):{},Qy(e||!r||!r.__esModule?Ba(t,"default",{value:r,enumerable:!0}):t,r));var Rf=J((cw,ds)=>{ds.exports.Space_Separator=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/;ds.exports.ID_Start=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/;ds.exports.ID_Continue=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/});var Ia=J((lw,kf)=>{var Na=Rf();kf.exports={isSpaceSeparator(r){return typeof r=="string"&&Na.Space_Separator.test(r)},isIdStartChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="$"||r==="_"||Na.ID_Start.test(r))},isIdContinueChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r==="$"||r==="_"||r==="\u200C"||r==="\u200D"||Na.ID_Continue.test(r))},isDigit(r){return typeof r=="string"&&/[0-9]/.test(r)},isHexDigit(r){return typeof r=="string"&&/[0-9A-Fa-f]/.test(r)}}});var Bf=J((fw,xf)=>{var $e=Ia(),La,Ze,cr,ps,vr,xt,He,Ma,so;xf.exports=function(e,t){La=String(e),Ze="start",cr=[],ps=0,vr=1,xt=0,He=void 0,Ma=void 0,so=void 0;do He=Zy(),r0[Ze]();while(He.type!=="eof");return typeof t=="function"?Ua({"":so},"",t):so};function Ua(r,e,t){let n=r[e];if(n!=null&&typeof n=="object")if(Array.isArray(n))for(let s=0;s<n.length;s++){let a=String(s),u=Ua(n,a,t);u===void 0?delete n[a]:Object.defineProperty(n,a,{value:u,writable:!0,enumerable:!0,configurable:!0})}else for(let s in n){let a=Ua(n,s,t);a===void 0?delete n[s]:Object.defineProperty(n,s,{value:a,writable:!0,enumerable:!0,configurable:!0})}return t.call(r,e,n)}var me,le,oo,ur,be;function Zy(){for(me="default",le="",oo=!1,ur=1;;){be=lr();let r=Of[me]();if(r)return r}}function lr(){if(La[ps])return String.fromCodePoint(La.codePointAt(ps))}function $(){let r=lr();return r===`
`?(vr++,xt=0):r?xt+=r.length:xt++,r&&(ps+=r.length),r}var Of={default(){switch(be){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":$();return;case"/":$(),me="comment";return;case void 0:return $(),Oe("eof")}if($e.isSpaceSeparator(be)){$();return}return Of[Ze]()},comment(){switch(be){case"*":$(),me="multiLineComment";return;case"/":$(),me="singleLineComment";return}throw Pe($())},multiLineComment(){switch(be){case"*":$(),me="multiLineCommentAsterisk";return;case void 0:throw Pe($())}$()},multiLineCommentAsterisk(){switch(be){case"*":$();return;case"/":$(),me="default";return;case void 0:throw Pe($())}$(),me="multiLineComment"},singleLineComment(){switch(be){case`
`:case"\r":case"\u2028":case"\u2029":$(),me="default";return;case void 0:return $(),Oe("eof")}$()},value(){switch(be){case"{":case"[":return Oe("punctuator",$());case"n":return $(),Vr("ull"),Oe("null",null);case"t":return $(),Vr("rue"),Oe("boolean",!0);case"f":return $(),Vr("alse"),Oe("boolean",!1);case"-":case"+":$()==="-"&&(ur=-1),me="sign";return;case".":le=$(),me="decimalPointLeading";return;case"0":le=$(),me="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":le=$(),me="decimalInteger";return;case"I":return $(),Vr("nfinity"),Oe("numeric",1/0);case"N":return $(),Vr("aN"),Oe("numeric",NaN);case'"':case"'":oo=$()==='"',le="",me="string";return}throw Pe($())},identifierNameStartEscape(){if(be!=="u")throw Pe($());$();let r=qa();switch(r){case"$":case"_":break;default:if(!$e.isIdStartChar(r))throw Ff();break}le+=r,me="identifierName"},identifierName(){switch(be){case"$":case"_":case"\u200C":case"\u200D":le+=$();return;case"\\":$(),me="identifierNameEscape";return}if($e.isIdContinueChar(be)){le+=$();return}return Oe("identifier",le)},identifierNameEscape(){if(be!=="u")throw Pe($());$();let r=qa();switch(r){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!$e.isIdContinueChar(r))throw Ff();break}le+=r,me="identifierName"},sign(){switch(be){case".":le=$(),me="decimalPointLeading";return;case"0":le=$(),me="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":le=$(),me="decimalInteger";return;case"I":return $(),Vr("nfinity"),Oe("numeric",ur*(1/0));case"N":return $(),Vr("aN"),Oe("numeric",NaN)}throw Pe($())},zero(){switch(be){case".":le+=$(),me="decimalPoint";return;case"e":case"E":le+=$(),me="decimalExponent";return;case"x":case"X":le+=$(),me="hexadecimal";return}return Oe("numeric",ur*0)},decimalInteger(){switch(be){case".":le+=$(),me="decimalPoint";return;case"e":case"E":le+=$(),me="decimalExponent";return}if($e.isDigit(be)){le+=$();return}return Oe("numeric",ur*Number(le))},decimalPointLeading(){if($e.isDigit(be)){le+=$(),me="decimalFraction";return}throw Pe($())},decimalPoint(){switch(be){case"e":case"E":le+=$(),me="decimalExponent";return}if($e.isDigit(be)){le+=$(),me="decimalFraction";return}return Oe("numeric",ur*Number(le))},decimalFraction(){switch(be){case"e":case"E":le+=$(),me="decimalExponent";return}if($e.isDigit(be)){le+=$();return}return Oe("numeric",ur*Number(le))},decimalExponent(){switch(be){case"+":case"-":le+=$(),me="decimalExponentSign";return}if($e.isDigit(be)){le+=$(),me="decimalExponentInteger";return}throw Pe($())},decimalExponentSign(){if($e.isDigit(be)){le+=$(),me="decimalExponentInteger";return}throw Pe($())},decimalExponentInteger(){if($e.isDigit(be)){le+=$();return}return Oe("numeric",ur*Number(le))},hexadecimal(){if($e.isHexDigit(be)){le+=$(),me="hexadecimalInteger";return}throw Pe($())},hexadecimalInteger(){if($e.isHexDigit(be)){le+=$();return}return Oe("numeric",ur*Number(le))},string(){switch(be){case"\\":$(),le+=e0();return;case'"':if(oo)return $(),Oe("string",le);le+=$();return;case"'":if(!oo)return $(),Oe("string",le);le+=$();return;case`
`:case"\r":throw Pe($());case"\u2028":case"\u2029":n0(be);break;case void 0:throw Pe($())}le+=$()},start(){switch(be){case"{":case"[":return Oe("punctuator",$())}me="value"},beforePropertyName(){switch(be){case"$":case"_":le=$(),me="identifierName";return;case"\\":$(),me="identifierNameStartEscape";return;case"}":return Oe("punctuator",$());case'"':case"'":oo=$()==='"',me="string";return}if($e.isIdStartChar(be)){le+=$(),me="identifierName";return}throw Pe($())},afterPropertyName(){if(be===":")return Oe("punctuator",$());throw Pe($())},beforePropertyValue(){me="value"},afterPropertyValue(){switch(be){case",":case"}":return Oe("punctuator",$())}throw Pe($())},beforeArrayValue(){if(be==="]")return Oe("punctuator",$());me="value"},afterArrayValue(){switch(be){case",":case"]":return Oe("punctuator",$())}throw Pe($())},end(){throw Pe($())}};function Oe(r,e){return{type:r,value:e,line:vr,column:xt}}function Vr(r){for(let e of r){if(lr()!==e)throw Pe($());$()}}function e0(){switch(lr()){case"b":return $(),"\b";case"f":return $(),"\f";case"n":return $(),`
`;case"r":return $(),"\r";case"t":return $(),"	";case"v":return $(),"\v";case"0":if($(),$e.isDigit(lr()))throw Pe($());return"\0";case"x":return $(),t0();case"u":return $(),qa();case`
`:case"\u2028":case"\u2029":return $(),"";case"\r":return $(),lr()===`
`&&$(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw Pe($());case void 0:throw Pe($())}return $()}function t0(){let r="",e=lr();if(!$e.isHexDigit(e)||(r+=$(),e=lr(),!$e.isHexDigit(e)))throw Pe($());return r+=$(),String.fromCodePoint(parseInt(r,16))}function qa(){let r="",e=4;for(;e-- >0;){let t=lr();if(!$e.isHexDigit(t))throw Pe($());r+=$()}return String.fromCodePoint(parseInt(r,16))}var r0={start(){if(He.type==="eof")throw Kr();ja()},beforePropertyName(){switch(He.type){case"identifier":case"string":Ma=He.value,Ze="afterPropertyName";return;case"punctuator":hs();return;case"eof":throw Kr()}},afterPropertyName(){if(He.type==="eof")throw Kr();Ze="beforePropertyValue"},beforePropertyValue(){if(He.type==="eof")throw Kr();ja()},beforeArrayValue(){if(He.type==="eof")throw Kr();if(He.type==="punctuator"&&He.value==="]"){hs();return}ja()},afterPropertyValue(){if(He.type==="eof")throw Kr();switch(He.value){case",":Ze="beforePropertyName";return;case"}":hs()}},afterArrayValue(){if(He.type==="eof")throw Kr();switch(He.value){case",":Ze="beforeArrayValue";return;case"]":hs()}},end(){}};function ja(){let r;switch(He.type){case"punctuator":switch(He.value){case"{":r={};break;case"[":r=[];break}break;case"null":case"boolean":case"numeric":case"string":r=He.value;break}if(so===void 0)so=r;else{let e=cr[cr.length-1];Array.isArray(e)?e.push(r):Object.defineProperty(e,Ma,{value:r,writable:!0,enumerable:!0,configurable:!0})}if(r!==null&&typeof r=="object")cr.push(r),Array.isArray(r)?Ze="beforeArrayValue":Ze="beforePropertyName";else{let e=cr[cr.length-1];e==null?Ze="end":Array.isArray(e)?Ze="afterArrayValue":Ze="afterPropertyValue"}}function hs(){cr.pop();let r=cr[cr.length-1];r==null?Ze="end":Array.isArray(r)?Ze="afterArrayValue":Ze="afterPropertyValue"}function Pe(r){return ms(r===void 0?`JSON5: invalid end of input at ${vr}:${xt}`:`JSON5: invalid character '${Pf(r)}' at ${vr}:${xt}`)}function Kr(){return ms(`JSON5: invalid end of input at ${vr}:${xt}`)}function Ff(){return xt-=5,ms(`JSON5: invalid identifier character at ${vr}:${xt}`)}function n0(r){console.warn(`JSON5: '${Pf(r)}' in strings is not valid ECMAScript; consider escaping`)}function Pf(r){let e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[r])return e[r];if(r<" "){let t=r.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return r}function ms(r){let e=new SyntaxError(r);return e.lineNumber=vr,e.columnNumber=xt,e}});var If=J((dw,Nf)=>{var $a=Ia();Nf.exports=function(e,t,n){let s=[],a="",u,l,f="",h;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(n=t.space,h=t.quote,t=t.replacer),typeof t=="function")l=t;else if(Array.isArray(t)){u=[];for(let A of t){let g;typeof A=="string"?g=A:(typeof A=="number"||A instanceof String||A instanceof Number)&&(g=String(A)),g!==void 0&&u.indexOf(g)<0&&u.push(g)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),typeof n=="number"?n>0&&(n=Math.min(10,Math.floor(n)),f="          ".substr(0,n)):typeof n=="string"&&(f=n.substr(0,10)),d("",{"":e});function d(A,g){let b=g[A];switch(b!=null&&(typeof b.toJSON5=="function"?b=b.toJSON5(A):typeof b.toJSON=="function"&&(b=b.toJSON(A))),l&&(b=l.call(g,A,b)),b instanceof Number?b=Number(b):b instanceof String?b=String(b):b instanceof Boolean&&(b=b.valueOf()),b){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof b=="string")return _(b,!1);if(typeof b=="number")return String(b);if(typeof b=="object")return Array.isArray(b)?v(b):E(b)}function _(A){let g={"'":.1,'"':.2},b={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},R="";for(let I=0;I<A.length;I++){let L=A[I];switch(L){case"'":case'"':g[L]++,R+=L;continue;case"\0":if($a.isDigit(A[I+1])){R+="\\x00";continue}}if(b[L]){R+=b[L];continue}if(L<" "){let U=L.charCodeAt(0).toString(16);R+="\\x"+("00"+U).substring(U.length);continue}R+=L}let S=h||Object.keys(g).reduce((I,L)=>g[I]<g[L]?I:L);return R=R.replace(new RegExp(S,"g"),b[S]),S+R+S}function E(A){if(s.indexOf(A)>=0)throw TypeError("Converting circular structure to JSON5");s.push(A);let g=a;a=a+f;let b=u||Object.keys(A),R=[];for(let I of b){let L=d(I,A);if(L!==void 0){let U=P(I)+":";f!==""&&(U+=" "),U+=L,R.push(U)}}let S;if(R.length===0)S="{}";else{let I;if(f==="")I=R.join(","),S="{"+I+"}";else{let L=`,
`+a;I=R.join(L),S=`{
`+a+I+`,
`+g+"}"}}return s.pop(),a=g,S}function P(A){if(A.length===0)return _(A,!0);let g=String.fromCodePoint(A.codePointAt(0));if(!$a.isIdStartChar(g))return _(A,!0);for(let b=g.length;b<A.length;b++)if(!$a.isIdContinueChar(String.fromCodePoint(A.codePointAt(b))))return _(A,!0);return A}function v(A){if(s.indexOf(A)>=0)throw TypeError("Converting circular structure to JSON5");s.push(A);let g=a;a=a+f;let b=[];for(let S=0;S<A.length;S++){let I=d(String(S),A);b.push(I!==void 0?I:"null")}let R;if(b.length===0)R="[]";else if(f==="")R="["+b.join(",")+"]";else{let S=`,
`+a,I=b.join(S);R=`[
`+a+I+`,
`+g+"]"}return s.pop(),a=g,R}}});var Ha=J((hw,jf)=>{var o0=Bf(),s0=If(),i0={parse:o0,stringify:s0};jf.exports=i0});var Ja=J((Kw,rd)=>{"use strict";var vs=Object.prototype.hasOwnProperty,td=Object.prototype.toString,Kf=Object.defineProperty,Yf=Object.getOwnPropertyDescriptor,Xf=function(e){return typeof Array.isArray=="function"?Array.isArray(e):td.call(e)==="[object Array]"},Qf=function(e){if(!e||td.call(e)!=="[object Object]")return!1;var t=vs.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&vs.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var s;for(s in e);return typeof s>"u"||vs.call(e,s)},Zf=function(e,t){Kf&&t.name==="__proto__"?Kf(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},ed=function(e,t){if(t==="__proto__")if(vs.call(e,t)){if(Yf)return Yf(e,t).value}else return;return e[t]};rd.exports=function r(){var e,t,n,s,a,u,l=arguments[0],f=1,h=arguments.length,d=!1;for(typeof l=="boolean"&&(d=l,l=arguments[1]||{},f=2),(l==null||typeof l!="object"&&typeof l!="function")&&(l={});f<h;++f)if(e=arguments[f],e!=null)for(t in e)n=ed(l,t),s=ed(e,t),l!==s&&(d&&s&&(Qf(s)||(a=Xf(s)))?(a?(a=!1,u=n&&Xf(n)?n:[]):u=n&&Qf(n)?n:{},Zf(l,{name:t,newValue:r(d,u,s)})):typeof s<"u"&&Zf(l,{name:t,newValue:s}));return l}});var nd=J((Yw,w0)=>{w0.exports={name:"gaxios",version:"7.1.1",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:"googleapis/gaxios",keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^4.0.0","jsdoc-region-tag":"^3.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^3.0.0",puppeteer:"^24.0.0",sinon:"^20.0.0","stream-browserify":"^3.0.0",tmp:"0.2.3","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2"}}});var sd=J((Xw,od)=>{"use strict";var D0=nd();od.exports={pkg:D0}});var Ka=J(Et=>{"use strict";var ad=Et&&Et.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Et,"__esModule",{value:!0});Et.GaxiosError=Et.GAXIOS_ERROR_SYMBOL=void 0;Et.defaultErrorRedactor=ud;var id=ad(Ja()),S0=ad(sd()),za=S0.default.pkg;Et.GAXIOS_ERROR_SYMBOL=Symbol.for(`${za.name}-gaxios-error`);var Va=class r extends Error{config;response;code;status;error;[Et.GAXIOS_ERROR_SYMBOL]=za.version;static[Symbol.hasInstance](e){return e&&typeof e=="object"&&Et.GAXIOS_ERROR_SYMBOL in e&&e[Et.GAXIOS_ERROR_SYMBOL]===za.version?!0:Function.prototype[Symbol.hasInstance].call(r,e)}constructor(e,t,n,s){if(super(e,{cause:s}),this.config=t,this.response=n,this.error=s instanceof Error?s:void 0,this.config=(0,id.default)(!0,{},t),this.response&&(this.response.config=(0,id.default)(!0,{},this.response.config)),this.response){try{this.response.data=v0(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}s instanceof DOMException?this.code=s.name:s&&typeof s=="object"&&"code"in s&&(typeof s.code=="string"||typeof s.code=="number")&&(this.code=s.code)}static extractAPIErrorFromResponse(e,t="The request failed"){let n=t;if(typeof e.data=="string"&&(n=e.data),e.data&&typeof e.data=="object"&&"error"in e.data&&e.data.error&&!e.ok){if(typeof e.data.error=="string")return{message:e.data.error,code:e.status,status:e.statusText};if(typeof e.data.error=="object"){n="message"in e.data.error&&typeof e.data.error.message=="string"?e.data.error.message:n;let s="status"in e.data.error&&typeof e.data.error.status=="string"?e.data.error.status:e.statusText,a="code"in e.data.error&&typeof e.data.error.code=="number"?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let u=[];for(let l of e.data.error.errors)typeof l=="object"&&"message"in l&&typeof l.message=="string"&&u.push(l.message);return Object.assign({message:u.join(`
`)||n,code:a,status:s},e.data.error)}return Object.assign({message:n,code:a,status:s},e.data.error)}}return{message:n,code:e.status,status:e.statusText}}};Et.GaxiosError=Va;function v0(r,e){switch(r){case"stream":return e;case"json":return JSON.parse(JSON.stringify(e));case"arraybuffer":return JSON.parse(Buffer.from(e).toString("utf8"));case"blob":return JSON.parse(e.text());default:return e}}function ud(r){let e="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function t(a){a&&a.forEach((u,l)=>{(/^authentication$/i.test(l)||/^authorization$/i.test(l)||/secret/i.test(l))&&a.set(l,e)})}function n(a,u){if(typeof a=="object"&&a!==null&&typeof a[u]=="string"){let l=a[u];(/grant_type=/i.test(l)||/assertion=/i.test(l)||/secret/i.test(l))&&(a[u]=e)}}function s(a){!a||typeof a!="object"||(a instanceof FormData||a instanceof URLSearchParams||"forEach"in a&&"set"in a?a.forEach((u,l)=>{(["grant_type","assertion"].includes(l)||/secret/.test(l))&&a.set(l,e)}):("grant_type"in a&&(a.grant_type=e),"assertion"in a&&(a.assertion=e),"client_secret"in a&&(a.client_secret=e)))}return r.config&&(t(r.config.headers),n(r.config,"data"),s(r.config.data),n(r.config,"body"),s(r.config.body),r.config.url.searchParams.has("token")&&r.config.url.searchParams.set("token",e),r.config.url.searchParams.has("client_secret")&&r.config.url.searchParams.set("client_secret",e)),r.response&&(ud({config:r.response.config}),t(r.response.headers),r.response.bodyUsed&&(n(r.response,"data"),s(r.response.data))),r}});var ld=J(Ya=>{"use strict";Object.defineProperty(Ya,"__esModule",{value:!0});Ya.getRetryConfig=T0;async function T0(r){let e=cd(r);if(!r||!r.config||!e&&!r.config.retry)return{shouldRetry:!1};e=e||{},e.currentRetryAttempt=e.currentRetryAttempt||0,e.retry=e.retry===void 0||e.retry===null?3:e.retry,e.httpMethodsToRetry=e.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],e.noResponseRetries=e.noResponseRetries===void 0||e.noResponseRetries===null?2:e.noResponseRetries,e.retryDelayMultiplier=e.retryDelayMultiplier?e.retryDelayMultiplier:2,e.timeOfFirstRequest=e.timeOfFirstRequest?e.timeOfFirstRequest:Date.now(),e.totalTimeout=e.totalTimeout?e.totalTimeout:Number.MAX_SAFE_INTEGER,e.maxRetryDelay=e.maxRetryDelay?e.maxRetryDelay:Number.MAX_SAFE_INTEGER;let t=[[100,199],[408,408],[429,429],[500,599]];if(e.statusCodesToRetry=e.statusCodesToRetry||t,r.config.retryConfig=e,!await(e.shouldRetry||R0)(r))return{shouldRetry:!1,config:r.config};let s=k0(e);r.config.retryConfig.currentRetryAttempt+=1;let a=e.retryBackoff?e.retryBackoff(r,s):new Promise(u=>{setTimeout(u,s)});return e.onRetryAttempt&&await e.onRetryAttempt(r),await a,{shouldRetry:!0,config:r.config}}function R0(r){let e=cd(r);if(r.config.signal?.aborted&&r.code!=="TimeoutError"||r.code==="AbortError"||!e||e.retry===0||!r.response&&(e.currentRetryAttempt||0)>=e.noResponseRetries||!e.httpMethodsToRetry||!e.httpMethodsToRetry.includes(r.config.method?.toUpperCase()||"GET"))return!1;if(r.response&&r.response.status){let t=!1;for(let[n,s]of e.statusCodesToRetry){let a=r.response.status;if(a>=n&&a<=s){t=!0;break}}if(!t)return!1}return e.currentRetryAttempt=e.currentRetryAttempt||0,!(e.currentRetryAttempt>=e.retry)}function cd(r){if(r&&r.config&&r.config.retryConfig)return r.config.retryConfig}function k0(r){let t=(r.currentRetryAttempt?0:r.retryDelay??100)+(Math.pow(r.retryDelayMultiplier,r.currentRetryAttempt)-1)/2*1e3,n=r.totalTimeout-(Date.now()-r.timeOfFirstRequest);return Math.min(t,n,r.maxRetryDelay)}});var Qa=J(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});Ts.GaxiosInterceptorManager=void 0;var Xa=class extends Set{};Ts.GaxiosInterceptorManager=Xa});var dd=J((tD,fd)=>{var En=1e3,An=En*60,wn=An*60,Yr=wn*24,F0=Yr*7,O0=Yr*365.25;fd.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return P0(r);if(t==="number"&&isFinite(r))return e.long?B0(r):x0(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function P0(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*O0;case"weeks":case"week":case"w":return t*F0;case"days":case"day":case"d":return t*Yr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*wn;case"minutes":case"minute":case"mins":case"min":case"m":return t*An;case"seconds":case"second":case"secs":case"sec":case"s":return t*En;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function x0(r){var e=Math.abs(r);return e>=Yr?Math.round(r/Yr)+"d":e>=wn?Math.round(r/wn)+"h":e>=An?Math.round(r/An)+"m":e>=En?Math.round(r/En)+"s":r+"ms"}function B0(r){var e=Math.abs(r);return e>=Yr?Rs(r,e,Yr,"day"):e>=wn?Rs(r,e,wn,"hour"):e>=An?Rs(r,e,An,"minute"):e>=En?Rs(r,e,En,"second"):r+" ms"}function Rs(r,e,t,n){var s=e>=t*1.5;return Math.round(r/t)+" "+n+(s?"s":"")}});var Za=J((rD,hd)=>{function N0(r){t.debug=t,t.default=t,t.coerce=f,t.disable=u,t.enable=s,t.enabled=l,t.humanize=dd(),t.destroy=h,Object.keys(r).forEach(d=>{t[d]=r[d]}),t.names=[],t.skips=[],t.formatters={};function e(d){let _=0;for(let E=0;E<d.length;E++)_=(_<<5)-_+d.charCodeAt(E),_|=0;return t.colors[Math.abs(_)%t.colors.length]}t.selectColor=e;function t(d){let _,E=null,P,v;function A(...g){if(!A.enabled)return;let b=A,R=Number(new Date),S=R-(_||R);b.diff=S,b.prev=_,b.curr=R,_=R,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let I=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(U,H)=>{if(U==="%%")return"%";I++;let K=t.formatters[H];if(typeof K=="function"){let W=g[I];U=K.call(b,W),g.splice(I,1),I--}return U}),t.formatArgs.call(b,g),(b.log||t.log).apply(b,g)}return A.namespace=d,A.useColors=t.useColors(),A.color=t.selectColor(d),A.extend=n,A.destroy=t.destroy,Object.defineProperty(A,"enabled",{enumerable:!0,configurable:!1,get:()=>E!==null?E:(P!==t.namespaces&&(P=t.namespaces,v=t.enabled(d)),v),set:g=>{E=g}}),typeof t.init=="function"&&t.init(A),A}function n(d,_){let E=t(this.namespace+(typeof _>"u"?":":_)+d);return E.log=this.log,E}function s(d){t.save(d),t.namespaces=d,t.names=[],t.skips=[];let _=(typeof d=="string"?d:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let E of _)E[0]==="-"?t.skips.push(E.slice(1)):t.names.push(E)}function a(d,_){let E=0,P=0,v=-1,A=0;for(;E<d.length;)if(P<_.length&&(_[P]===d[E]||_[P]==="*"))_[P]==="*"?(v=P,A=E,P++):(E++,P++);else if(v!==-1)P=v+1,A++,E=A;else return!1;for(;P<_.length&&_[P]==="*";)P++;return P===_.length}function u(){let d=[...t.names,...t.skips.map(_=>"-"+_)].join(",");return t.enable(""),d}function l(d){for(let _ of t.skips)if(a(d,_))return!1;for(let _ of t.names)if(a(d,_))return!0;return!1}function f(d){return d instanceof Error?d.stack||d.message:d}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}hd.exports=N0});var pd=J((ot,ks)=>{ot.formatArgs=j0;ot.save=L0;ot.load=U0;ot.useColors=I0;ot.storage=q0();ot.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ot.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function I0(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function j0(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+ks.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(n=t))}),r.splice(n,0,e)}ot.log=console.debug||console.log||(()=>{});function L0(r){try{r?ot.storage.setItem("debug",r):ot.storage.removeItem("debug")}catch{}}function U0(){let r;try{r=ot.storage.getItem("debug")||ot.storage.getItem("DEBUG")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function q0(){try{return localStorage}catch{}}ks.exports=Za()(ot);var{formatters:M0}=ks.exports;M0.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var gd=J((nD,md)=>{"use strict";md.exports=(r,e=process.argv)=>{let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),s=e.indexOf("--");return n!==-1&&(s===-1||n<s)}});var bd=J((oD,_d)=>{"use strict";var $0=X("os"),yd=X("tty"),At=gd(),{env:Ge}=process,Rr;At("no-color")||At("no-colors")||At("color=false")||At("color=never")?Rr=0:(At("color")||At("colors")||At("color=true")||At("color=always"))&&(Rr=1);"FORCE_COLOR"in Ge&&(Ge.FORCE_COLOR==="true"?Rr=1:Ge.FORCE_COLOR==="false"?Rr=0:Rr=Ge.FORCE_COLOR.length===0?1:Math.min(parseInt(Ge.FORCE_COLOR,10),3));function eu(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function tu(r,e){if(Rr===0)return 0;if(At("color=16m")||At("color=full")||At("color=truecolor"))return 3;if(At("color=256"))return 2;if(r&&!e&&Rr===void 0)return 0;let t=Rr||0;if(Ge.TERM==="dumb")return t;if(process.platform==="win32"){let n=$0.release().split(".");return Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in Ge)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(n=>n in Ge)||Ge.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in Ge)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ge.TEAMCITY_VERSION)?1:0;if(Ge.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Ge){let n=parseInt((Ge.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ge.TERM_PROGRAM){case"iTerm.app":return n>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ge.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Ge.TERM)||"COLORTERM"in Ge?1:t}function H0(r){let e=tu(r,r&&r.isTTY);return eu(e)}_d.exports={supportsColor:H0,stdout:eu(tu(!0,yd.isatty(1))),stderr:eu(tu(!0,yd.isatty(2)))}});var Ed=J((We,Os)=>{var G0=X("tty"),Fs=X("util");We.init=X0;We.log=V0;We.formatArgs=J0;We.save=K0;We.load=Y0;We.useColors=W0;We.destroy=Fs.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");We.colors=[6,2,3,4,5,1];try{let r=bd();r&&(r.stderr||r).level>=2&&(We.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}We.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(s,a)=>a.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function W0(){return"colors"in We.inspectOpts?!!We.inspectOpts.colors:G0.isatty(process.stderr.fd)}function J0(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,s="\x1B[3"+(n<8?n:"8;5;"+n),a=`  ${s};1m${e} \x1B[0m`;r[0]=a+r[0].split(`
`).join(`
`+a),r.push(s+"m+"+Os.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=z0()+e+" "+r[0]}function z0(){return We.inspectOpts.hideDate?"":new Date().toISOString()+" "}function V0(...r){return process.stderr.write(Fs.formatWithOptions(We.inspectOpts,...r)+`
`)}function K0(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Y0(){return process.env.DEBUG}function X0(r){r.inspectOpts={};let e=Object.keys(We.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=We.inspectOpts[e[t]]}Os.exports=Za()(We);var{formatters:Cd}=Os.exports;Cd.o=function(r){return this.inspectOpts.colors=this.useColors,Fs.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Cd.O=function(r){return this.inspectOpts.colors=this.useColors,Fs.inspect(r,this.inspectOpts)}});var nu=J((sD,ru)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?ru.exports=pd():ru.exports=Ed()});var Dd=J(st=>{"use strict";var Q0=st&&st.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),Z0=st&&st.__setModuleDefault||(Object.create?(function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}):function(r,e){r.default=e}),Ad=st&&st.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Q0(e,r,t);return Z0(e,r),e};Object.defineProperty(st,"__esModule",{value:!0});st.req=st.json=st.toBuffer=void 0;var e_=Ad(X("http")),t_=Ad(X("https"));async function wd(r){let e=0,t=[];for await(let n of r)e+=n.length,t.push(n);return Buffer.concat(t,e)}st.toBuffer=wd;async function r_(r){let t=(await wd(r)).toString("utf8");try{return JSON.parse(t)}catch(n){let s=n;throw s.message+=` (input: ${t})`,s}}st.json=r_;function n_(r,e={}){let n=((typeof r=="string"?r:r.href).startsWith("https:")?t_:e_).request(r,e),s=new Promise((a,u)=>{n.once("response",a).once("error",u).end()});return n.then=s.then.bind(s),n}st.req=n_});var Rd=J(lt=>{"use strict";var vd=lt&&lt.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),o_=lt&&lt.__setModuleDefault||(Object.create?(function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}):function(r,e){r.default=e}),Td=lt&&lt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&vd(e,r,t);return o_(e,r),e},s_=lt&&lt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&vd(e,r,t)};Object.defineProperty(lt,"__esModule",{value:!0});lt.Agent=void 0;var i_=Td(X("net")),Sd=Td(X("http")),a_=X("https");s_(Dd(),lt);var Gt=Symbol("AgentBaseInternalState"),ou=class extends Sd.Agent{constructor(e){super(e),this[Gt]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:t}=new Error;return typeof t!="string"?!1:t.split(`
`).some(n=>n.indexOf("(https.js:")!==-1||n.indexOf("node:https:")!==-1)}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new i_.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||t===null)return;let n=this.sockets[e],s=n.indexOf(t);s!==-1&&(n.splice(s,1),this.totalSocketCount--,n.length===0&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?a_.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,n){let s={...t,secureEndpoint:this.isSecureEndpoint(t)},a=this.getName(s),u=this.incrementSockets(a);Promise.resolve().then(()=>this.connect(e,s)).then(l=>{if(this.decrementSockets(a,u),l instanceof Sd.Agent)try{return l.addRequest(e,s)}catch(f){return n(f)}this[Gt].currentSocket=l,super.createSocket(e,t,n)},l=>{this.decrementSockets(a,u),n(l)})}createConnection(){let e=this[Gt].currentSocket;if(this[Gt].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){return this[Gt].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(e){this[Gt]&&(this[Gt].defaultPort=e)}get protocol(){return this[Gt].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(e){this[Gt]&&(this[Gt].protocol=e)}};lt.Agent=ou});var kd=J(Dn=>{"use strict";var u_=Dn&&Dn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Dn,"__esModule",{value:!0});Dn.parseProxyResponse=void 0;var c_=u_(nu()),Ps=(0,c_.default)("https-proxy-agent:parse-proxy-response");function l_(r){return new Promise((e,t)=>{let n=0,s=[];function a(){let d=r.read();d?h(d):r.once("readable",a)}function u(){r.removeListener("end",l),r.removeListener("error",f),r.removeListener("readable",a)}function l(){u(),Ps("onend"),t(new Error("Proxy connection ended before receiving CONNECT response"))}function f(d){u(),Ps("onerror %o",d),t(d)}function h(d){s.push(d),n+=d.length;let _=Buffer.concat(s,n),E=_.indexOf(`\r
\r
`);if(E===-1){Ps("have not received end of HTTP headers yet..."),a();return}let P=_.slice(0,E).toString("ascii").split(`\r
`),v=P.shift();if(!v)return r.destroy(),t(new Error("No header received from proxy CONNECT response"));let A=v.split(" "),g=+A[1],b=A.slice(2).join(" "),R={};for(let S of P){if(!S)continue;let I=S.indexOf(":");if(I===-1)return r.destroy(),t(new Error(`Invalid header from proxy CONNECT response: "${S}"`));let L=S.slice(0,I).toLowerCase(),U=S.slice(I+1).trimStart(),H=R[L];typeof H=="string"?R[L]=[H,U]:Array.isArray(H)?H.push(U):R[L]=U}Ps("got proxy server response: %o %o",v,R),u(),e({connect:{statusCode:g,statusText:b,headers:R},buffered:_})}r.on("error",f),r.on("end",l),a()})}Dn.parseProxyResponse=l_});var Nd=J(wt=>{"use strict";var f_=wt&&wt.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),d_=wt&&wt.__setModuleDefault||(Object.create?(function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}):function(r,e){r.default=e}),xd=wt&&wt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&f_(e,r,t);return d_(e,r),e},Bd=wt&&wt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(wt,"__esModule",{value:!0});wt.HttpsProxyAgent=void 0;var xs=xd(X("net")),Fd=xd(X("tls")),h_=Bd(X("assert")),p_=Bd(nu()),m_=Rd(),g_=X("url"),y_=kd(),ao=(0,p_.default)("https-proxy-agent"),Od=r=>r.servername===void 0&&r.host&&!xs.isIP(r.host)?{...r,servername:r.host}:r,Bs=class extends m_.Agent{constructor(e,t){super(t),this.options={path:void 0},this.proxy=typeof e=="string"?new g_.URL(e):e,this.proxyHeaders=t?.headers??{},ao("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),s=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?Pd(t,"headers"):null,host:n,port:s}}async connect(e,t){let{proxy:n}=this;if(!t.host)throw new TypeError('No "host" provided');let s;n.protocol==="https:"?(ao("Creating `tls.Socket`: %o",this.connectOpts),s=Fd.connect(Od(this.connectOpts))):(ao("Creating `net.Socket`: %o",this.connectOpts),s=xs.connect(this.connectOpts));let a=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},u=xs.isIPv6(t.host)?`[${t.host}]`:t.host,l=`CONNECT ${u}:${t.port} HTTP/1.1\r
`;if(n.username||n.password){let E=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;a["Proxy-Authorization"]=`Basic ${Buffer.from(E).toString("base64")}`}a.Host=`${u}:${t.port}`,a["Proxy-Connection"]||(a["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let E of Object.keys(a))l+=`${E}: ${a[E]}\r
`;let f=(0,y_.parseProxyResponse)(s);s.write(`${l}\r
`);let{connect:h,buffered:d}=await f;if(e.emit("proxyConnect",h),this.emit("proxyConnect",h,e),h.statusCode===200)return e.once("socket",__),t.secureEndpoint?(ao("Upgrading socket connection to TLS"),Fd.connect({...Pd(Od(t),"host","path","port"),socket:s})):s;s.destroy();let _=new xs.Socket({writable:!1});return _.readable=!0,e.once("socket",E=>{ao("Replaying proxy buffer for failed request"),(0,h_.default)(E.listenerCount("data")>0),E.push(d),E.push(null)}),_}};Bs.protocols=["http","https"];wt.HttpsProxyAgent=Bs;function __(r){r.resume()}function Pd(r,...e){let t={},n;for(n in r)e.includes(n)||(t[n]=r[n]);return t}});function b_(r){if(!/^data:/i.test(r))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');r=r.replace(/\r?\n/g,"");let e=r.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=r.substring(5,e).split(";"),n="",s=!1,a=t[0]||"text/plain",u=a;for(let d=1;d<t.length;d++)t[d]==="base64"?s=!0:t[d]&&(u+=`;${t[d]}`,t[d].indexOf("charset=")===0&&(n=t[d].substring(8)));!t[0]&&!n.length&&(u+=";charset=US-ASCII",n="US-ASCII");let l=s?"base64":"ascii",f=unescape(r.substring(e+1)),h=Buffer.from(f,l);return h.type=a,h.typeFull=u,h.charset=n,h}var Id,jd=Me(()=>{Id=b_});var Ud=J((Ns,Ld)=>{(function(r,e){typeof Ns=="object"&&typeof Ld<"u"?e(Ns):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.WebStreamsPolyfill={}))})(Ns,(function(r){"use strict";function e(){}function t(o){return typeof o=="object"&&o!==null||typeof o=="function"}let n=e;function s(o,i){try{Object.defineProperty(o,"name",{value:i,configurable:!0})}catch{}}let a=Promise,u=Promise.prototype.then,l=Promise.reject.bind(a);function f(o){return new a(o)}function h(o){return f(i=>i(o))}function d(o){return l(o)}function _(o,i,c){return u.call(o,i,c)}function E(o,i,c){_(_(o,i,c),void 0,n)}function P(o,i){E(o,i)}function v(o,i){E(o,void 0,i)}function A(o,i,c){return _(o,i,c)}function g(o){_(o,void 0,n)}let b=o=>{if(typeof queueMicrotask=="function")b=queueMicrotask;else{let i=h(void 0);b=c=>_(i,c)}return b(o)};function R(o,i,c){if(typeof o!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(o,i,c)}function S(o,i,c){try{return h(R(o,i,c))}catch(m){return d(m)}}let I=16384;class L{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(i){let c=this._back,m=c;c._elements.length===I-1&&(m={_elements:[],_next:void 0}),c._elements.push(i),m!==c&&(this._back=m,c._next=m),++this._size}shift(){let i=this._front,c=i,m=this._cursor,w=m+1,N=i._elements,q=N[m];return w===I&&(c=i._next,w=0),--this._size,this._cursor=w,i!==c&&(this._front=c),N[m]=void 0,q}forEach(i){let c=this._cursor,m=this._front,w=m._elements;for(;(c!==w.length||m._next!==void 0)&&!(c===w.length&&(m=m._next,w=m._elements,c=0,w.length===0));)i(w[c]),++c}peek(){let i=this._front,c=this._cursor;return i._elements[c]}}let U=Symbol("[[AbortSteps]]"),H=Symbol("[[ErrorSteps]]"),K=Symbol("[[CancelSteps]]"),W=Symbol("[[PullSteps]]"),we=Symbol("[[ReleaseSteps]]");function he(o,i){o._ownerReadableStream=i,i._reader=o,i._state==="readable"?de(o):i._state==="closed"?ue(o):Z(o,i._storedError)}function fe(o,i){let c=o._ownerReadableStream;return Ot(c,i)}function ye(o){let i=o._ownerReadableStream;i._state==="readable"?z(o,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):oe(o,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),i._readableStreamController[we](),i._reader=void 0,o._ownerReadableStream=void 0}function re(o){return new TypeError("Cannot "+o+" a stream using a released reader")}function de(o){o._closedPromise=f((i,c)=>{o._closedPromise_resolve=i,o._closedPromise_reject=c})}function Z(o,i){de(o),z(o,i)}function ue(o){de(o),se(o)}function z(o,i){o._closedPromise_reject!==void 0&&(g(o._closedPromise),o._closedPromise_reject(i),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0)}function oe(o,i){Z(o,i)}function se(o){o._closedPromise_resolve!==void 0&&(o._closedPromise_resolve(void 0),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0)}let Ne=Number.isFinite||function(o){return typeof o=="number"&&isFinite(o)},Le=Math.trunc||function(o){return o<0?Math.ceil(o):Math.floor(o)};function G(o){return typeof o=="object"||typeof o=="function"}function pe(o,i){if(o!==void 0&&!G(o))throw new TypeError(`${i} is not an object.`)}function Ee(o,i){if(typeof o!="function")throw new TypeError(`${i} is not a function.`)}function er(o){return typeof o=="object"&&o!==null||typeof o=="function"}function xe(o,i){if(!er(o))throw new TypeError(`${i} is not an object.`)}function Ie(o,i,c){if(o===void 0)throw new TypeError(`Parameter ${i} is required in '${c}'.`)}function p(o,i,c){if(o===void 0)throw new TypeError(`${i} is required in '${c}'.`)}function y(o){return Number(o)}function C(o){return o===0?0:o}function x(o){return C(Le(o))}function T(o,i){let m=Number.MAX_SAFE_INTEGER,w=Number(o);if(w=C(w),!Ne(w))throw new TypeError(`${i} is not a finite number`);if(w=x(w),w<0||w>m)throw new TypeError(`${i} is outside the accepted range of 0 to ${m}, inclusive`);return!Ne(w)||w===0?0:w}function F(o,i){if(!Ar(o))throw new TypeError(`${i} is not a ReadableStream.`)}function j(o){return new M(o)}function D(o,i){o._reader._readRequests.push(i)}function k(o,i,c){let w=o._reader._readRequests.shift();c?w._closeSteps():w._chunkSteps(i)}function B(o){return o._reader._readRequests.length}function O(o){let i=o._reader;return!(i===void 0||!Y(i))}class M{constructor(i){if(Ie(i,1,"ReadableStreamDefaultReader"),F(i,"First parameter"),wr(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");he(this,i),this._readRequests=new L}get closed(){return Y(this)?this._closedPromise:d(Be("closed"))}cancel(i=void 0){return Y(this)?this._ownerReadableStream===void 0?d(re("cancel")):fe(this,i):d(Be("cancel"))}read(){if(!Y(this))return d(Be("read"));if(this._ownerReadableStream===void 0)return d(re("read from"));let i,c,m=f((N,q)=>{i=N,c=q});return Q(this,{_chunkSteps:N=>i({value:N,done:!1}),_closeSteps:()=>i({value:void 0,done:!0}),_errorSteps:N=>c(N)}),m}releaseLock(){if(!Y(this))throw Be("releaseLock");this._ownerReadableStream!==void 0&&Ae(this)}}Object.defineProperties(M.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(M.prototype.cancel,"cancel"),s(M.prototype.read,"read"),s(M.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(M.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Y(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readRequests")?!1:o instanceof M}function Q(o,i){let c=o._ownerReadableStream;c._disturbed=!0,c._state==="closed"?i._closeSteps():c._state==="errored"?i._errorSteps(c._storedError):c._readableStreamController[W](i)}function Ae(o){ye(o);let i=new TypeError("Reader was released");Fe(o,i)}function Fe(o,i){let c=o._readRequests;o._readRequests=new L,c.forEach(m=>{m._errorSteps(i)})}function Be(o){return new TypeError(`ReadableStreamDefaultReader.prototype.${o} can only be used on a ReadableStreamDefaultReader`)}let Ce=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class De{constructor(i,c){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=i,this._preventCancel=c}next(){let i=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?A(this._ongoingPromise,i,i):i(),this._ongoingPromise}return(i){let c=()=>this._returnSteps(i);return this._ongoingPromise?A(this._ongoingPromise,c,c):c()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let i=this._reader,c,m,w=f((q,V)=>{c=q,m=V});return Q(i,{_chunkSteps:q=>{this._ongoingPromise=void 0,b(()=>c({value:q,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,ye(i),c({value:void 0,done:!0})},_errorSteps:q=>{this._ongoingPromise=void 0,this._isFinished=!0,ye(i),m(q)}}),w}_returnSteps(i){if(this._isFinished)return Promise.resolve({value:i,done:!0});this._isFinished=!0;let c=this._reader;if(!this._preventCancel){let m=fe(c,i);return ye(c),A(m,()=>({value:i,done:!0}))}return ye(c),h({value:i,done:!0})}}let Ue={next(){return an(this)?this._asyncIteratorImpl.next():d(un("next"))},return(o){return an(this)?this._asyncIteratorImpl.return(o):d(un("return"))}};Object.setPrototypeOf(Ue,Ce);function sn(o,i){let c=j(o),m=new De(c,i),w=Object.create(Ue);return w._asyncIteratorImpl=m,w}function an(o){if(!t(o)||!Object.prototype.hasOwnProperty.call(o,"_asyncIteratorImpl"))return!1;try{return o._asyncIteratorImpl instanceof De}catch{return!1}}function un(o){return new TypeError(`ReadableStreamAsyncIterator.${o} can only be used on a ReadableSteamAsyncIterator`)}let ut=Number.isNaN||function(o){return o!==o};var tr,Ke,qe;function Se(o){return o.slice()}function Dl(o,i,c,m,w){new Uint8Array(o).set(new Uint8Array(c,m,w),i)}let rr=o=>(typeof o.transfer=="function"?rr=i=>i.transfer():typeof structuredClone=="function"?rr=i=>structuredClone(i,{transfer:[i]}):rr=i=>i,rr(o)),_r=o=>(typeof o.detached=="boolean"?_r=i=>i.detached:_r=i=>i.byteLength===0,_r(o));function Sl(o,i,c){if(o.slice)return o.slice(i,c);let m=c-i,w=new ArrayBuffer(m);return Dl(w,0,o,i,m),w}function Lo(o,i){let c=o[i];if(c!=null){if(typeof c!="function")throw new TypeError(`${String(i)} is not a function`);return c}}function dg(o){let i={[Symbol.iterator]:()=>o.iterator},c=(async function*(){return yield*i})(),m=c.next;return{iterator:c,nextMethod:m,done:!1}}let aa=(qe=(tr=Symbol.asyncIterator)!==null&&tr!==void 0?tr:(Ke=Symbol.for)===null||Ke===void 0?void 0:Ke.call(Symbol,"Symbol.asyncIterator"))!==null&&qe!==void 0?qe:"@@asyncIterator";function vl(o,i="sync",c){if(c===void 0)if(i==="async"){if(c=Lo(o,aa),c===void 0){let N=Lo(o,Symbol.iterator),q=vl(o,"sync",N);return dg(q)}}else c=Lo(o,Symbol.iterator);if(c===void 0)throw new TypeError("The object is not iterable");let m=R(c,o,[]);if(!t(m))throw new TypeError("The iterator method must return an object");let w=m.next;return{iterator:m,nextMethod:w,done:!1}}function hg(o){let i=R(o.nextMethod,o.iterator,[]);if(!t(i))throw new TypeError("The iterator.next() method must return an object");return i}function pg(o){return!!o.done}function mg(o){return o.value}function gg(o){return!(typeof o!="number"||ut(o)||o<0)}function Tl(o){let i=Sl(o.buffer,o.byteOffset,o.byteOffset+o.byteLength);return new Uint8Array(i)}function ua(o){let i=o._queue.shift();return o._queueTotalSize-=i.size,o._queueTotalSize<0&&(o._queueTotalSize=0),i.value}function ca(o,i,c){if(!gg(c)||c===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");o._queue.push({value:i,size:c}),o._queueTotalSize+=c}function yg(o){return o._queue.peek().value}function br(o){o._queue=new L,o._queueTotalSize=0}function Rl(o){return o===DataView}function _g(o){return Rl(o.constructor)}function bg(o){return Rl(o)?1:o.BYTES_PER_ELEMENT}class Ur{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!la(this))throw ma("view");return this._view}respond(i){if(!la(this))throw ma("respond");if(Ie(i,1,"respond"),i=T(i,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(_r(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");$o(this._associatedReadableByteStreamController,i)}respondWithNewView(i){if(!la(this))throw ma("respondWithNewView");if(Ie(i,1,"respondWithNewView"),!ArrayBuffer.isView(i))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(_r(i.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Ho(this._associatedReadableByteStreamController,i)}}Object.defineProperties(Ur.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),s(Ur.prototype.respond,"respond"),s(Ur.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ur.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class nr{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!qr(this))throw Xn("byobRequest");return pa(this)}get desiredSize(){if(!qr(this))throw Xn("desiredSize");return Ll(this)}close(){if(!qr(this))throw Xn("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be closed`);Yn(this)}enqueue(i){if(!qr(this))throw Xn("enqueue");if(Ie(i,1,"enqueue"),!ArrayBuffer.isView(i))throw new TypeError("chunk must be an array buffer view");if(i.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(i.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let c=this._controlledReadableByteStream._state;if(c!=="readable")throw new TypeError(`The stream (in ${c} state) is not in the readable state and cannot be enqueued to`);Mo(this,i)}error(i=void 0){if(!qr(this))throw Xn("error");bt(this,i)}[K](i){kl(this),br(this);let c=this._cancelAlgorithm(i);return qo(this),c}[W](i){let c=this._controlledReadableByteStream;if(this._queueTotalSize>0){jl(this,i);return}let m=this._autoAllocateChunkSize;if(m!==void 0){let w;try{w=new ArrayBuffer(m)}catch(q){i._errorSteps(q);return}let N={buffer:w,bufferByteLength:m,byteOffset:0,byteLength:m,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(N)}D(c,i),Mr(this)}[we](){if(this._pendingPullIntos.length>0){let i=this._pendingPullIntos.peek();i.readerType="none",this._pendingPullIntos=new L,this._pendingPullIntos.push(i)}}}Object.defineProperties(nr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),s(nr.prototype.close,"close"),s(nr.prototype.enqueue,"enqueue"),s(nr.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(nr.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function qr(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledReadableByteStream")?!1:o instanceof nr}function la(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_associatedReadableByteStreamController")?!1:o instanceof Ur}function Mr(o){if(!Dg(o))return;if(o._pulling){o._pullAgain=!0;return}o._pulling=!0;let c=o._pullAlgorithm();E(c,()=>(o._pulling=!1,o._pullAgain&&(o._pullAgain=!1,Mr(o)),null),m=>(bt(o,m),null))}function kl(o){da(o),o._pendingPullIntos=new L}function fa(o,i){let c=!1;o._state==="closed"&&(c=!0);let m=Fl(i);i.readerType==="default"?k(o,m,c):Fg(o,m,c)}function Fl(o){let i=o.bytesFilled,c=o.elementSize;return new o.viewConstructor(o.buffer,o.byteOffset,i/c)}function Uo(o,i,c,m){o._queue.push({buffer:i,byteOffset:c,byteLength:m}),o._queueTotalSize+=m}function Ol(o,i,c,m){let w;try{w=Sl(i,c,c+m)}catch(N){throw bt(o,N),N}Uo(o,w,0,m)}function Pl(o,i){i.bytesFilled>0&&Ol(o,i.buffer,i.byteOffset,i.bytesFilled),cn(o)}function xl(o,i){let c=Math.min(o._queueTotalSize,i.byteLength-i.bytesFilled),m=i.bytesFilled+c,w=c,N=!1,q=m%i.elementSize,V=m-q;V>=i.minimumFill&&(w=V-i.bytesFilled,N=!0);let ae=o._queue;for(;w>0;){let te=ae.peek(),ce=Math.min(w,te.byteLength),ge=i.byteOffset+i.bytesFilled;Dl(i.buffer,ge,te.buffer,te.byteOffset,ce),te.byteLength===ce?ae.shift():(te.byteOffset+=ce,te.byteLength-=ce),o._queueTotalSize-=ce,Bl(o,ce,i),w-=ce}return N}function Bl(o,i,c){c.bytesFilled+=i}function Nl(o){o._queueTotalSize===0&&o._closeRequested?(qo(o),no(o._controlledReadableByteStream)):Mr(o)}function da(o){o._byobRequest!==null&&(o._byobRequest._associatedReadableByteStreamController=void 0,o._byobRequest._view=null,o._byobRequest=null)}function ha(o){for(;o._pendingPullIntos.length>0;){if(o._queueTotalSize===0)return;let i=o._pendingPullIntos.peek();xl(o,i)&&(cn(o),fa(o._controlledReadableByteStream,i))}}function Cg(o){let i=o._controlledReadableByteStream._reader;for(;i._readRequests.length>0;){if(o._queueTotalSize===0)return;let c=i._readRequests.shift();jl(o,c)}}function Eg(o,i,c,m){let w=o._controlledReadableByteStream,N=i.constructor,q=bg(N),{byteOffset:V,byteLength:ae}=i,te=c*q,ce;try{ce=rr(i.buffer)}catch(Te){m._errorSteps(Te);return}let ge={buffer:ce,bufferByteLength:ce.byteLength,byteOffset:V,byteLength:ae,bytesFilled:0,minimumFill:te,elementSize:q,viewConstructor:N,readerType:"byob"};if(o._pendingPullIntos.length>0){o._pendingPullIntos.push(ge),Ml(w,m);return}if(w._state==="closed"){let Te=new N(ge.buffer,ge.byteOffset,0);m._closeSteps(Te);return}if(o._queueTotalSize>0){if(xl(o,ge)){let Te=Fl(ge);Nl(o),m._chunkSteps(Te);return}if(o._closeRequested){let Te=new TypeError("Insufficient bytes to fill elements in the given buffer");bt(o,Te),m._errorSteps(Te);return}}o._pendingPullIntos.push(ge),Ml(w,m),Mr(o)}function Ag(o,i){i.readerType==="none"&&cn(o);let c=o._controlledReadableByteStream;if(ga(c))for(;$l(c)>0;){let m=cn(o);fa(c,m)}}function wg(o,i,c){if(Bl(o,i,c),c.readerType==="none"){Pl(o,c),ha(o);return}if(c.bytesFilled<c.minimumFill)return;cn(o);let m=c.bytesFilled%c.elementSize;if(m>0){let w=c.byteOffset+c.bytesFilled;Ol(o,c.buffer,w-m,m)}c.bytesFilled-=m,fa(o._controlledReadableByteStream,c),ha(o)}function Il(o,i){let c=o._pendingPullIntos.peek();da(o),o._controlledReadableByteStream._state==="closed"?Ag(o,c):wg(o,i,c),Mr(o)}function cn(o){return o._pendingPullIntos.shift()}function Dg(o){let i=o._controlledReadableByteStream;return i._state!=="readable"||o._closeRequested||!o._started?!1:!!(O(i)&&B(i)>0||ga(i)&&$l(i)>0||Ll(o)>0)}function qo(o){o._pullAlgorithm=void 0,o._cancelAlgorithm=void 0}function Yn(o){let i=o._controlledReadableByteStream;if(!(o._closeRequested||i._state!=="readable")){if(o._queueTotalSize>0){o._closeRequested=!0;return}if(o._pendingPullIntos.length>0){let c=o._pendingPullIntos.peek();if(c.bytesFilled%c.elementSize!==0){let m=new TypeError("Insufficient bytes to fill elements in the given buffer");throw bt(o,m),m}}qo(o),no(i)}}function Mo(o,i){let c=o._controlledReadableByteStream;if(o._closeRequested||c._state!=="readable")return;let{buffer:m,byteOffset:w,byteLength:N}=i;if(_r(m))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let q=rr(m);if(o._pendingPullIntos.length>0){let V=o._pendingPullIntos.peek();if(_r(V.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");da(o),V.buffer=rr(V.buffer),V.readerType==="none"&&Pl(o,V)}if(O(c))if(Cg(o),B(c)===0)Uo(o,q,w,N);else{o._pendingPullIntos.length>0&&cn(o);let V=new Uint8Array(q,w,N);k(c,V,!1)}else ga(c)?(Uo(o,q,w,N),ha(o)):Uo(o,q,w,N);Mr(o)}function bt(o,i){let c=o._controlledReadableByteStream;c._state==="readable"&&(kl(o),br(o),qo(o),hf(c,i))}function jl(o,i){let c=o._queue.shift();o._queueTotalSize-=c.byteLength,Nl(o);let m=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);i._chunkSteps(m)}function pa(o){if(o._byobRequest===null&&o._pendingPullIntos.length>0){let i=o._pendingPullIntos.peek(),c=new Uint8Array(i.buffer,i.byteOffset+i.bytesFilled,i.byteLength-i.bytesFilled),m=Object.create(Ur.prototype);vg(m,o,c),o._byobRequest=m}return o._byobRequest}function Ll(o){let i=o._controlledReadableByteStream._state;return i==="errored"?null:i==="closed"?0:o._strategyHWM-o._queueTotalSize}function $o(o,i){let c=o._pendingPullIntos.peek();if(o._controlledReadableByteStream._state==="closed"){if(i!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(i===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(c.bytesFilled+i>c.byteLength)throw new RangeError("bytesWritten out of range")}c.buffer=rr(c.buffer),Il(o,i)}function Ho(o,i){let c=o._pendingPullIntos.peek();if(o._controlledReadableByteStream._state==="closed"){if(i.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(i.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(c.byteOffset+c.bytesFilled!==i.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(c.bufferByteLength!==i.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(c.bytesFilled+i.byteLength>c.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let w=i.byteLength;c.buffer=rr(i.buffer),Il(o,w)}function Ul(o,i,c,m,w,N,q){i._controlledReadableByteStream=o,i._pullAgain=!1,i._pulling=!1,i._byobRequest=null,i._queue=i._queueTotalSize=void 0,br(i),i._closeRequested=!1,i._started=!1,i._strategyHWM=N,i._pullAlgorithm=m,i._cancelAlgorithm=w,i._autoAllocateChunkSize=q,i._pendingPullIntos=new L,o._readableStreamController=i;let V=c();E(h(V),()=>(i._started=!0,Mr(i),null),ae=>(bt(i,ae),null))}function Sg(o,i,c){let m=Object.create(nr.prototype),w,N,q;i.start!==void 0?w=()=>i.start(m):w=()=>{},i.pull!==void 0?N=()=>i.pull(m):N=()=>h(void 0),i.cancel!==void 0?q=ae=>i.cancel(ae):q=()=>h(void 0);let V=i.autoAllocateChunkSize;if(V===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Ul(o,m,w,N,q,c,V)}function vg(o,i,c){o._associatedReadableByteStreamController=i,o._view=c}function ma(o){return new TypeError(`ReadableStreamBYOBRequest.prototype.${o} can only be used on a ReadableStreamBYOBRequest`)}function Xn(o){return new TypeError(`ReadableByteStreamController.prototype.${o} can only be used on a ReadableByteStreamController`)}function Tg(o,i){pe(o,i);let c=o?.mode;return{mode:c===void 0?void 0:Rg(c,`${i} has member 'mode' that`)}}function Rg(o,i){if(o=`${o}`,o!=="byob")throw new TypeError(`${i} '${o}' is not a valid enumeration value for ReadableStreamReaderMode`);return o}function kg(o,i){var c;pe(o,i);let m=(c=o?.min)!==null&&c!==void 0?c:1;return{min:T(m,`${i} has member 'min' that`)}}function ql(o){return new Cr(o)}function Ml(o,i){o._reader._readIntoRequests.push(i)}function Fg(o,i,c){let w=o._reader._readIntoRequests.shift();c?w._closeSteps(i):w._chunkSteps(i)}function $l(o){return o._reader._readIntoRequests.length}function ga(o){let i=o._reader;return!(i===void 0||!$r(i))}class Cr{constructor(i){if(Ie(i,1,"ReadableStreamBYOBReader"),F(i,"First parameter"),wr(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!qr(i._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");he(this,i),this._readIntoRequests=new L}get closed(){return $r(this)?this._closedPromise:d(Go("closed"))}cancel(i=void 0){return $r(this)?this._ownerReadableStream===void 0?d(re("cancel")):fe(this,i):d(Go("cancel"))}read(i,c={}){if(!$r(this))return d(Go("read"));if(!ArrayBuffer.isView(i))return d(new TypeError("view must be an array buffer view"));if(i.byteLength===0)return d(new TypeError("view must have non-zero byteLength"));if(i.buffer.byteLength===0)return d(new TypeError("view's buffer must have non-zero byteLength"));if(_r(i.buffer))return d(new TypeError("view's buffer has been detached"));let m;try{m=kg(c,"options")}catch(te){return d(te)}let w=m.min;if(w===0)return d(new TypeError("options.min must be greater than 0"));if(_g(i)){if(w>i.byteLength)return d(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(w>i.length)return d(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return d(re("read from"));let N,q,V=f((te,ce)=>{N=te,q=ce});return Hl(this,i,w,{_chunkSteps:te=>N({value:te,done:!1}),_closeSteps:te=>N({value:te,done:!0}),_errorSteps:te=>q(te)}),V}releaseLock(){if(!$r(this))throw Go("releaseLock");this._ownerReadableStream!==void 0&&Og(this)}}Object.defineProperties(Cr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),s(Cr.prototype.cancel,"cancel"),s(Cr.prototype.read,"read"),s(Cr.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Cr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function $r(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readIntoRequests")?!1:o instanceof Cr}function Hl(o,i,c,m){let w=o._ownerReadableStream;w._disturbed=!0,w._state==="errored"?m._errorSteps(w._storedError):Eg(w._readableStreamController,i,c,m)}function Og(o){ye(o);let i=new TypeError("Reader was released");Gl(o,i)}function Gl(o,i){let c=o._readIntoRequests;o._readIntoRequests=new L,c.forEach(m=>{m._errorSteps(i)})}function Go(o){return new TypeError(`ReadableStreamBYOBReader.prototype.${o} can only be used on a ReadableStreamBYOBReader`)}function Qn(o,i){let{highWaterMark:c}=o;if(c===void 0)return i;if(ut(c)||c<0)throw new RangeError("Invalid highWaterMark");return c}function Wo(o){let{size:i}=o;return i||(()=>1)}function Jo(o,i){pe(o,i);let c=o?.highWaterMark,m=o?.size;return{highWaterMark:c===void 0?void 0:y(c),size:m===void 0?void 0:Pg(m,`${i} has member 'size' that`)}}function Pg(o,i){return Ee(o,i),c=>y(o(c))}function xg(o,i){pe(o,i);let c=o?.abort,m=o?.close,w=o?.start,N=o?.type,q=o?.write;return{abort:c===void 0?void 0:Bg(c,o,`${i} has member 'abort' that`),close:m===void 0?void 0:Ng(m,o,`${i} has member 'close' that`),start:w===void 0?void 0:Ig(w,o,`${i} has member 'start' that`),write:q===void 0?void 0:jg(q,o,`${i} has member 'write' that`),type:N}}function Bg(o,i,c){return Ee(o,c),m=>S(o,i,[m])}function Ng(o,i,c){return Ee(o,c),()=>S(o,i,[])}function Ig(o,i,c){return Ee(o,c),m=>R(o,i,[m])}function jg(o,i,c){return Ee(o,c),(m,w)=>S(o,i,[m,w])}function Wl(o,i){if(!ln(o))throw new TypeError(`${i} is not a WritableStream.`)}function Lg(o){if(typeof o!="object"||o===null)return!1;try{return typeof o.aborted=="boolean"}catch{return!1}}let Ug=typeof AbortController=="function";function qg(){if(Ug)return new AbortController}class Er{constructor(i={},c={}){i===void 0?i=null:xe(i,"First parameter");let m=Jo(c,"Second parameter"),w=xg(i,"First parameter");if(zl(this),w.type!==void 0)throw new RangeError("Invalid type is specified");let q=Wo(m),V=Qn(m,1);ey(this,w,V,q)}get locked(){if(!ln(this))throw Xo("locked");return fn(this)}abort(i=void 0){return ln(this)?fn(this)?d(new TypeError("Cannot abort a stream that already has a writer")):zo(this,i):d(Xo("abort"))}close(){return ln(this)?fn(this)?d(new TypeError("Cannot close a stream that already has a writer")):Ht(this)?d(new TypeError("Cannot close an already-closing stream")):Vl(this):d(Xo("close"))}getWriter(){if(!ln(this))throw Xo("getWriter");return Jl(this)}}Object.defineProperties(Er.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),s(Er.prototype.abort,"abort"),s(Er.prototype.close,"close"),s(Er.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Er.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Jl(o){return new or(o)}function Mg(o,i,c,m,w=1,N=()=>1){let q=Object.create(Er.prototype);zl(q);let V=Object.create(dn.prototype);return ef(q,V,o,i,c,m,w,N),q}function zl(o){o._state="writable",o._storedError=void 0,o._writer=void 0,o._writableStreamController=void 0,o._writeRequests=new L,o._inFlightWriteRequest=void 0,o._closeRequest=void 0,o._inFlightCloseRequest=void 0,o._pendingAbortRequest=void 0,o._backpressure=!1}function ln(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_writableStreamController")?!1:o instanceof Er}function fn(o){return o._writer!==void 0}function zo(o,i){var c;if(o._state==="closed"||o._state==="errored")return h(void 0);o._writableStreamController._abortReason=i,(c=o._writableStreamController._abortController)===null||c===void 0||c.abort(i);let m=o._state;if(m==="closed"||m==="errored")return h(void 0);if(o._pendingAbortRequest!==void 0)return o._pendingAbortRequest._promise;let w=!1;m==="erroring"&&(w=!0,i=void 0);let N=f((q,V)=>{o._pendingAbortRequest={_promise:void 0,_resolve:q,_reject:V,_reason:i,_wasAlreadyErroring:w}});return o._pendingAbortRequest._promise=N,w||_a(o,i),N}function Vl(o){let i=o._state;if(i==="closed"||i==="errored")return d(new TypeError(`The stream (in ${i} state) is not in the writable state and cannot be closed`));let c=f((w,N)=>{let q={_resolve:w,_reject:N};o._closeRequest=q}),m=o._writer;return m!==void 0&&o._backpressure&&i==="writable"&&va(m),ty(o._writableStreamController),c}function $g(o){return f((c,m)=>{let w={_resolve:c,_reject:m};o._writeRequests.push(w)})}function ya(o,i){if(o._state==="writable"){_a(o,i);return}ba(o)}function _a(o,i){let c=o._writableStreamController;o._state="erroring",o._storedError=i;let m=o._writer;m!==void 0&&Yl(m,i),!zg(o)&&c._started&&ba(o)}function ba(o){o._state="errored",o._writableStreamController[H]();let i=o._storedError;if(o._writeRequests.forEach(w=>{w._reject(i)}),o._writeRequests=new L,o._pendingAbortRequest===void 0){Vo(o);return}let c=o._pendingAbortRequest;if(o._pendingAbortRequest=void 0,c._wasAlreadyErroring){c._reject(i),Vo(o);return}let m=o._writableStreamController[U](c._reason);E(m,()=>(c._resolve(),Vo(o),null),w=>(c._reject(w),Vo(o),null))}function Hg(o){o._inFlightWriteRequest._resolve(void 0),o._inFlightWriteRequest=void 0}function Gg(o,i){o._inFlightWriteRequest._reject(i),o._inFlightWriteRequest=void 0,ya(o,i)}function Wg(o){o._inFlightCloseRequest._resolve(void 0),o._inFlightCloseRequest=void 0,o._state==="erroring"&&(o._storedError=void 0,o._pendingAbortRequest!==void 0&&(o._pendingAbortRequest._resolve(),o._pendingAbortRequest=void 0)),o._state="closed";let c=o._writer;c!==void 0&&of(c)}function Jg(o,i){o._inFlightCloseRequest._reject(i),o._inFlightCloseRequest=void 0,o._pendingAbortRequest!==void 0&&(o._pendingAbortRequest._reject(i),o._pendingAbortRequest=void 0),ya(o,i)}function Ht(o){return!(o._closeRequest===void 0&&o._inFlightCloseRequest===void 0)}function zg(o){return!(o._inFlightWriteRequest===void 0&&o._inFlightCloseRequest===void 0)}function Vg(o){o._inFlightCloseRequest=o._closeRequest,o._closeRequest=void 0}function Kg(o){o._inFlightWriteRequest=o._writeRequests.shift()}function Vo(o){o._closeRequest!==void 0&&(o._closeRequest._reject(o._storedError),o._closeRequest=void 0);let i=o._writer;i!==void 0&&Da(i,o._storedError)}function Ca(o,i){let c=o._writer;c!==void 0&&i!==o._backpressure&&(i?uy(c):va(c)),o._backpressure=i}class or{constructor(i){if(Ie(i,1,"WritableStreamDefaultWriter"),Wl(i,"First parameter"),fn(i))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=i,i._writer=this;let c=i._state;if(c==="writable")!Ht(i)&&i._backpressure?Zo(this):sf(this),Qo(this);else if(c==="erroring")Sa(this,i._storedError),Qo(this);else if(c==="closed")sf(this),iy(this);else{let m=i._storedError;Sa(this,m),nf(this,m)}}get closed(){return Hr(this)?this._closedPromise:d(Gr("closed"))}get desiredSize(){if(!Hr(this))throw Gr("desiredSize");if(this._ownerWritableStream===void 0)throw eo("desiredSize");return Zg(this)}get ready(){return Hr(this)?this._readyPromise:d(Gr("ready"))}abort(i=void 0){return Hr(this)?this._ownerWritableStream===void 0?d(eo("abort")):Yg(this,i):d(Gr("abort"))}close(){if(!Hr(this))return d(Gr("close"));let i=this._ownerWritableStream;return i===void 0?d(eo("close")):Ht(i)?d(new TypeError("Cannot close an already-closing stream")):Kl(this)}releaseLock(){if(!Hr(this))throw Gr("releaseLock");this._ownerWritableStream!==void 0&&Xl(this)}write(i=void 0){return Hr(this)?this._ownerWritableStream===void 0?d(eo("write to")):Ql(this,i):d(Gr("write"))}}Object.defineProperties(or.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),s(or.prototype.abort,"abort"),s(or.prototype.close,"close"),s(or.prototype.releaseLock,"releaseLock"),s(or.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(or.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Hr(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_ownerWritableStream")?!1:o instanceof or}function Yg(o,i){let c=o._ownerWritableStream;return zo(c,i)}function Kl(o){let i=o._ownerWritableStream;return Vl(i)}function Xg(o){let i=o._ownerWritableStream,c=i._state;return Ht(i)||c==="closed"?h(void 0):c==="errored"?d(i._storedError):Kl(o)}function Qg(o,i){o._closedPromiseState==="pending"?Da(o,i):ay(o,i)}function Yl(o,i){o._readyPromiseState==="pending"?af(o,i):cy(o,i)}function Zg(o){let i=o._ownerWritableStream,c=i._state;return c==="errored"||c==="erroring"?null:c==="closed"?0:tf(i._writableStreamController)}function Xl(o){let i=o._ownerWritableStream,c=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Yl(o,c),Qg(o,c),i._writer=void 0,o._ownerWritableStream=void 0}function Ql(o,i){let c=o._ownerWritableStream,m=c._writableStreamController,w=ry(m,i);if(c!==o._ownerWritableStream)return d(eo("write to"));let N=c._state;if(N==="errored")return d(c._storedError);if(Ht(c)||N==="closed")return d(new TypeError("The stream is closing or closed and cannot be written to"));if(N==="erroring")return d(c._storedError);let q=$g(c);return ny(m,i,w),q}let Zl={};class dn{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Ea(this))throw wa("abortReason");return this._abortReason}get signal(){if(!Ea(this))throw wa("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(i=void 0){if(!Ea(this))throw wa("error");this._controlledWritableStream._state==="writable"&&rf(this,i)}[U](i){let c=this._abortAlgorithm(i);return Ko(this),c}[H](){br(this)}}Object.defineProperties(dn.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(dn.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Ea(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledWritableStream")?!1:o instanceof dn}function ef(o,i,c,m,w,N,q,V){i._controlledWritableStream=o,o._writableStreamController=i,i._queue=void 0,i._queueTotalSize=void 0,br(i),i._abortReason=void 0,i._abortController=qg(),i._started=!1,i._strategySizeAlgorithm=V,i._strategyHWM=q,i._writeAlgorithm=m,i._closeAlgorithm=w,i._abortAlgorithm=N;let ae=Aa(i);Ca(o,ae);let te=c(),ce=h(te);E(ce,()=>(i._started=!0,Yo(i),null),ge=>(i._started=!0,ya(o,ge),null))}function ey(o,i,c,m){let w=Object.create(dn.prototype),N,q,V,ae;i.start!==void 0?N=()=>i.start(w):N=()=>{},i.write!==void 0?q=te=>i.write(te,w):q=()=>h(void 0),i.close!==void 0?V=()=>i.close():V=()=>h(void 0),i.abort!==void 0?ae=te=>i.abort(te):ae=()=>h(void 0),ef(o,w,N,q,V,ae,c,m)}function Ko(o){o._writeAlgorithm=void 0,o._closeAlgorithm=void 0,o._abortAlgorithm=void 0,o._strategySizeAlgorithm=void 0}function ty(o){ca(o,Zl,0),Yo(o)}function ry(o,i){try{return o._strategySizeAlgorithm(i)}catch(c){return Zn(o,c),1}}function tf(o){return o._strategyHWM-o._queueTotalSize}function ny(o,i,c){try{ca(o,i,c)}catch(w){Zn(o,w);return}let m=o._controlledWritableStream;if(!Ht(m)&&m._state==="writable"){let w=Aa(o);Ca(m,w)}Yo(o)}function Yo(o){let i=o._controlledWritableStream;if(!o._started||i._inFlightWriteRequest!==void 0)return;if(i._state==="erroring"){ba(i);return}if(o._queue.length===0)return;let m=yg(o);m===Zl?oy(o):sy(o,m)}function Zn(o,i){o._controlledWritableStream._state==="writable"&&rf(o,i)}function oy(o){let i=o._controlledWritableStream;Vg(i),ua(o);let c=o._closeAlgorithm();Ko(o),E(c,()=>(Wg(i),null),m=>(Jg(i,m),null))}function sy(o,i){let c=o._controlledWritableStream;Kg(c);let m=o._writeAlgorithm(i);E(m,()=>{Hg(c);let w=c._state;if(ua(o),!Ht(c)&&w==="writable"){let N=Aa(o);Ca(c,N)}return Yo(o),null},w=>(c._state==="writable"&&Ko(o),Gg(c,w),null))}function Aa(o){return tf(o)<=0}function rf(o,i){let c=o._controlledWritableStream;Ko(o),_a(c,i)}function Xo(o){return new TypeError(`WritableStream.prototype.${o} can only be used on a WritableStream`)}function wa(o){return new TypeError(`WritableStreamDefaultController.prototype.${o} can only be used on a WritableStreamDefaultController`)}function Gr(o){return new TypeError(`WritableStreamDefaultWriter.prototype.${o} can only be used on a WritableStreamDefaultWriter`)}function eo(o){return new TypeError("Cannot "+o+" a stream using a released writer")}function Qo(o){o._closedPromise=f((i,c)=>{o._closedPromise_resolve=i,o._closedPromise_reject=c,o._closedPromiseState="pending"})}function nf(o,i){Qo(o),Da(o,i)}function iy(o){Qo(o),of(o)}function Da(o,i){o._closedPromise_reject!==void 0&&(g(o._closedPromise),o._closedPromise_reject(i),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0,o._closedPromiseState="rejected")}function ay(o,i){nf(o,i)}function of(o){o._closedPromise_resolve!==void 0&&(o._closedPromise_resolve(void 0),o._closedPromise_resolve=void 0,o._closedPromise_reject=void 0,o._closedPromiseState="resolved")}function Zo(o){o._readyPromise=f((i,c)=>{o._readyPromise_resolve=i,o._readyPromise_reject=c}),o._readyPromiseState="pending"}function Sa(o,i){Zo(o),af(o,i)}function sf(o){Zo(o),va(o)}function af(o,i){o._readyPromise_reject!==void 0&&(g(o._readyPromise),o._readyPromise_reject(i),o._readyPromise_resolve=void 0,o._readyPromise_reject=void 0,o._readyPromiseState="rejected")}function uy(o){Zo(o)}function cy(o,i){Sa(o,i)}function va(o){o._readyPromise_resolve!==void 0&&(o._readyPromise_resolve(void 0),o._readyPromise_resolve=void 0,o._readyPromise_reject=void 0,o._readyPromiseState="fulfilled")}function ly(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Ta=ly();function fy(o){if(!(typeof o=="function"||typeof o=="object")||o.name!=="DOMException")return!1;try{return new o,!0}catch{return!1}}function dy(){let o=Ta?.DOMException;return fy(o)?o:void 0}function hy(){let o=function(c,m){this.message=c||"",this.name=m||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return s(o,"DOMException"),o.prototype=Object.create(Error.prototype),Object.defineProperty(o.prototype,"constructor",{value:o,writable:!0,configurable:!0}),o}let py=dy()||hy();function uf(o,i,c,m,w,N){let q=j(o),V=Jl(i);o._disturbed=!0;let ae=!1,te=h(void 0);return f((ce,ge)=>{let Te;if(N!==void 0){if(Te=()=>{let ne=N.reason!==void 0?N.reason:new py("Aborted","AbortError"),_e=[];m||_e.push(()=>i._state==="writable"?zo(i,ne):h(void 0)),w||_e.push(()=>o._state==="readable"?Ot(o,ne):h(void 0)),rt(()=>Promise.all(_e.map(Re=>Re())),!0,ne)},N.aborted){Te();return}N.addEventListener("abort",Te)}function Pt(){return f((ne,_e)=>{function Re(ct){ct?ne():_(gn(),Re,_e)}Re(!1)})}function gn(){return ae?h(!0):_(V._readyPromise,()=>f((ne,_e)=>{Q(q,{_chunkSteps:Re=>{te=_(Ql(V,Re),void 0,e),ne(!1)},_closeSteps:()=>ne(!0),_errorSteps:_e})}))}if(ir(o,q._closedPromise,ne=>(m?Ct(!0,ne):rt(()=>zo(i,ne),!0,ne),null)),ir(i,V._closedPromise,ne=>(w?Ct(!0,ne):rt(()=>Ot(o,ne),!0,ne),null)),Qe(o,q._closedPromise,()=>(c?Ct():rt(()=>Xg(V)),null)),Ht(i)||i._state==="closed"){let ne=new TypeError("the destination writable stream closed before all data could be piped to it");w?Ct(!0,ne):rt(()=>Ot(o,ne),!0,ne)}g(Pt());function Sr(){let ne=te;return _(te,()=>ne!==te?Sr():void 0)}function ir(ne,_e,Re){ne._state==="errored"?Re(ne._storedError):v(_e,Re)}function Qe(ne,_e,Re){ne._state==="closed"?Re():P(_e,Re)}function rt(ne,_e,Re){if(ae)return;ae=!0,i._state==="writable"&&!Ht(i)?P(Sr(),ct):ct();function ct(){return E(ne(),()=>ar(_e,Re),yn=>ar(!0,yn)),null}}function Ct(ne,_e){ae||(ae=!0,i._state==="writable"&&!Ht(i)?P(Sr(),()=>ar(ne,_e)):ar(ne,_e))}function ar(ne,_e){return Xl(V),ye(q),N!==void 0&&N.removeEventListener("abort",Te),ne?ge(_e):ce(void 0),null}})}class sr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!es(this))throw rs("desiredSize");return Ra(this)}close(){if(!es(this))throw rs("close");if(!pn(this))throw new TypeError("The stream is not in a state that permits close");Wr(this)}enqueue(i=void 0){if(!es(this))throw rs("enqueue");if(!pn(this))throw new TypeError("The stream is not in a state that permits enqueue");return hn(this,i)}error(i=void 0){if(!es(this))throw rs("error");Ft(this,i)}[K](i){br(this);let c=this._cancelAlgorithm(i);return ts(this),c}[W](i){let c=this._controlledReadableStream;if(this._queue.length>0){let m=ua(this);this._closeRequested&&this._queue.length===0?(ts(this),no(c)):to(this),i._chunkSteps(m)}else D(c,i),to(this)}[we](){}}Object.defineProperties(sr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),s(sr.prototype.close,"close"),s(sr.prototype.enqueue,"enqueue"),s(sr.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(sr.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function es(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledReadableStream")?!1:o instanceof sr}function to(o){if(!cf(o))return;if(o._pulling){o._pullAgain=!0;return}o._pulling=!0;let c=o._pullAlgorithm();E(c,()=>(o._pulling=!1,o._pullAgain&&(o._pullAgain=!1,to(o)),null),m=>(Ft(o,m),null))}function cf(o){let i=o._controlledReadableStream;return!pn(o)||!o._started?!1:!!(wr(i)&&B(i)>0||Ra(o)>0)}function ts(o){o._pullAlgorithm=void 0,o._cancelAlgorithm=void 0,o._strategySizeAlgorithm=void 0}function Wr(o){if(!pn(o))return;let i=o._controlledReadableStream;o._closeRequested=!0,o._queue.length===0&&(ts(o),no(i))}function hn(o,i){if(!pn(o))return;let c=o._controlledReadableStream;if(wr(c)&&B(c)>0)k(c,i,!1);else{let m;try{m=o._strategySizeAlgorithm(i)}catch(w){throw Ft(o,w),w}try{ca(o,i,m)}catch(w){throw Ft(o,w),w}}to(o)}function Ft(o,i){let c=o._controlledReadableStream;c._state==="readable"&&(br(o),ts(o),hf(c,i))}function Ra(o){let i=o._controlledReadableStream._state;return i==="errored"?null:i==="closed"?0:o._strategyHWM-o._queueTotalSize}function my(o){return!cf(o)}function pn(o){let i=o._controlledReadableStream._state;return!o._closeRequested&&i==="readable"}function lf(o,i,c,m,w,N,q){i._controlledReadableStream=o,i._queue=void 0,i._queueTotalSize=void 0,br(i),i._started=!1,i._closeRequested=!1,i._pullAgain=!1,i._pulling=!1,i._strategySizeAlgorithm=q,i._strategyHWM=N,i._pullAlgorithm=m,i._cancelAlgorithm=w,o._readableStreamController=i;let V=c();E(h(V),()=>(i._started=!0,to(i),null),ae=>(Ft(i,ae),null))}function gy(o,i,c,m){let w=Object.create(sr.prototype),N,q,V;i.start!==void 0?N=()=>i.start(w):N=()=>{},i.pull!==void 0?q=()=>i.pull(w):q=()=>h(void 0),i.cancel!==void 0?V=ae=>i.cancel(ae):V=()=>h(void 0),lf(o,w,N,q,V,c,m)}function rs(o){return new TypeError(`ReadableStreamDefaultController.prototype.${o} can only be used on a ReadableStreamDefaultController`)}function yy(o,i){return qr(o._readableStreamController)?by(o):_y(o)}function _y(o,i){let c=j(o),m=!1,w=!1,N=!1,q=!1,V,ae,te,ce,ge,Te=f(Qe=>{ge=Qe});function Pt(){return m?(w=!0,h(void 0)):(m=!0,Q(c,{_chunkSteps:rt=>{b(()=>{w=!1;let Ct=rt,ar=rt;N||hn(te._readableStreamController,Ct),q||hn(ce._readableStreamController,ar),m=!1,w&&Pt()})},_closeSteps:()=>{m=!1,N||Wr(te._readableStreamController),q||Wr(ce._readableStreamController),(!N||!q)&&ge(void 0)},_errorSteps:()=>{m=!1}}),h(void 0))}function gn(Qe){if(N=!0,V=Qe,q){let rt=Se([V,ae]),Ct=Ot(o,rt);ge(Ct)}return Te}function Sr(Qe){if(q=!0,ae=Qe,N){let rt=Se([V,ae]),Ct=Ot(o,rt);ge(Ct)}return Te}function ir(){}return te=ro(ir,Pt,gn),ce=ro(ir,Pt,Sr),v(c._closedPromise,Qe=>(Ft(te._readableStreamController,Qe),Ft(ce._readableStreamController,Qe),(!N||!q)&&ge(void 0),null)),[te,ce]}function by(o){let i=j(o),c=!1,m=!1,w=!1,N=!1,q=!1,V,ae,te,ce,ge,Te=f(ne=>{ge=ne});function Pt(ne){v(ne._closedPromise,_e=>(ne!==i||(bt(te._readableStreamController,_e),bt(ce._readableStreamController,_e),(!N||!q)&&ge(void 0)),null))}function gn(){$r(i)&&(ye(i),i=j(o),Pt(i)),Q(i,{_chunkSteps:_e=>{b(()=>{m=!1,w=!1;let Re=_e,ct=_e;if(!N&&!q)try{ct=Tl(_e)}catch(yn){bt(te._readableStreamController,yn),bt(ce._readableStreamController,yn),ge(Ot(o,yn));return}N||Mo(te._readableStreamController,Re),q||Mo(ce._readableStreamController,ct),c=!1,m?ir():w&&Qe()})},_closeSteps:()=>{c=!1,N||Yn(te._readableStreamController),q||Yn(ce._readableStreamController),te._readableStreamController._pendingPullIntos.length>0&&$o(te._readableStreamController,0),ce._readableStreamController._pendingPullIntos.length>0&&$o(ce._readableStreamController,0),(!N||!q)&&ge(void 0)},_errorSteps:()=>{c=!1}})}function Sr(ne,_e){Y(i)&&(ye(i),i=ql(o),Pt(i));let Re=_e?ce:te,ct=_e?te:ce;Hl(i,ne,1,{_chunkSteps:_n=>{b(()=>{m=!1,w=!1;let bn=_e?q:N;if(_e?N:q)bn||Ho(Re._readableStreamController,_n);else{let vf;try{vf=Tl(_n)}catch(xa){bt(Re._readableStreamController,xa),bt(ct._readableStreamController,xa),ge(Ot(o,xa));return}bn||Ho(Re._readableStreamController,_n),Mo(ct._readableStreamController,vf)}c=!1,m?ir():w&&Qe()})},_closeSteps:_n=>{c=!1;let bn=_e?q:N,ls=_e?N:q;bn||Yn(Re._readableStreamController),ls||Yn(ct._readableStreamController),_n!==void 0&&(bn||Ho(Re._readableStreamController,_n),!ls&&ct._readableStreamController._pendingPullIntos.length>0&&$o(ct._readableStreamController,0)),(!bn||!ls)&&ge(void 0)},_errorSteps:()=>{c=!1}})}function ir(){if(c)return m=!0,h(void 0);c=!0;let ne=pa(te._readableStreamController);return ne===null?gn():Sr(ne._view,!1),h(void 0)}function Qe(){if(c)return w=!0,h(void 0);c=!0;let ne=pa(ce._readableStreamController);return ne===null?gn():Sr(ne._view,!0),h(void 0)}function rt(ne){if(N=!0,V=ne,q){let _e=Se([V,ae]),Re=Ot(o,_e);ge(Re)}return Te}function Ct(ne){if(q=!0,ae=ne,N){let _e=Se([V,ae]),Re=Ot(o,_e);ge(Re)}return Te}function ar(){}return te=df(ar,ir,rt),ce=df(ar,Qe,Ct),Pt(i),[te,ce]}function Cy(o){return t(o)&&typeof o.getReader<"u"}function Ey(o){return Cy(o)?wy(o.getReader()):Ay(o)}function Ay(o){let i,c=vl(o,"async"),m=e;function w(){let q;try{q=hg(c)}catch(ae){return d(ae)}let V=h(q);return A(V,ae=>{if(!t(ae))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(pg(ae))Wr(i._readableStreamController);else{let ce=mg(ae);hn(i._readableStreamController,ce)}})}function N(q){let V=c.iterator,ae;try{ae=Lo(V,"return")}catch(ge){return d(ge)}if(ae===void 0)return h(void 0);let te;try{te=R(ae,V,[q])}catch(ge){return d(ge)}let ce=h(te);return A(ce,ge=>{if(!t(ge))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return i=ro(m,w,N,0),i}function wy(o){let i,c=e;function m(){let N;try{N=o.read()}catch(q){return d(q)}return A(N,q=>{if(!t(q))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(q.done)Wr(i._readableStreamController);else{let V=q.value;hn(i._readableStreamController,V)}})}function w(N){try{return h(o.cancel(N))}catch(q){return d(q)}}return i=ro(c,m,w,0),i}function Dy(o,i){pe(o,i);let c=o,m=c?.autoAllocateChunkSize,w=c?.cancel,N=c?.pull,q=c?.start,V=c?.type;return{autoAllocateChunkSize:m===void 0?void 0:T(m,`${i} has member 'autoAllocateChunkSize' that`),cancel:w===void 0?void 0:Sy(w,c,`${i} has member 'cancel' that`),pull:N===void 0?void 0:vy(N,c,`${i} has member 'pull' that`),start:q===void 0?void 0:Ty(q,c,`${i} has member 'start' that`),type:V===void 0?void 0:Ry(V,`${i} has member 'type' that`)}}function Sy(o,i,c){return Ee(o,c),m=>S(o,i,[m])}function vy(o,i,c){return Ee(o,c),m=>S(o,i,[m])}function Ty(o,i,c){return Ee(o,c),m=>R(o,i,[m])}function Ry(o,i){if(o=`${o}`,o!=="bytes")throw new TypeError(`${i} '${o}' is not a valid enumeration value for ReadableStreamType`);return o}function ky(o,i){return pe(o,i),{preventCancel:!!o?.preventCancel}}function ff(o,i){pe(o,i);let c=o?.preventAbort,m=o?.preventCancel,w=o?.preventClose,N=o?.signal;return N!==void 0&&Fy(N,`${i} has member 'signal' that`),{preventAbort:!!c,preventCancel:!!m,preventClose:!!w,signal:N}}function Fy(o,i){if(!Lg(o))throw new TypeError(`${i} is not an AbortSignal.`)}function Oy(o,i){pe(o,i);let c=o?.readable;p(c,"readable","ReadableWritablePair"),F(c,`${i} has member 'readable' that`);let m=o?.writable;return p(m,"writable","ReadableWritablePair"),Wl(m,`${i} has member 'writable' that`),{readable:c,writable:m}}class Ye{constructor(i={},c={}){i===void 0?i=null:xe(i,"First parameter");let m=Jo(c,"Second parameter"),w=Dy(i,"First parameter");if(ka(this),w.type==="bytes"){if(m.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let N=Qn(m,0);Sg(this,w,N)}else{let N=Wo(m),q=Qn(m,1);gy(this,w,q,N)}}get locked(){if(!Ar(this))throw Jr("locked");return wr(this)}cancel(i=void 0){return Ar(this)?wr(this)?d(new TypeError("Cannot cancel a stream that already has a reader")):Ot(this,i):d(Jr("cancel"))}getReader(i=void 0){if(!Ar(this))throw Jr("getReader");return Tg(i,"First parameter").mode===void 0?j(this):ql(this)}pipeThrough(i,c={}){if(!Ar(this))throw Jr("pipeThrough");Ie(i,1,"pipeThrough");let m=Oy(i,"First parameter"),w=ff(c,"Second parameter");if(wr(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(fn(m.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let N=uf(this,m.writable,w.preventClose,w.preventAbort,w.preventCancel,w.signal);return g(N),m.readable}pipeTo(i,c={}){if(!Ar(this))return d(Jr("pipeTo"));if(i===void 0)return d("Parameter 1 is required in 'pipeTo'.");if(!ln(i))return d(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let m;try{m=ff(c,"Second parameter")}catch(w){return d(w)}return wr(this)?d(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):fn(i)?d(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):uf(this,i,m.preventClose,m.preventAbort,m.preventCancel,m.signal)}tee(){if(!Ar(this))throw Jr("tee");let i=yy(this);return Se(i)}values(i=void 0){if(!Ar(this))throw Jr("values");let c=ky(i,"First parameter");return sn(this,c.preventCancel)}[aa](i){return this.values(i)}static from(i){return Ey(i)}}Object.defineProperties(Ye,{from:{enumerable:!0}}),Object.defineProperties(Ye.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),s(Ye.from,"from"),s(Ye.prototype.cancel,"cancel"),s(Ye.prototype.getReader,"getReader"),s(Ye.prototype.pipeThrough,"pipeThrough"),s(Ye.prototype.pipeTo,"pipeTo"),s(Ye.prototype.tee,"tee"),s(Ye.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ye.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(Ye.prototype,aa,{value:Ye.prototype.values,writable:!0,configurable:!0});function ro(o,i,c,m=1,w=()=>1){let N=Object.create(Ye.prototype);ka(N);let q=Object.create(sr.prototype);return lf(N,q,o,i,c,m,w),N}function df(o,i,c){let m=Object.create(Ye.prototype);ka(m);let w=Object.create(nr.prototype);return Ul(m,w,o,i,c,0,void 0),m}function ka(o){o._state="readable",o._reader=void 0,o._storedError=void 0,o._disturbed=!1}function Ar(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_readableStreamController")?!1:o instanceof Ye}function wr(o){return o._reader!==void 0}function Ot(o,i){if(o._disturbed=!0,o._state==="closed")return h(void 0);if(o._state==="errored")return d(o._storedError);no(o);let c=o._reader;if(c!==void 0&&$r(c)){let w=c._readIntoRequests;c._readIntoRequests=new L,w.forEach(N=>{N._closeSteps(void 0)})}let m=o._readableStreamController[K](i);return A(m,e)}function no(o){o._state="closed";let i=o._reader;if(i!==void 0&&(se(i),Y(i))){let c=i._readRequests;i._readRequests=new L,c.forEach(m=>{m._closeSteps()})}}function hf(o,i){o._state="errored",o._storedError=i;let c=o._reader;c!==void 0&&(z(c,i),Y(c)?Fe(c,i):Gl(c,i))}function Jr(o){return new TypeError(`ReadableStream.prototype.${o} can only be used on a ReadableStream`)}function pf(o,i){pe(o,i);let c=o?.highWaterMark;return p(c,"highWaterMark","QueuingStrategyInit"),{highWaterMark:y(c)}}let mf=o=>o.byteLength;s(mf,"size");class ns{constructor(i){Ie(i,1,"ByteLengthQueuingStrategy"),i=pf(i,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!yf(this))throw gf("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!yf(this))throw gf("size");return mf}}Object.defineProperties(ns.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ns.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function gf(o){return new TypeError(`ByteLengthQueuingStrategy.prototype.${o} can only be used on a ByteLengthQueuingStrategy`)}function yf(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_byteLengthQueuingStrategyHighWaterMark")?!1:o instanceof ns}let _f=()=>1;s(_f,"size");class os{constructor(i){Ie(i,1,"CountQueuingStrategy"),i=pf(i,"First parameter"),this._countQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!Cf(this))throw bf("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Cf(this))throw bf("size");return _f}}Object.defineProperties(os.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(os.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function bf(o){return new TypeError(`CountQueuingStrategy.prototype.${o} can only be used on a CountQueuingStrategy`)}function Cf(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_countQueuingStrategyHighWaterMark")?!1:o instanceof os}function Py(o,i){pe(o,i);let c=o?.cancel,m=o?.flush,w=o?.readableType,N=o?.start,q=o?.transform,V=o?.writableType;return{cancel:c===void 0?void 0:Iy(c,o,`${i} has member 'cancel' that`),flush:m===void 0?void 0:xy(m,o,`${i} has member 'flush' that`),readableType:w,start:N===void 0?void 0:By(N,o,`${i} has member 'start' that`),transform:q===void 0?void 0:Ny(q,o,`${i} has member 'transform' that`),writableType:V}}function xy(o,i,c){return Ee(o,c),m=>S(o,i,[m])}function By(o,i,c){return Ee(o,c),m=>R(o,i,[m])}function Ny(o,i,c){return Ee(o,c),(m,w)=>S(o,i,[m,w])}function Iy(o,i,c){return Ee(o,c),m=>S(o,i,[m])}class ss{constructor(i={},c={},m={}){i===void 0&&(i=null);let w=Jo(c,"Second parameter"),N=Jo(m,"Third parameter"),q=Py(i,"First parameter");if(q.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(q.writableType!==void 0)throw new RangeError("Invalid writableType specified");let V=Qn(N,0),ae=Wo(N),te=Qn(w,1),ce=Wo(w),ge,Te=f(Pt=>{ge=Pt});jy(this,Te,te,ce,V,ae),Uy(this,q),q.start!==void 0?ge(q.start(this._transformStreamController)):ge(void 0)}get readable(){if(!Ef(this))throw Sf("readable");return this._readable}get writable(){if(!Ef(this))throw Sf("writable");return this._writable}}Object.defineProperties(ss.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ss.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function jy(o,i,c,m,w,N){function q(){return i}function V(Te){return $y(o,Te)}function ae(Te){return Hy(o,Te)}function te(){return Gy(o)}o._writable=Mg(q,V,te,ae,c,m);function ce(){return Wy(o)}function ge(Te){return Jy(o,Te)}o._readable=ro(q,ce,ge,w,N),o._backpressure=void 0,o._backpressureChangePromise=void 0,o._backpressureChangePromise_resolve=void 0,is(o,!0),o._transformStreamController=void 0}function Ef(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_transformStreamController")?!1:o instanceof ss}function Af(o,i){Ft(o._readable._readableStreamController,i),Fa(o,i)}function Fa(o,i){us(o._transformStreamController),Zn(o._writable._writableStreamController,i),Oa(o)}function Oa(o){o._backpressure&&is(o,!1)}function is(o,i){o._backpressureChangePromise!==void 0&&o._backpressureChangePromise_resolve(),o._backpressureChangePromise=f(c=>{o._backpressureChangePromise_resolve=c}),o._backpressure=i}class Dr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!as(this))throw cs("desiredSize");let i=this._controlledTransformStream._readable._readableStreamController;return Ra(i)}enqueue(i=void 0){if(!as(this))throw cs("enqueue");wf(this,i)}error(i=void 0){if(!as(this))throw cs("error");qy(this,i)}terminate(){if(!as(this))throw cs("terminate");My(this)}}Object.defineProperties(Dr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),s(Dr.prototype.enqueue,"enqueue"),s(Dr.prototype.error,"error"),s(Dr.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Dr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function as(o){return!t(o)||!Object.prototype.hasOwnProperty.call(o,"_controlledTransformStream")?!1:o instanceof Dr}function Ly(o,i,c,m,w){i._controlledTransformStream=o,o._transformStreamController=i,i._transformAlgorithm=c,i._flushAlgorithm=m,i._cancelAlgorithm=w,i._finishPromise=void 0,i._finishPromise_resolve=void 0,i._finishPromise_reject=void 0}function Uy(o,i){let c=Object.create(Dr.prototype),m,w,N;i.transform!==void 0?m=q=>i.transform(q,c):m=q=>{try{return wf(c,q),h(void 0)}catch(V){return d(V)}},i.flush!==void 0?w=()=>i.flush(c):w=()=>h(void 0),i.cancel!==void 0?N=q=>i.cancel(q):N=()=>h(void 0),Ly(o,c,m,w,N)}function us(o){o._transformAlgorithm=void 0,o._flushAlgorithm=void 0,o._cancelAlgorithm=void 0}function wf(o,i){let c=o._controlledTransformStream,m=c._readable._readableStreamController;if(!pn(m))throw new TypeError("Readable side is not in a state that permits enqueue");try{hn(m,i)}catch(N){throw Fa(c,N),c._readable._storedError}my(m)!==c._backpressure&&is(c,!0)}function qy(o,i){Af(o._controlledTransformStream,i)}function Df(o,i){let c=o._transformAlgorithm(i);return A(c,void 0,m=>{throw Af(o._controlledTransformStream,m),m})}function My(o){let i=o._controlledTransformStream,c=i._readable._readableStreamController;Wr(c);let m=new TypeError("TransformStream terminated");Fa(i,m)}function $y(o,i){let c=o._transformStreamController;if(o._backpressure){let m=o._backpressureChangePromise;return A(m,()=>{let w=o._writable;if(w._state==="erroring")throw w._storedError;return Df(c,i)})}return Df(c,i)}function Hy(o,i){let c=o._transformStreamController;if(c._finishPromise!==void 0)return c._finishPromise;let m=o._readable;c._finishPromise=f((N,q)=>{c._finishPromise_resolve=N,c._finishPromise_reject=q});let w=c._cancelAlgorithm(i);return us(c),E(w,()=>(m._state==="errored"?mn(c,m._storedError):(Ft(m._readableStreamController,i),Pa(c)),null),N=>(Ft(m._readableStreamController,N),mn(c,N),null)),c._finishPromise}function Gy(o){let i=o._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let c=o._readable;i._finishPromise=f((w,N)=>{i._finishPromise_resolve=w,i._finishPromise_reject=N});let m=i._flushAlgorithm();return us(i),E(m,()=>(c._state==="errored"?mn(i,c._storedError):(Wr(c._readableStreamController),Pa(i)),null),w=>(Ft(c._readableStreamController,w),mn(i,w),null)),i._finishPromise}function Wy(o){return is(o,!1),o._backpressureChangePromise}function Jy(o,i){let c=o._transformStreamController;if(c._finishPromise!==void 0)return c._finishPromise;let m=o._writable;c._finishPromise=f((N,q)=>{c._finishPromise_resolve=N,c._finishPromise_reject=q});let w=c._cancelAlgorithm(i);return us(c),E(w,()=>(m._state==="errored"?mn(c,m._storedError):(Zn(m._writableStreamController,i),Oa(o),Pa(c)),null),N=>(Zn(m._writableStreamController,N),Oa(o),mn(c,N),null)),c._finishPromise}function cs(o){return new TypeError(`TransformStreamDefaultController.prototype.${o} can only be used on a TransformStreamDefaultController`)}function Pa(o){o._finishPromise_resolve!==void 0&&(o._finishPromise_resolve(),o._finishPromise_resolve=void 0,o._finishPromise_reject=void 0)}function mn(o,i){o._finishPromise_reject!==void 0&&(g(o._finishPromise),o._finishPromise_reject(i),o._finishPromise_resolve=void 0,o._finishPromise_reject=void 0)}function Sf(o){return new TypeError(`TransformStream.prototype.${o} can only be used on a TransformStream`)}r.ByteLengthQueuingStrategy=ns,r.CountQueuingStrategy=os,r.ReadableByteStreamController=nr,r.ReadableStream=Ye,r.ReadableStreamBYOBReader=Cr,r.ReadableStreamBYOBRequest=Ur,r.ReadableStreamDefaultController=sr,r.ReadableStreamDefaultReader=M,r.TransformStream=ss,r.TransformStreamDefaultController=Dr,r.WritableStream=Er,r.WritableStreamDefaultController=dn,r.WritableStreamDefaultWriter=or}))});var qd=J(()=>{if(!globalThis.ReadableStream)try{let r=X("node:process"),{emitWarning:e}=r;try{r.emitWarning=()=>{},Object.assign(globalThis,X("node:stream/web")),r.emitWarning=e}catch(t){throw r.emitWarning=e,t}}catch{Object.assign(globalThis,Ud())}try{let{Blob:r}=X("buffer");r&&!r.prototype.stream&&(r.prototype.stream=function(t){let n=0,s=this;return new ReadableStream({type:"bytes",async pull(a){let l=await s.slice(n,Math.min(s.size,n+65536)).arrayBuffer();n+=l.byteLength,a.enqueue(new Uint8Array(l)),n===s.size&&a.close()}})})}catch{}});async function*su(r,e=!0){for(let t of r)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let n=t.byteOffset,s=t.byteOffset+t.byteLength;for(;n!==s;){let a=Math.min(s-n,Md),u=t.buffer.slice(n,n+a);n+=u.byteLength,yield new Uint8Array(u)}}else yield t;else{let n=0,s=t;for(;n!==s.size;){let u=await s.slice(n,Math.min(s.size,n+Md)).arrayBuffer();n+=u.byteLength,yield new Uint8Array(u)}}}var hD,Md,$d,C_,Bt,uo=Me(()=>{hD=zr(qd(),1);Md=65536;$d=class iu{#e=[];#t="";#r=0;#n="transparent";constructor(e=[],t={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof t!="object"&&typeof t!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");t===null&&(t={});let n=new TextEncoder;for(let a of e){let u;ArrayBuffer.isView(a)?u=new Uint8Array(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)):a instanceof ArrayBuffer?u=new Uint8Array(a.slice(0)):a instanceof iu?u=a:u=n.encode(`${a}`),this.#r+=ArrayBuffer.isView(u)?u.byteLength:u.size,this.#e.push(u)}this.#n=`${t.endings===void 0?"transparent":t.endings}`;let s=t.type===void 0?"":String(t.type);this.#t=/^[\x20-\x7E]*$/.test(s)?s:""}get size(){return this.#r}get type(){return this.#t}async text(){let e=new TextDecoder,t="";for await(let n of su(this.#e,!1))t+=e.decode(n,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let n of su(this.#e,!1))e.set(n,t),t+=n.length;return e.buffer}stream(){let e=su(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){let n=await e.next();n.done?t.close():t.enqueue(n.value)},async cancel(){await e.return()}})}slice(e=0,t=this.size,n=""){let{size:s}=this,a=e<0?Math.max(s+e,0):Math.min(e,s),u=t<0?Math.max(s+t,0):Math.min(t,s),l=Math.max(u-a,0),f=this.#e,h=[],d=0;for(let E of f){if(d>=l)break;let P=ArrayBuffer.isView(E)?E.byteLength:E.size;if(a&&P<=a)a-=P,u-=P;else{let v;ArrayBuffer.isView(E)?(v=E.subarray(a,Math.min(P,u)),d+=v.byteLength):(v=E.slice(a,Math.min(P,u)),d+=v.size),u-=P,h.push(v),a=0}}let _=new iu([],{type:String(n).toLowerCase()});return _.#r=l,_.#e=h,_}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties($d.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});C_=$d,Bt=C_});var E_,A_,kr,au=Me(()=>{uo();E_=class extends Bt{#e=0;#t="";constructor(e,t,n={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,n),n===null&&(n={});let s=n.lastModified===void 0?Date.now():Number(n.lastModified);Number.isNaN(s)||(this.#e=s),this.#t=String(t)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof Bt&&/^(File)$/.test(e[Symbol.toStringTag])}},A_=E_,kr=A_});function Wd(r,e=Bt){var t=`${Hd()}${Hd()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),n=[],s=`--${t}\r
Content-Disposition: form-data; name="`;return r.forEach((a,u)=>typeof a=="string"?n.push(s+uu(u)+`"\r
\r
${a.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):n.push(s+uu(u)+`"; filename="${uu(a.name,1)}"\r
Content-Type: ${a.type||"application/octet-stream"}\r
\r
`,a,`\r
`)),n.push(`--${t}--`),new e(n,{type:"multipart/form-data; boundary="+t})}var co,w_,D_,Hd,S_,Gd,uu,Xr,Fr,Is=Me(()=>{uo();au();({toStringTag:co,iterator:w_,hasInstance:D_}=Symbol),Hd=Math.random,S_="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Gd=(r,e,t)=>(r+="",/^(Blob|File)$/.test(e&&e[co])?[(t=t!==void 0?t+"":e[co]=="File"?e.name:"blob",r),e.name!==t||e[co]=="blob"?new kr([e],t,e):e]:[r,e+""]),uu=(r,e)=>(e?r:r.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Xr=(r,e,t)=>{if(e.length<t)throw new TypeError(`Failed to execute '${r}' on 'FormData': ${t} arguments required, but only ${e.length} present.`)},Fr=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[co](){return"FormData"}[w_](){return this.entries()}static[D_](e){return e&&typeof e=="object"&&e[co]==="FormData"&&!S_.some(t=>typeof e[t]!="function")}append(...e){Xr("append",arguments,2),this.#e.push(Gd(...e))}delete(e){Xr("delete",arguments,1),e+="",this.#e=this.#e.filter(([t])=>t!==e)}get(e){Xr("get",arguments,1),e+="";for(var t=this.#e,n=t.length,s=0;s<n;s++)if(t[s][0]===e)return t[s][1];return null}getAll(e,t){return Xr("getAll",arguments,1),t=[],e+="",this.#e.forEach(n=>n[0]===e&&t.push(n[1])),t}has(e){return Xr("has",arguments,1),e+="",this.#e.some(t=>t[0]===e)}forEach(e,t){Xr("forEach",arguments,1);for(var[n,s]of this)e.call(t,s,n,this)}set(...e){Xr("set",arguments,2);var t=[],n=!0;e=Gd(...e),this.#e.forEach(s=>{s[0]===e[0]?n&&(n=!t.push(e)):t.push(s)}),n&&t.push(e),this.#e=t}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var fr,js=Me(()=>{fr=class extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var et,cu=Me(()=>{js();et=class extends fr{constructor(e,t,n){super(e,t),n&&(this.code=this.errno=n.code,this.erroredSysCall=n.syscall)}}});var Ls,lu,lo,Jd,zd,Vd,Us=Me(()=>{Ls=Symbol.toStringTag,lu=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[Ls]==="URLSearchParams",lo=r=>r&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[Ls]),Jd=r=>typeof r=="object"&&(r[Ls]==="AbortSignal"||r[Ls]==="EventTarget"),zd=(r,e)=>{let t=new URL(e).hostname,n=new URL(r).hostname;return t===n||t.endsWith(`.${n}`)},Vd=(r,e)=>{let t=new URL(e).protocol,n=new URL(r).protocol;return t===n}});var Yd=J((vD,Kd)=>{if(!globalThis.DOMException)try{let{MessageChannel:r}=X("worker_threads"),e=new r().port1,t=new ArrayBuffer;e.postMessage(t,[t,t])}catch(r){r.constructor.name==="DOMException"&&(globalThis.DOMException=r.constructor)}Kd.exports=globalThis.DOMException});import{statSync as Xd,createReadStream as v_,promises as T_}from"node:fs";import{basename as R_}from"node:path";var Qd,fu,Zd,eh,th,rh,nh,oh,qs,du=Me(()=>{Qd=zr(Yd(),1);au();uo();({stat:fu}=T_),Zd=(r,e)=>nh(Xd(r),r,e),eh=(r,e)=>fu(r).then(t=>nh(t,r,e)),th=(r,e)=>fu(r).then(t=>oh(t,r,e)),rh=(r,e)=>oh(Xd(r),r,e),nh=(r,e,t="")=>new Bt([new qs({path:e,size:r.size,lastModified:r.mtimeMs,start:0})],{type:t}),oh=(r,e,t="")=>new kr([new qs({path:e,size:r.size,lastModified:r.mtimeMs,start:0})],R_(e),{type:t,lastModified:r.mtimeMs}),qs=class r{#e;#t;constructor(e){this.#e=e.path,this.#t=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,t){return new r({path:this.#e,lastModified:this.lastModified,size:t-e,start:this.#t+e})}async*stream(){let{mtimeMs:e}=await fu(this.#e);if(e>this.lastModified)throw new Qd.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*v_(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var ih={};Tf(ih,{toFormData:()=>N_});function B_(r){let e=r.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let t=e[2]||e[3]||"",n=t.slice(t.lastIndexOf("\\")+1);return n=n.replace(/%22/g,'"'),n=n.replace(/&#(\d{4});/g,(s,a)=>String.fromCharCode(a)),n}async function N_(r,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let t=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!t)throw new TypeError("no or bad content-type header, no multipart boundary");let n=new hu(t[1]||t[2]),s,a,u,l,f,h,d=[],_=new Fr,E=b=>{u+=g.decode(b,{stream:!0})},P=b=>{d.push(b)},v=()=>{let b=new kr(d,h,{type:f});_.append(l,b)},A=()=>{_.append(l,u)},g=new TextDecoder("utf-8");g.decode(),n.onPartBegin=function(){n.onPartData=E,n.onPartEnd=A,s="",a="",u="",l="",f="",h=null,d.length=0},n.onHeaderField=function(b){s+=g.decode(b,{stream:!0})},n.onHeaderValue=function(b){a+=g.decode(b,{stream:!0})},n.onHeaderEnd=function(){if(a+=g.decode(),s=s.toLowerCase(),s==="content-disposition"){let b=a.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);b&&(l=b[2]||b[3]||""),h=B_(a),h&&(n.onPartData=P,n.onPartEnd=v)}else s==="content-type"&&(f=a);a="",s=""};for await(let b of r)n.write(b);return n.end(),_}var Wt,ke,sh,Or,Ms,$s,k_,fo,F_,O_,P_,x_,Qr,hu,ah=Me(()=>{du();Is();Wt=0,ke={START_BOUNDARY:Wt++,HEADER_FIELD_START:Wt++,HEADER_FIELD:Wt++,HEADER_VALUE_START:Wt++,HEADER_VALUE:Wt++,HEADER_VALUE_ALMOST_DONE:Wt++,HEADERS_ALMOST_DONE:Wt++,PART_DATA_START:Wt++,PART_DATA:Wt++,END:Wt++},sh=1,Or={PART_BOUNDARY:sh,LAST_BOUNDARY:sh*=2},Ms=10,$s=13,k_=32,fo=45,F_=58,O_=97,P_=122,x_=r=>r|32,Qr=()=>{},hu=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=Qr,this.onHeaderField=Qr,this.onHeadersEnd=Qr,this.onHeaderValue=Qr,this.onPartBegin=Qr,this.onPartData=Qr,this.onPartEnd=Qr,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n),this.boundaryChars[t[n]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=ke.START_BOUNDARY}write(e){let t=0,n=e.length,s=this.index,{lookbehind:a,boundary:u,boundaryChars:l,index:f,state:h,flags:d}=this,_=this.boundary.length,E=_-1,P=e.length,v,A,g=I=>{this[I+"Mark"]=t},b=I=>{delete this[I+"Mark"]},R=(I,L,U,H)=>{(L===void 0||L!==U)&&this[I](H&&H.subarray(L,U))},S=(I,L)=>{let U=I+"Mark";U in this&&(L?(R(I,this[U],t,e),delete this[U]):(R(I,this[U],e.length,e),this[U]=0))};for(t=0;t<n;t++)switch(v=e[t],h){case ke.START_BOUNDARY:if(f===u.length-2){if(v===fo)d|=Or.LAST_BOUNDARY;else if(v!==$s)return;f++;break}else if(f-1===u.length-2){if(d&Or.LAST_BOUNDARY&&v===fo)h=ke.END,d=0;else if(!(d&Or.LAST_BOUNDARY)&&v===Ms)f=0,R("onPartBegin"),h=ke.HEADER_FIELD_START;else return;break}v!==u[f+2]&&(f=-2),v===u[f+2]&&f++;break;case ke.HEADER_FIELD_START:h=ke.HEADER_FIELD,g("onHeaderField"),f=0;case ke.HEADER_FIELD:if(v===$s){b("onHeaderField"),h=ke.HEADERS_ALMOST_DONE;break}if(f++,v===fo)break;if(v===F_){if(f===1)return;S("onHeaderField",!0),h=ke.HEADER_VALUE_START;break}if(A=x_(v),A<O_||A>P_)return;break;case ke.HEADER_VALUE_START:if(v===k_)break;g("onHeaderValue"),h=ke.HEADER_VALUE;case ke.HEADER_VALUE:v===$s&&(S("onHeaderValue",!0),R("onHeaderEnd"),h=ke.HEADER_VALUE_ALMOST_DONE);break;case ke.HEADER_VALUE_ALMOST_DONE:if(v!==Ms)return;h=ke.HEADER_FIELD_START;break;case ke.HEADERS_ALMOST_DONE:if(v!==Ms)return;R("onHeadersEnd"),h=ke.PART_DATA_START;break;case ke.PART_DATA_START:h=ke.PART_DATA,g("onPartData");case ke.PART_DATA:if(s=f,f===0){for(t+=E;t<P&&!(e[t]in l);)t+=_;t-=E,v=e[t]}if(f<u.length)u[f]===v?(f===0&&S("onPartData",!0),f++):f=0;else if(f===u.length)f++,v===$s?d|=Or.PART_BOUNDARY:v===fo?d|=Or.LAST_BOUNDARY:f=0;else if(f-1===u.length)if(d&Or.PART_BOUNDARY){if(f=0,v===Ms){d&=~Or.PART_BOUNDARY,R("onPartEnd"),R("onPartBegin"),h=ke.HEADER_FIELD_START;break}}else d&Or.LAST_BOUNDARY&&v===fo?(R("onPartEnd"),h=ke.END,d=0):f=0;if(f>0)a[f-1]=v;else if(s>0){let I=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);R("onPartData",0,s,I),s=0,g("onPartData"),t--}break;case ke.END:break;default:throw new Error(`Unexpected state entered: ${h}`)}S("onHeaderField"),S("onHeaderValue"),S("onPartData"),this.index=f,this.state=h,this.flags=d}end(){if(this.state===ke.HEADER_FIELD_START&&this.index===0||this.state===ke.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==ke.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});import Pr,{PassThrough as uh}from"node:stream";import{types as ch,deprecate as mu,promisify as I_}from"node:util";import{Buffer as Dt}from"node:buffer";async function pu(r){if(r[it].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[it].disturbed=!0,r[it].error)throw r[it].error;let{body:e}=r;if(e===null)return Dt.alloc(0);if(!(e instanceof Pr))return Dt.alloc(0);let t=[],n=0;try{for await(let s of e){if(r.size>0&&n+s.length>r.size){let a=new et(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw e.destroy(a),a}n+=s.length,t.push(s)}}catch(s){throw s instanceof fr?s:new et(`Invalid response body while trying to fetch ${r.url}: ${s.message}`,"system",s)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(s=>typeof s=="string")?Dt.from(t.join("")):Dt.concat(t,n)}catch(s){throw new et(`Could not create Buffer from response body for ${r.url}: ${s.message}`,"system",s)}else throw new et(`Premature close of server response while trying to fetch ${r.url}`)}var j_,it,Jt,Sn,L_,Hs,lh,fh,Gs=Me(()=>{uo();Is();cu();js();Us();j_=I_(Pr.pipeline),it=Symbol("Body internals"),Jt=class{constructor(e,{size:t=0}={}){let n=null;e===null?e=null:lu(e)?e=Dt.from(e.toString()):lo(e)||Dt.isBuffer(e)||(ch.isAnyArrayBuffer(e)?e=Dt.from(e):ArrayBuffer.isView(e)?e=Dt.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Pr||(e instanceof Fr?(e=Wd(e),n=e.type.split("=")[1]):e=Dt.from(String(e))));let s=e;Dt.isBuffer(e)?s=Pr.Readable.from(e):lo(e)&&(s=Pr.Readable.from(e.stream())),this[it]={body:e,stream:s,boundary:n,disturbed:!1,error:null},this.size=t,e instanceof Pr&&e.on("error",a=>{let u=a instanceof fr?a:new et(`Invalid response body while trying to fetch ${this.url}: ${a.message}`,"system",a);this[it].error=u})}get body(){return this[it].stream}get bodyUsed(){return this[it].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:n}=await pu(this);return e.slice(t,t+n)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let n=new Fr,s=new URLSearchParams(await this.text());for(let[a,u]of s)n.append(a,u);return n}let{toFormData:t}=await Promise.resolve().then(()=>(ah(),ih));return t(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[it].body&&this[it].body.type||"",t=await this.arrayBuffer();return new Bt([t],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await pu(this);return new TextDecoder().decode(e)}buffer(){return pu(this)}};Jt.prototype.buffer=mu(Jt.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(Jt.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:mu(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});Sn=(r,e)=>{let t,n,{body:s}=r[it];if(r.bodyUsed)throw new Error("cannot clone body after it is used");return s instanceof Pr&&typeof s.getBoundary!="function"&&(t=new uh({highWaterMark:e}),n=new uh({highWaterMark:e}),s.pipe(t),s.pipe(n),r[it].stream=t,s=n),s},L_=mu(r=>r.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Hs=(r,e)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":lu(r)?"application/x-www-form-urlencoded;charset=UTF-8":lo(r)?r.type||null:Dt.isBuffer(r)||ch.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r instanceof Fr?`multipart/form-data; boundary=${e[it].boundary}`:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${L_(r)}`:r instanceof Pr?null:"text/plain;charset=UTF-8",lh=r=>{let{body:e}=r[it];return e===null?0:lo(e)?e.size:Dt.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},fh=async(r,{body:e})=>{e===null?r.end():await j_(e,r)}});import{types as dh}from"node:util";import Js from"node:http";function hh(r=[]){return new at(r.reduce((e,t,n,s)=>(n%2===0&&e.push(s.slice(n,n+2)),e),[]).filter(([e,t])=>{try{return Ws(e),gu(e,String(t)),!0}catch{return!1}}))}var Ws,gu,at,zs=Me(()=>{Ws=typeof Js.validateHeaderName=="function"?Js.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){let e=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},gu=typeof Js.validateHeaderValue=="function"?Js.validateHeaderValue:(r,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},at=class r extends URLSearchParams{constructor(e){let t=[];if(e instanceof r){let n=e.raw();for(let[s,a]of Object.entries(n))t.push(...a.map(u=>[s,u]))}else if(e!=null)if(typeof e=="object"&&!dh.isBoxedPrimitive(e)){let n=e[Symbol.iterator];if(n==null)t.push(...Object.entries(e));else{if(typeof n!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(s=>{if(typeof s!="object"||dh.isBoxedPrimitive(s))throw new TypeError("Each header pair must be an iterable object");return[...s]}).map(s=>{if(s.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...s]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return t=t.length>0?t.map(([n,s])=>(Ws(n),gu(n,String(s)),[String(n).toLowerCase(),String(s)])):void 0,super(t),new Proxy(this,{get(n,s,a){switch(s){case"append":case"set":return(u,l)=>(Ws(u),gu(u,String(l)),URLSearchParams.prototype[s].call(n,String(u).toLowerCase(),String(l)));case"delete":case"has":case"getAll":return u=>(Ws(u),URLSearchParams.prototype[s].call(n,String(u).toLowerCase()));case"keys":return()=>(n.sort(),new Set(URLSearchParams.prototype.keys.call(n)).keys());default:return Reflect.get(n,s,a)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let n=t.join(", ");return/^content-encoding$/i.test(e)&&(n=n.toLowerCase()),n}forEach(e,t=void 0){for(let n of this.keys())Reflect.apply(e,t,[this.get(n),n,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let n=this.getAll(t);return t==="host"?e[t]=n[0]:e[t]=n.length>1?n:n[0],e},{})}};Object.defineProperties(at.prototype,["get","entries","forEach","values"].reduce((r,e)=>(r[e]={enumerable:!0},r),{}))});var U_,ho,yu=Me(()=>{U_=new Set([301,302,303,307,308]),ho=r=>U_.has(r)});var Nt,ft,ph=Me(()=>{zs();Gs();yu();Nt=Symbol("Response internals"),ft=class r extends Jt{constructor(e=null,t={}){super(e,t);let n=t.status!=null?t.status:200,s=new at(t.headers);if(e!==null&&!s.has("Content-Type")){let a=Hs(e,this);a&&s.append("Content-Type",a)}this[Nt]={type:"default",url:t.url,status:n,statusText:t.statusText||"",headers:s,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[Nt].type}get url(){return this[Nt].url||""}get status(){return this[Nt].status}get ok(){return this[Nt].status>=200&&this[Nt].status<300}get redirected(){return this[Nt].counter>0}get statusText(){return this[Nt].statusText}get headers(){return this[Nt].headers}get highWaterMark(){return this[Nt].highWaterMark}clone(){return new r(Sn(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!ho(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new r(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new r(null,{status:0,statusText:""});return e[Nt].type="error",e}static json(e=void 0,t={}){let n=JSON.stringify(e);if(n===void 0)throw new TypeError("data is not JSON serializable");let s=new at(t&&t.headers);return s.has("content-type")||s.set("content-type","application/json"),new r(n,{...t,headers:s})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(ft.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var mh,gh=Me(()=>{mh=r=>{if(r.search)return r.search;let e=r.href.length-1,t=r.hash||(r.href[e]==="#"?"#":"");return r.href[e-t.length]==="?"?"?":""}});import{isIP as q_}from"node:net";function yh(r,e=!1){return r==null||(r=new URL(r),/^(about|blob|data):$/.test(r.protocol))?"no-referrer":(r.username="",r.password="",r.hash="",e&&(r.pathname="",r.search=""),r)}function Ch(r){if(!_h.has(r))throw new TypeError(`Invalid referrerPolicy: ${r}`);return r}function M_(r){if(/^(http|ws)s:$/.test(r.protocol))return!0;let e=r.host.replace(/(^\[)|(]$)/g,""),t=q_(e);return t===4&&/^127\./.test(e)||t===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:r.host==="localhost"||r.host.endsWith(".localhost")?!1:r.protocol==="file:"}function vn(r){return/^about:(blank|srcdoc)$/.test(r)||r.protocol==="data:"||/^(blob|filesystem):$/.test(r.protocol)?!0:M_(r)}function Eh(r,{referrerURLCallback:e,referrerOriginCallback:t}={}){if(r.referrer==="no-referrer"||r.referrerPolicy==="")return null;let n=r.referrerPolicy;if(r.referrer==="about:client")return"no-referrer";let s=r.referrer,a=yh(s),u=yh(s,!0);a.toString().length>4096&&(a=u),e&&(a=e(a)),t&&(u=t(u));let l=new URL(r.url);switch(n){case"no-referrer":return"no-referrer";case"origin":return u;case"unsafe-url":return a;case"strict-origin":return vn(a)&&!vn(l)?"no-referrer":u.toString();case"strict-origin-when-cross-origin":return a.origin===l.origin?a:vn(a)&&!vn(l)?"no-referrer":u;case"same-origin":return a.origin===l.origin?a:"no-referrer";case"origin-when-cross-origin":return a.origin===l.origin?a:u;case"no-referrer-when-downgrade":return vn(a)&&!vn(l)?"no-referrer":a;default:throw new TypeError(`Invalid referrerPolicy: ${n}`)}}function Ah(r){let e=(r.get("referrer-policy")||"").split(/[,\s]+/),t="";for(let n of e)n&&_h.has(n)&&(t=n);return t}var _h,bh,_u=Me(()=>{_h=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),bh="strict-origin-when-cross-origin"});import{format as $_}from"node:url";import{deprecate as H_}from"node:util";var Je,po,G_,xr,wh,Dh=Me(()=>{zs();Gs();Us();gh();_u();Je=Symbol("Request internals"),po=r=>typeof r=="object"&&typeof r[Je]=="object",G_=H_(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),xr=class r extends Jt{constructor(e,t={}){let n;if(po(e)?n=new URL(e.url):(n=new URL(e),e={}),n.username!==""||n.password!=="")throw new TypeError(`${n} is an url with embedded credentials.`);let s=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!po(t)&&"data"in t&&G_(),(t.body!=null||po(e)&&e.body!==null)&&(s==="GET"||s==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let a=t.body?t.body:po(e)&&e.body!==null?Sn(e):null;super(a,{size:t.size||e.size||0});let u=new at(t.headers||e.headers||{});if(a!==null&&!u.has("Content-Type")){let h=Hs(a,this);h&&u.set("Content-Type",h)}let l=po(e)?e.signal:null;if("signal"in t&&(l=t.signal),l!=null&&!Jd(l))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let f=t.referrer==null?e.referrer:t.referrer;if(f==="")f="no-referrer";else if(f){let h=new URL(f);f=/^about:(\/\/)?client$/.test(h)?"client":h}else f=void 0;this[Je]={method:s,redirect:t.redirect||e.redirect||"follow",headers:u,parsedURL:n,signal:l,referrer:f},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[Je].method}get url(){return $_(this[Je].parsedURL)}get headers(){return this[Je].headers}get redirect(){return this[Je].redirect}get signal(){return this[Je].signal}get referrer(){if(this[Je].referrer==="no-referrer")return"";if(this[Je].referrer==="client")return"about:client";if(this[Je].referrer)return this[Je].referrer.toString()}get referrerPolicy(){return this[Je].referrerPolicy}set referrerPolicy(e){this[Je].referrerPolicy=Ch(e)}clone(){return new r(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(xr.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});wh=r=>{let{parsedURL:e}=r[Je],t=new at(r[Je].headers);t.has("Accept")||t.set("Accept","*/*");let n=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(n="0"),r.body!==null){let l=lh(r);typeof l=="number"&&!Number.isNaN(l)&&(n=String(l))}n&&t.set("Content-Length",n),r.referrerPolicy===""&&(r.referrerPolicy=bh),r.referrer&&r.referrer!=="no-referrer"?r[Je].referrer=Eh(r):r[Je].referrer="no-referrer",r[Je].referrer instanceof URL&&t.set("Referer",r.referrer),t.has("User-Agent")||t.set("User-Agent","node-fetch"),r.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip, deflate, br");let{agent:s}=r;typeof s=="function"&&(s=s(e));let a=mh(e),u={path:e.pathname+a,method:r.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:s};return{parsedURL:e,options:u}}});var mo,Sh=Me(()=>{js();mo=class extends fr{constructor(e,t="aborted"){super(e,t)}}});var Rh={};Tf(Rh,{AbortError:()=>mo,Blob:()=>Bt,FetchError:()=>et,File:()=>kr,FormData:()=>Fr,Headers:()=>at,Request:()=>xr,Response:()=>ft,blobFrom:()=>eh,blobFromSync:()=>Zd,default:()=>bu,fileFrom:()=>th,fileFromSync:()=>rh,isRedirect:()=>ho});import W_ from"node:http";import J_ from"node:https";import Tn from"node:zlib";import vh,{PassThrough as Th,pipeline as Rn}from"node:stream";import{Buffer as Vs}from"node:buffer";async function bu(r,e){return new Promise((t,n)=>{let s=new xr(r,e),{parsedURL:a,options:u}=wh(s);if(!z_.has(a.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${a.protocol.replace(/:$/,"")}" is not supported.`);if(a.protocol==="data:"){let v=Id(s.url),A=new ft(v,{headers:{"Content-Type":v.typeFull}});t(A);return}let l=(a.protocol==="https:"?J_:W_).request,{signal:f}=s,h=null,d=()=>{let v=new mo("The operation was aborted.");n(v),s.body&&s.body instanceof vh.Readable&&s.body.destroy(v),!(!h||!h.body)&&h.body.emit("error",v)};if(f&&f.aborted){d();return}let _=()=>{d(),P()},E=l(a.toString(),u);f&&f.addEventListener("abort",_);let P=()=>{E.abort(),f&&f.removeEventListener("abort",_)};E.on("error",v=>{n(new et(`request to ${s.url} failed, reason: ${v.message}`,"system",v)),P()}),V_(E,v=>{h&&h.body&&h.body.destroy(v)}),process.version<"v14"&&E.on("socket",v=>{let A;v.prependListener("end",()=>{A=v._eventsCount}),v.prependListener("close",g=>{if(h&&A<v._eventsCount&&!g){let b=new Error("Premature close");b.code="ERR_STREAM_PREMATURE_CLOSE",h.body.emit("error",b)}})}),E.on("response",v=>{E.setTimeout(0);let A=hh(v.rawHeaders);if(ho(v.statusCode)){let I=A.get("Location"),L=null;try{L=I===null?null:new URL(I,s.url)}catch{if(s.redirect!=="manual"){n(new et(`uri requested responds with an invalid redirect URL: ${I}`,"invalid-redirect")),P();return}}switch(s.redirect){case"error":n(new et(`uri requested responds with a redirect, redirect mode is set to error: ${s.url}`,"no-redirect")),P();return;case"manual":break;case"follow":{if(L===null)break;if(s.counter>=s.follow){n(new et(`maximum redirect reached at: ${s.url}`,"max-redirect")),P();return}let U={headers:new at(s.headers),follow:s.follow,counter:s.counter+1,agent:s.agent,compress:s.compress,method:s.method,body:Sn(s),signal:s.signal,size:s.size,referrer:s.referrer,referrerPolicy:s.referrerPolicy};if(!zd(s.url,L)||!Vd(s.url,L))for(let K of["authorization","www-authenticate","cookie","cookie2"])U.headers.delete(K);if(v.statusCode!==303&&s.body&&e.body instanceof vh.Readable){n(new et("Cannot follow redirect with body being a readable stream","unsupported-redirect")),P();return}(v.statusCode===303||(v.statusCode===301||v.statusCode===302)&&s.method==="POST")&&(U.method="GET",U.body=void 0,U.headers.delete("content-length"));let H=Ah(A);H&&(U.referrerPolicy=H),t(bu(new xr(L,U))),P();return}default:return n(new TypeError(`Redirect option '${s.redirect}' is not a valid value of RequestRedirect`))}}f&&v.once("end",()=>{f.removeEventListener("abort",_)});let g=Rn(v,new Th,I=>{I&&n(I)});process.version<"v12.10"&&v.on("aborted",_);let b={url:s.url,status:v.statusCode,statusText:v.statusMessage,headers:A,size:s.size,counter:s.counter,highWaterMark:s.highWaterMark},R=A.get("Content-Encoding");if(!s.compress||s.method==="HEAD"||R===null||v.statusCode===204||v.statusCode===304){h=new ft(g,b),t(h);return}let S={flush:Tn.Z_SYNC_FLUSH,finishFlush:Tn.Z_SYNC_FLUSH};if(R==="gzip"||R==="x-gzip"){g=Rn(g,Tn.createGunzip(S),I=>{I&&n(I)}),h=new ft(g,b),t(h);return}if(R==="deflate"||R==="x-deflate"){let I=Rn(v,new Th,L=>{L&&n(L)});I.once("data",L=>{(L[0]&15)===8?g=Rn(g,Tn.createInflate(),U=>{U&&n(U)}):g=Rn(g,Tn.createInflateRaw(),U=>{U&&n(U)}),h=new ft(g,b),t(h)}),I.once("end",()=>{h||(h=new ft(g,b),t(h))});return}if(R==="br"){g=Rn(g,Tn.createBrotliDecompress(),I=>{I&&n(I)}),h=new ft(g,b),t(h);return}h=new ft(g,b),t(h)}),fh(E,s).catch(n)})}function V_(r,e){let t=Vs.from(`0\r
\r
`),n=!1,s=!1,a;r.on("response",u=>{let{headers:l}=u;n=l["transfer-encoding"]==="chunked"&&!l["content-length"]}),r.on("socket",u=>{let l=()=>{if(n&&!s){let h=new Error("Premature close");h.code="ERR_STREAM_PREMATURE_CLOSE",e(h)}},f=h=>{s=Vs.compare(h.slice(-5),t)===0,!s&&a&&(s=Vs.compare(a.slice(-3),t.slice(0,3))===0&&Vs.compare(h.slice(-2),t.slice(3))===0),a=h};u.prependListener("close",l),u.on("data",f),r.on("close",()=>{u.removeListener("close",l),u.removeListener("data",f)})})}var z_,kh=Me(()=>{jd();Gs();ph();zs();Dh();cu();Sh();yu();Is();Us();_u();du();z_=new Set(["data:","http:","https:"])});var Ph=J(Fn=>{"use strict";var K_=Fn&&Fn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},kn;Object.defineProperty(Fn,"__esModule",{value:!0});Fn.Gaxios=void 0;var Y_=K_(Ja()),X_=X("https"),Zr=Ka(),Q_=ld(),Fh=X("stream"),Oh=Qa(),Z_=async()=>globalThis.crypto?.randomUUID()||(await import("crypto")).randomUUID(),Ks=class{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new Oh.GaxiosInterceptorManager,response:new Oh.GaxiosInterceptorManager}}fetch(...e){let t=e[0],n=e[1],s,a=new Headers;return typeof t=="string"?s=new URL(t):t instanceof URL?s=t:t&&t.url&&(s=new URL(t.url)),t&&typeof t=="object"&&"headers"in t&&kn.mergeHeaders(a,t.headers),n&&kn.mergeHeaders(a,new Headers(n.headers)),typeof t=="object"&&!(t instanceof URL)?this.request({...n,...t,headers:a,url:s}):this.request({...n,headers:a,url:s})}async request(e={}){let t=await this.#n(e);return t=await this.#t(t),this.#r(this._request(t))}async _defaultAdapter(e){let t=e.fetchImplementation||this.defaults.fetchImplementation||await kn.#u(),n={...e};delete n.data;let s=await t(e.url,n),a=await this.getResponseData(e,s);return Object.getOwnPropertyDescriptor(s,"data")?.configurable||Object.defineProperties(s,{data:{configurable:!0,writable:!0,enumerable:!0,value:a}}),Object.assign(s,{config:e,data:a})}async _request(e){try{let t;if(e.adapter?t=await e.adapter(e,this._defaultAdapter.bind(this)):t=await this._defaultAdapter(e),!e.validateStatus(t.status)){if(e.responseType==="stream"){let s=[];for await(let a of e.data??[])s.push(a);t.data=s}let n=Zr.GaxiosError.extractAPIErrorFromResponse(t,`Request failed with status code ${t.status}`);throw new Zr.GaxiosError(n?.message,e,t,n)}return t}catch(t){let n;t instanceof Zr.GaxiosError?n=t:t instanceof Error?n=new Zr.GaxiosError(t.message,e,void 0,t):n=new Zr.GaxiosError("Unexpected Gaxios Error",e,void 0,t);let{shouldRetry:s,config:a}=await(0,Q_.getRetryConfig)(n);if(s&&a)return n.config.retryConfig.currentRetryAttempt=a.retryConfig.currentRetryAttempt,e.retryConfig=n.config?.retryConfig,this.#o(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(n),n}}async getResponseData(e,t){if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(t.headers?.get("content-length")||""))throw new Zr.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":return t.json();case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}#e(e,t=[]){let n=new URL(e),s=[...t],a=(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[];for(let u of a)s.push(u.trim());for(let u of s)if(u instanceof RegExp){if(u.test(n.toString()))return!1}else if(u instanceof URL){if(u.origin===n.origin)return!1}else if(u.startsWith("*.")||u.startsWith(".")){let l=u.replace(/^\*\./,".");if(n.hostname.endsWith(l))return!1}else if(u===n.origin||u===n.hostname||u===n.href)return!1;return!0}async#t(e){let t=Promise.resolve(e);for(let n of this.interceptors.request.values())n&&(t=t.then(n.resolved,n.rejected));return t}async#r(e){let t=Promise.resolve(e);for(let n of this.interceptors.response.values())n&&(t=t.then(n.resolved,n.rejected));return t}async#n(e){let t=new Headers(this.defaults.headers);kn.mergeHeaders(t,e.headers);let n=(0,Y_.default)(!0,{},this.defaults,e);if(!n.url)throw new Error("URL is required.");if(n.baseURL&&(n.url=new URL(n.url,n.baseURL)),n.url=new URL(n.url),n.params)if(n.paramsSerializer){let u=n.paramsSerializer(n.params);u.startsWith("?")&&(u=u.slice(1));let l=n.url.toString().includes("?")?"&":"?";n.url=n.url+l+u}else{let u=n.url instanceof URL?n.url:new URL(n.url);for(let[l,f]of new URLSearchParams(n.params))u.searchParams.append(l,f);n.url=u}typeof e.maxContentLength=="number"&&(n.size=e.maxContentLength),typeof e.maxRedirects=="number"&&(n.follow=e.maxRedirects);let s=typeof n.data=="string"||n.data instanceof ArrayBuffer||n.data instanceof Blob||globalThis.File&&n.data instanceof File||n.data instanceof FormData||n.data instanceof Fh.Readable||n.data instanceof ReadableStream||n.data instanceof String||n.data instanceof URLSearchParams||ArrayBuffer.isView(n.data)||["Blob","File","FormData"].includes(n.data?.constructor?.name||"");if(n.multipart?.length){let u=await Z_();t.set("content-type",`multipart/related; boundary=${u}`),n.body=Fh.Readable.from(this.getMultipartRequest(n.multipart,u))}else s?n.body=n.data:typeof n.data=="object"?t.get("Content-Type")==="application/x-www-form-urlencoded"?n.body=n.paramsSerializer?n.paramsSerializer(n.data):new URLSearchParams(n.data):(t.has("content-type")||t.set("content-type","application/json"),n.body=JSON.stringify(n.data)):n.data&&(n.body=n.data);n.validateStatus=n.validateStatus||this.validateStatus,n.responseType=n.responseType||"unknown",!t.has("accept")&&n.responseType==="json"&&t.set("accept","application/json");let a=n.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(!n.agent)if(a&&this.#e(n.url,n.noProxy)){let u=await kn.#a();this.agentCache.has(a)?n.agent=this.agentCache.get(a):(n.agent=new u(a,{cert:n.cert,key:n.key}),this.agentCache.set(a,n.agent))}else n.cert&&n.key&&(this.agentCache.has(n.key)?n.agent=this.agentCache.get(n.key):(n.agent=new X_.Agent({cert:n.cert,key:n.key}),this.agentCache.set(n.key,n.agent)));return typeof n.errorRedactor!="function"&&n.errorRedactor!==!1&&(n.errorRedactor=Zr.defaultErrorRedactor),n.body&&!("duplex"in n)&&(n.duplex="half"),this.#o(n),Object.assign(n,{headers:t,url:n.url instanceof URL?n.url:new URL(n.url)})}#o(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(t===null)return e.text();if(t=t.toLowerCase(),t.includes("application/json")){let n=await e.text();try{n=JSON.parse(n)}catch{}return n}else return t.match(/^text\//)?e.text():e.blob()}async*getMultipartRequest(e,t){let n=`--${t}--`;for(let s of e){let a=s.headers.get("Content-Type")||"application/octet-stream";yield`--${t}\r
Content-Type: ${a}\r
\r
`,typeof s.content=="string"?yield s.content:yield*s.content,yield`\r
`}yield n}static#s;static#i;static async#a(){return this.#s||=(await Promise.resolve().then(()=>zr(Nd()))).HttpsProxyAgent,this.#s}static async#u(){let e=typeof window<"u"&&!!window;return this.#i||=e?window.fetch:(await Promise.resolve().then(()=>(kh(),Rh))).default,this.#i}static mergeHeaders(e,...t){e=e instanceof Headers?e:new Headers(e);for(let n of t)(n instanceof Headers?n:new Headers(n)).forEach((a,u)=>{u==="set-cookie"?e.append(u,a):e.set(u,a)});return e}};Fn.Gaxios=Ks;kn=Ks});var Ve=J(tt=>{"use strict";var eb=tt&&tt.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),tb=tt&&tt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&eb(e,r,t)};Object.defineProperty(tt,"__esModule",{value:!0});tt.instance=tt.Gaxios=tt.GaxiosError=void 0;tt.request=nb;var xh=Ph();Object.defineProperty(tt,"Gaxios",{enumerable:!0,get:function(){return xh.Gaxios}});var rb=Ka();Object.defineProperty(tt,"GaxiosError",{enumerable:!0,get:function(){return rb.GaxiosError}});tb(Qa(),tt);tt.instance=new xh.Gaxios;async function nb(r){return tt.instance.request(r)}});var Cu=J((Bh,Ys)=>{(function(r){"use strict";var e,t=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,n=Math.ceil,s=Math.floor,a="[BigNumber Error] ",u=a+"Number primitive has more than 15 significant digits: ",l=1e14,f=14,h=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],_=1e7,E=1e9;function P(L){var U,H,K,W=G.prototype={constructor:G,toString:null,valueOf:null},we=new G(1),he=20,fe=4,ye=-7,re=21,de=-1e7,Z=1e7,ue=!1,z=1,oe=0,se={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Ne="0123456789abcdefghijklmnopqrstuvwxyz",Le=!0;function G(p,y){var C,x,T,F,j,D,k,B,O=this;if(!(O instanceof G))return new G(p,y);if(y==null){if(p&&p._isBigNumber===!0){O.s=p.s,!p.c||p.e>Z?O.c=O.e=null:p.e<de?O.c=[O.e=0]:(O.e=p.e,O.c=p.c.slice());return}if((D=typeof p=="number")&&p*0==0){if(O.s=1/p<0?(p=-p,-1):1,p===~~p){for(F=0,j=p;j>=10;j/=10,F++);F>Z?O.c=O.e=null:(O.e=F,O.c=[p]);return}B=String(p)}else{if(!t.test(B=String(p)))return K(O,B,D);O.s=B.charCodeAt(0)==45?(B=B.slice(1),-1):1}(F=B.indexOf("."))>-1&&(B=B.replace(".","")),(j=B.search(/e/i))>0?(F<0&&(F=j),F+=+B.slice(j+1),B=B.substring(0,j)):F<0&&(F=B.length)}else{if(b(y,2,Ne.length,"Base"),y==10&&Le)return O=new G(p),xe(O,he+O.e+1,fe);if(B=String(p),D=typeof p=="number"){if(p*0!=0)return K(O,B,D,y);if(O.s=1/p<0?(B=B.slice(1),-1):1,G.DEBUG&&B.replace(/^0\.0*|\./,"").length>15)throw Error(u+p)}else O.s=B.charCodeAt(0)===45?(B=B.slice(1),-1):1;for(C=Ne.slice(0,y),F=j=0,k=B.length;j<k;j++)if(C.indexOf(x=B.charAt(j))<0){if(x=="."){if(j>F){F=k;continue}}else if(!T&&(B==B.toUpperCase()&&(B=B.toLowerCase())||B==B.toLowerCase()&&(B=B.toUpperCase()))){T=!0,j=-1,F=0;continue}return K(O,String(p),D,y)}D=!1,B=H(B,y,10,O.s),(F=B.indexOf("."))>-1?B=B.replace(".",""):F=B.length}for(j=0;B.charCodeAt(j)===48;j++);for(k=B.length;B.charCodeAt(--k)===48;);if(B=B.slice(j,++k)){if(k-=j,D&&G.DEBUG&&k>15&&(p>h||p!==s(p)))throw Error(u+O.s*p);if((F=F-j-1)>Z)O.c=O.e=null;else if(F<de)O.c=[O.e=0];else{if(O.e=F,O.c=[],j=(F+1)%f,F<0&&(j+=f),j<k){for(j&&O.c.push(+B.slice(0,j)),k-=f;j<k;)O.c.push(+B.slice(j,j+=f));j=f-(B=B.slice(j)).length}else j-=k;for(;j--;B+="0");O.c.push(+B)}}else O.c=[O.e=0]}G.clone=P,G.ROUND_UP=0,G.ROUND_DOWN=1,G.ROUND_CEIL=2,G.ROUND_FLOOR=3,G.ROUND_HALF_UP=4,G.ROUND_HALF_DOWN=5,G.ROUND_HALF_EVEN=6,G.ROUND_HALF_CEIL=7,G.ROUND_HALF_FLOOR=8,G.EUCLID=9,G.config=G.set=function(p){var y,C;if(p!=null)if(typeof p=="object"){if(p.hasOwnProperty(y="DECIMAL_PLACES")&&(C=p[y],b(C,0,E,y),he=C),p.hasOwnProperty(y="ROUNDING_MODE")&&(C=p[y],b(C,0,8,y),fe=C),p.hasOwnProperty(y="EXPONENTIAL_AT")&&(C=p[y],C&&C.pop?(b(C[0],-E,0,y),b(C[1],0,E,y),ye=C[0],re=C[1]):(b(C,-E,E,y),ye=-(re=C<0?-C:C))),p.hasOwnProperty(y="RANGE"))if(C=p[y],C&&C.pop)b(C[0],-E,-1,y),b(C[1],1,E,y),de=C[0],Z=C[1];else if(b(C,-E,E,y),C)de=-(Z=C<0?-C:C);else throw Error(a+y+" cannot be zero: "+C);if(p.hasOwnProperty(y="CRYPTO"))if(C=p[y],C===!!C)if(C)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))ue=C;else throw ue=!C,Error(a+"crypto unavailable");else ue=C;else throw Error(a+y+" not true or false: "+C);if(p.hasOwnProperty(y="MODULO_MODE")&&(C=p[y],b(C,0,9,y),z=C),p.hasOwnProperty(y="POW_PRECISION")&&(C=p[y],b(C,0,E,y),oe=C),p.hasOwnProperty(y="FORMAT"))if(C=p[y],typeof C=="object")se=C;else throw Error(a+y+" not an object: "+C);if(p.hasOwnProperty(y="ALPHABET"))if(C=p[y],typeof C=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(C))Le=C.slice(0,10)=="0123456789",Ne=C;else throw Error(a+y+" invalid: "+C)}else throw Error(a+"Object expected: "+p);return{DECIMAL_PLACES:he,ROUNDING_MODE:fe,EXPONENTIAL_AT:[ye,re],RANGE:[de,Z],CRYPTO:ue,MODULO_MODE:z,POW_PRECISION:oe,FORMAT:se,ALPHABET:Ne}},G.isBigNumber=function(p){if(!p||p._isBigNumber!==!0)return!1;if(!G.DEBUG)return!0;var y,C,x=p.c,T=p.e,F=p.s;e:if({}.toString.call(x)=="[object Array]"){if((F===1||F===-1)&&T>=-E&&T<=E&&T===s(T)){if(x[0]===0){if(T===0&&x.length===1)return!0;break e}if(y=(T+1)%f,y<1&&(y+=f),String(x[0]).length==y){for(y=0;y<x.length;y++)if(C=x[y],C<0||C>=l||C!==s(C))break e;if(C!==0)return!0}}}else if(x===null&&T===null&&(F===null||F===1||F===-1))return!0;throw Error(a+"Invalid BigNumber: "+p)},G.maximum=G.max=function(){return Ee(arguments,-1)},G.minimum=G.min=function(){return Ee(arguments,1)},G.random=(function(){var p=9007199254740992,y=Math.random()*p&2097151?function(){return s(Math.random()*p)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(C){var x,T,F,j,D,k=0,B=[],O=new G(we);if(C==null?C=he:b(C,0,E),j=n(C/f),ue)if(crypto.getRandomValues){for(x=crypto.getRandomValues(new Uint32Array(j*=2));k<j;)D=x[k]*131072+(x[k+1]>>>11),D>=9e15?(T=crypto.getRandomValues(new Uint32Array(2)),x[k]=T[0],x[k+1]=T[1]):(B.push(D%1e14),k+=2);k=j/2}else if(crypto.randomBytes){for(x=crypto.randomBytes(j*=7);k<j;)D=(x[k]&31)*281474976710656+x[k+1]*1099511627776+x[k+2]*4294967296+x[k+3]*16777216+(x[k+4]<<16)+(x[k+5]<<8)+x[k+6],D>=9e15?crypto.randomBytes(7).copy(x,k):(B.push(D%1e14),k+=7);k=j/7}else throw ue=!1,Error(a+"crypto unavailable");if(!ue)for(;k<j;)D=y(),D<9e15&&(B[k++]=D%1e14);for(j=B[--k],C%=f,j&&C&&(D=d[f-C],B[k]=s(j/D)*D);B[k]===0;B.pop(),k--);if(k<0)B=[F=0];else{for(F=-1;B[0]===0;B.splice(0,1),F-=f);for(k=1,D=B[0];D>=10;D/=10,k++);k<f&&(F-=f-k)}return O.e=F,O.c=B,O}})(),G.sum=function(){for(var p=1,y=arguments,C=new G(y[0]);p<y.length;)C=C.plus(y[p++]);return C},H=(function(){var p="0123456789";function y(C,x,T,F){for(var j,D=[0],k,B=0,O=C.length;B<O;){for(k=D.length;k--;D[k]*=x);for(D[0]+=F.indexOf(C.charAt(B++)),j=0;j<D.length;j++)D[j]>T-1&&(D[j+1]==null&&(D[j+1]=0),D[j+1]+=D[j]/T|0,D[j]%=T)}return D.reverse()}return function(C,x,T,F,j){var D,k,B,O,M,Y,Q,Ae,Fe=C.indexOf("."),Be=he,Ce=fe;for(Fe>=0&&(O=oe,oe=0,C=C.replace(".",""),Ae=new G(x),Y=Ae.pow(C.length-Fe),oe=O,Ae.c=y(I(A(Y.c),Y.e,"0"),10,T,p),Ae.e=Ae.c.length),Q=y(C,x,T,j?(D=Ne,p):(D=p,Ne)),B=O=Q.length;Q[--O]==0;Q.pop());if(!Q[0])return D.charAt(0);if(Fe<0?--B:(Y.c=Q,Y.e=B,Y.s=F,Y=U(Y,Ae,Be,Ce,T),Q=Y.c,M=Y.r,B=Y.e),k=B+Be+1,Fe=Q[k],O=T/2,M=M||k<0||Q[k+1]!=null,M=Ce<4?(Fe!=null||M)&&(Ce==0||Ce==(Y.s<0?3:2)):Fe>O||Fe==O&&(Ce==4||M||Ce==6&&Q[k-1]&1||Ce==(Y.s<0?8:7)),k<1||!Q[0])C=M?I(D.charAt(1),-Be,D.charAt(0)):D.charAt(0);else{if(Q.length=k,M)for(--T;++Q[--k]>T;)Q[k]=0,k||(++B,Q=[1].concat(Q));for(O=Q.length;!Q[--O];);for(Fe=0,C="";Fe<=O;C+=D.charAt(Q[Fe++]));C=I(C,B,D.charAt(0))}return C}})(),U=(function(){function p(x,T,F){var j,D,k,B,O=0,M=x.length,Y=T%_,Q=T/_|0;for(x=x.slice();M--;)k=x[M]%_,B=x[M]/_|0,j=Q*k+B*Y,D=Y*k+j%_*_+O,O=(D/F|0)+(j/_|0)+Q*B,x[M]=D%F;return O&&(x=[O].concat(x)),x}function y(x,T,F,j){var D,k;if(F!=j)k=F>j?1:-1;else for(D=k=0;D<F;D++)if(x[D]!=T[D]){k=x[D]>T[D]?1:-1;break}return k}function C(x,T,F,j){for(var D=0;F--;)x[F]-=D,D=x[F]<T[F]?1:0,x[F]=D*j+x[F]-T[F];for(;!x[0]&&x.length>1;x.splice(0,1));}return function(x,T,F,j,D){var k,B,O,M,Y,Q,Ae,Fe,Be,Ce,De,Ue,sn,an,un,ut,tr,Ke=x.s==T.s?1:-1,qe=x.c,Se=T.c;if(!qe||!qe[0]||!Se||!Se[0])return new G(!x.s||!T.s||(qe?Se&&qe[0]==Se[0]:!Se)?NaN:qe&&qe[0]==0||!Se?Ke*0:Ke/0);for(Fe=new G(Ke),Be=Fe.c=[],B=x.e-T.e,Ke=F+B+1,D||(D=l,B=v(x.e/f)-v(T.e/f),Ke=Ke/f|0),O=0;Se[O]==(qe[O]||0);O++);if(Se[O]>(qe[O]||0)&&B--,Ke<0)Be.push(1),M=!0;else{for(an=qe.length,ut=Se.length,O=0,Ke+=2,Y=s(D/(Se[0]+1)),Y>1&&(Se=p(Se,Y,D),qe=p(qe,Y,D),ut=Se.length,an=qe.length),sn=ut,Ce=qe.slice(0,ut),De=Ce.length;De<ut;Ce[De++]=0);tr=Se.slice(),tr=[0].concat(tr),un=Se[0],Se[1]>=D/2&&un++;do{if(Y=0,k=y(Se,Ce,ut,De),k<0){if(Ue=Ce[0],ut!=De&&(Ue=Ue*D+(Ce[1]||0)),Y=s(Ue/un),Y>1)for(Y>=D&&(Y=D-1),Q=p(Se,Y,D),Ae=Q.length,De=Ce.length;y(Q,Ce,Ae,De)==1;)Y--,C(Q,ut<Ae?tr:Se,Ae,D),Ae=Q.length,k=1;else Y==0&&(k=Y=1),Q=Se.slice(),Ae=Q.length;if(Ae<De&&(Q=[0].concat(Q)),C(Ce,Q,De,D),De=Ce.length,k==-1)for(;y(Se,Ce,ut,De)<1;)Y++,C(Ce,ut<De?tr:Se,De,D),De=Ce.length}else k===0&&(Y++,Ce=[0]);Be[O++]=Y,Ce[0]?Ce[De++]=qe[sn]||0:(Ce=[qe[sn]],De=1)}while((sn++<an||Ce[0]!=null)&&Ke--);M=Ce[0]!=null,Be[0]||Be.splice(0,1)}if(D==l){for(O=1,Ke=Be[0];Ke>=10;Ke/=10,O++);xe(Fe,F+(Fe.e=O+B*f-1)+1,j,M)}else Fe.e=B,Fe.r=+M;return Fe}})();function pe(p,y,C,x){var T,F,j,D,k;if(C==null?C=fe:b(C,0,8),!p.c)return p.toString();if(T=p.c[0],j=p.e,y==null)k=A(p.c),k=x==1||x==2&&(j<=ye||j>=re)?S(k,j):I(k,j,"0");else if(p=xe(new G(p),y,C),F=p.e,k=A(p.c),D=k.length,x==1||x==2&&(y<=F||F<=ye)){for(;D<y;k+="0",D++);k=S(k,F)}else if(y-=j+(x===2&&F>j),k=I(k,F,"0"),F+1>D){if(--y>0)for(k+=".";y--;k+="0");}else if(y+=F-D,y>0)for(F+1==D&&(k+=".");y--;k+="0");return p.s<0&&T?"-"+k:k}function Ee(p,y){for(var C,x,T=1,F=new G(p[0]);T<p.length;T++)x=new G(p[T]),(!x.s||(C=g(F,x))===y||C===0&&F.s===y)&&(F=x);return F}function er(p,y,C){for(var x=1,T=y.length;!y[--T];y.pop());for(T=y[0];T>=10;T/=10,x++);return(C=x+C*f-1)>Z?p.c=p.e=null:C<de?p.c=[p.e=0]:(p.e=C,p.c=y),p}K=(function(){var p=/^(-?)0([xbo])(?=\w[\w.]*$)/i,y=/^([^.]+)\.$/,C=/^\.([^.]+)$/,x=/^-?(Infinity|NaN)$/,T=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(F,j,D,k){var B,O=D?j:j.replace(T,"");if(x.test(O))F.s=isNaN(O)?null:O<0?-1:1;else{if(!D&&(O=O.replace(p,function(M,Y,Q){return B=(Q=Q.toLowerCase())=="x"?16:Q=="b"?2:8,!k||k==B?Y:M}),k&&(B=k,O=O.replace(y,"$1").replace(C,"0.$1")),j!=O))return new G(O,B);if(G.DEBUG)throw Error(a+"Not a"+(k?" base "+k:"")+" number: "+j);F.s=null}F.c=F.e=null}})();function xe(p,y,C,x){var T,F,j,D,k,B,O,M=p.c,Y=d;if(M){e:{for(T=1,D=M[0];D>=10;D/=10,T++);if(F=y-T,F<0)F+=f,j=y,k=M[B=0],O=s(k/Y[T-j-1]%10);else if(B=n((F+1)/f),B>=M.length)if(x){for(;M.length<=B;M.push(0));k=O=0,T=1,F%=f,j=F-f+1}else break e;else{for(k=D=M[B],T=1;D>=10;D/=10,T++);F%=f,j=F-f+T,O=j<0?0:s(k/Y[T-j-1]%10)}if(x=x||y<0||M[B+1]!=null||(j<0?k:k%Y[T-j-1]),x=C<4?(O||x)&&(C==0||C==(p.s<0?3:2)):O>5||O==5&&(C==4||x||C==6&&(F>0?j>0?k/Y[T-j]:0:M[B-1])%10&1||C==(p.s<0?8:7)),y<1||!M[0])return M.length=0,x?(y-=p.e+1,M[0]=Y[(f-y%f)%f],p.e=-y||0):M[0]=p.e=0,p;if(F==0?(M.length=B,D=1,B--):(M.length=B+1,D=Y[f-F],M[B]=j>0?s(k/Y[T-j]%Y[j])*D:0),x)for(;;)if(B==0){for(F=1,j=M[0];j>=10;j/=10,F++);for(j=M[0]+=D,D=1;j>=10;j/=10,D++);F!=D&&(p.e++,M[0]==l&&(M[0]=1));break}else{if(M[B]+=D,M[B]!=l)break;M[B--]=0,D=1}for(F=M.length;M[--F]===0;M.pop());}p.e>Z?p.c=p.e=null:p.e<de&&(p.c=[p.e=0])}return p}function Ie(p){var y,C=p.e;return C===null?p.toString():(y=A(p.c),y=C<=ye||C>=re?S(y,C):I(y,C,"0"),p.s<0?"-"+y:y)}return W.absoluteValue=W.abs=function(){var p=new G(this);return p.s<0&&(p.s=1),p},W.comparedTo=function(p,y){return g(this,new G(p,y))},W.decimalPlaces=W.dp=function(p,y){var C,x,T,F=this;if(p!=null)return b(p,0,E),y==null?y=fe:b(y,0,8),xe(new G(F),p+F.e+1,y);if(!(C=F.c))return null;if(x=((T=C.length-1)-v(this.e/f))*f,T=C[T])for(;T%10==0;T/=10,x--);return x<0&&(x=0),x},W.dividedBy=W.div=function(p,y){return U(this,new G(p,y),he,fe)},W.dividedToIntegerBy=W.idiv=function(p,y){return U(this,new G(p,y),0,1)},W.exponentiatedBy=W.pow=function(p,y){var C,x,T,F,j,D,k,B,O,M=this;if(p=new G(p),p.c&&!p.isInteger())throw Error(a+"Exponent not an integer: "+Ie(p));if(y!=null&&(y=new G(y)),D=p.e>14,!M.c||!M.c[0]||M.c[0]==1&&!M.e&&M.c.length==1||!p.c||!p.c[0])return O=new G(Math.pow(+Ie(M),D?p.s*(2-R(p)):+Ie(p))),y?O.mod(y):O;if(k=p.s<0,y){if(y.c?!y.c[0]:!y.s)return new G(NaN);x=!k&&M.isInteger()&&y.isInteger(),x&&(M=M.mod(y))}else{if(p.e>9&&(M.e>0||M.e<-1||(M.e==0?M.c[0]>1||D&&M.c[1]>=24e7:M.c[0]<8e13||D&&M.c[0]<=9999975e7)))return F=M.s<0&&R(p)?-0:0,M.e>-1&&(F=1/F),new G(k?1/F:F);oe&&(F=n(oe/f+2))}for(D?(C=new G(.5),k&&(p.s=1),B=R(p)):(T=Math.abs(+Ie(p)),B=T%2),O=new G(we);;){if(B){if(O=O.times(M),!O.c)break;F?O.c.length>F&&(O.c.length=F):x&&(O=O.mod(y))}if(T){if(T=s(T/2),T===0)break;B=T%2}else if(p=p.times(C),xe(p,p.e+1,1),p.e>14)B=R(p);else{if(T=+Ie(p),T===0)break;B=T%2}M=M.times(M),F?M.c&&M.c.length>F&&(M.c.length=F):x&&(M=M.mod(y))}return x?O:(k&&(O=we.div(O)),y?O.mod(y):F?xe(O,oe,fe,j):O)},W.integerValue=function(p){var y=new G(this);return p==null?p=fe:b(p,0,8),xe(y,y.e+1,p)},W.isEqualTo=W.eq=function(p,y){return g(this,new G(p,y))===0},W.isFinite=function(){return!!this.c},W.isGreaterThan=W.gt=function(p,y){return g(this,new G(p,y))>0},W.isGreaterThanOrEqualTo=W.gte=function(p,y){return(y=g(this,new G(p,y)))===1||y===0},W.isInteger=function(){return!!this.c&&v(this.e/f)>this.c.length-2},W.isLessThan=W.lt=function(p,y){return g(this,new G(p,y))<0},W.isLessThanOrEqualTo=W.lte=function(p,y){return(y=g(this,new G(p,y)))===-1||y===0},W.isNaN=function(){return!this.s},W.isNegative=function(){return this.s<0},W.isPositive=function(){return this.s>0},W.isZero=function(){return!!this.c&&this.c[0]==0},W.minus=function(p,y){var C,x,T,F,j=this,D=j.s;if(p=new G(p,y),y=p.s,!D||!y)return new G(NaN);if(D!=y)return p.s=-y,j.plus(p);var k=j.e/f,B=p.e/f,O=j.c,M=p.c;if(!k||!B){if(!O||!M)return O?(p.s=-y,p):new G(M?j:NaN);if(!O[0]||!M[0])return M[0]?(p.s=-y,p):new G(O[0]?j:fe==3?-0:0)}if(k=v(k),B=v(B),O=O.slice(),D=k-B){for((F=D<0)?(D=-D,T=O):(B=k,T=M),T.reverse(),y=D;y--;T.push(0));T.reverse()}else for(x=(F=(D=O.length)<(y=M.length))?D:y,D=y=0;y<x;y++)if(O[y]!=M[y]){F=O[y]<M[y];break}if(F&&(T=O,O=M,M=T,p.s=-p.s),y=(x=M.length)-(C=O.length),y>0)for(;y--;O[C++]=0);for(y=l-1;x>D;){if(O[--x]<M[x]){for(C=x;C&&!O[--C];O[C]=y);--O[C],O[x]+=l}O[x]-=M[x]}for(;O[0]==0;O.splice(0,1),--B);return O[0]?er(p,O,B):(p.s=fe==3?-1:1,p.c=[p.e=0],p)},W.modulo=W.mod=function(p,y){var C,x,T=this;return p=new G(p,y),!T.c||!p.s||p.c&&!p.c[0]?new G(NaN):!p.c||T.c&&!T.c[0]?new G(T):(z==9?(x=p.s,p.s=1,C=U(T,p,0,3),p.s=x,C.s*=x):C=U(T,p,0,z),p=T.minus(C.times(p)),!p.c[0]&&z==1&&(p.s=T.s),p)},W.multipliedBy=W.times=function(p,y){var C,x,T,F,j,D,k,B,O,M,Y,Q,Ae,Fe,Be,Ce=this,De=Ce.c,Ue=(p=new G(p,y)).c;if(!De||!Ue||!De[0]||!Ue[0])return!Ce.s||!p.s||De&&!De[0]&&!Ue||Ue&&!Ue[0]&&!De?p.c=p.e=p.s=null:(p.s*=Ce.s,!De||!Ue?p.c=p.e=null:(p.c=[0],p.e=0)),p;for(x=v(Ce.e/f)+v(p.e/f),p.s*=Ce.s,k=De.length,M=Ue.length,k<M&&(Ae=De,De=Ue,Ue=Ae,T=k,k=M,M=T),T=k+M,Ae=[];T--;Ae.push(0));for(Fe=l,Be=_,T=M;--T>=0;){for(C=0,Y=Ue[T]%Be,Q=Ue[T]/Be|0,j=k,F=T+j;F>T;)B=De[--j]%Be,O=De[j]/Be|0,D=Q*B+O*Y,B=Y*B+D%Be*Be+Ae[F]+C,C=(B/Fe|0)+(D/Be|0)+Q*O,Ae[F--]=B%Fe;Ae[F]=C}return C?++x:Ae.splice(0,1),er(p,Ae,x)},W.negated=function(){var p=new G(this);return p.s=-p.s||null,p},W.plus=function(p,y){var C,x=this,T=x.s;if(p=new G(p,y),y=p.s,!T||!y)return new G(NaN);if(T!=y)return p.s=-y,x.minus(p);var F=x.e/f,j=p.e/f,D=x.c,k=p.c;if(!F||!j){if(!D||!k)return new G(T/0);if(!D[0]||!k[0])return k[0]?p:new G(D[0]?x:T*0)}if(F=v(F),j=v(j),D=D.slice(),T=F-j){for(T>0?(j=F,C=k):(T=-T,C=D),C.reverse();T--;C.push(0));C.reverse()}for(T=D.length,y=k.length,T-y<0&&(C=k,k=D,D=C,y=T),T=0;y;)T=(D[--y]=D[y]+k[y]+T)/l|0,D[y]=l===D[y]?0:D[y]%l;return T&&(D=[T].concat(D),++j),er(p,D,j)},W.precision=W.sd=function(p,y){var C,x,T,F=this;if(p!=null&&p!==!!p)return b(p,1,E),y==null?y=fe:b(y,0,8),xe(new G(F),p,y);if(!(C=F.c))return null;if(T=C.length-1,x=T*f+1,T=C[T]){for(;T%10==0;T/=10,x--);for(T=C[0];T>=10;T/=10,x++);}return p&&F.e+1>x&&(x=F.e+1),x},W.shiftedBy=function(p){return b(p,-h,h),this.times("1e"+p)},W.squareRoot=W.sqrt=function(){var p,y,C,x,T,F=this,j=F.c,D=F.s,k=F.e,B=he+4,O=new G("0.5");if(D!==1||!j||!j[0])return new G(!D||D<0&&(!j||j[0])?NaN:j?F:1/0);if(D=Math.sqrt(+Ie(F)),D==0||D==1/0?(y=A(j),(y.length+k)%2==0&&(y+="0"),D=Math.sqrt(+y),k=v((k+1)/2)-(k<0||k%2),D==1/0?y="5e"+k:(y=D.toExponential(),y=y.slice(0,y.indexOf("e")+1)+k),C=new G(y)):C=new G(D+""),C.c[0]){for(k=C.e,D=k+B,D<3&&(D=0);;)if(T=C,C=O.times(T.plus(U(F,T,B,1))),A(T.c).slice(0,D)===(y=A(C.c)).slice(0,D))if(C.e<k&&--D,y=y.slice(D-3,D+1),y=="9999"||!x&&y=="4999"){if(!x&&(xe(T,T.e+he+2,0),T.times(T).eq(F))){C=T;break}B+=4,D+=4,x=1}else{(!+y||!+y.slice(1)&&y.charAt(0)=="5")&&(xe(C,C.e+he+2,1),p=!C.times(C).eq(F));break}}return xe(C,C.e+he+1,fe,p)},W.toExponential=function(p,y){return p!=null&&(b(p,0,E),p++),pe(this,p,y,1)},W.toFixed=function(p,y){return p!=null&&(b(p,0,E),p=p+this.e+1),pe(this,p,y)},W.toFormat=function(p,y,C){var x,T=this;if(C==null)p!=null&&y&&typeof y=="object"?(C=y,y=null):p&&typeof p=="object"?(C=p,p=y=null):C=se;else if(typeof C!="object")throw Error(a+"Argument not an object: "+C);if(x=T.toFixed(p,y),T.c){var F,j=x.split("."),D=+C.groupSize,k=+C.secondaryGroupSize,B=C.groupSeparator||"",O=j[0],M=j[1],Y=T.s<0,Q=Y?O.slice(1):O,Ae=Q.length;if(k&&(F=D,D=k,k=F,Ae-=F),D>0&&Ae>0){for(F=Ae%D||D,O=Q.substr(0,F);F<Ae;F+=D)O+=B+Q.substr(F,D);k>0&&(O+=B+Q.slice(F)),Y&&(O="-"+O)}x=M?O+(C.decimalSeparator||"")+((k=+C.fractionGroupSize)?M.replace(new RegExp("\\d{"+k+"}\\B","g"),"$&"+(C.fractionGroupSeparator||"")):M):O}return(C.prefix||"")+x+(C.suffix||"")},W.toFraction=function(p){var y,C,x,T,F,j,D,k,B,O,M,Y,Q=this,Ae=Q.c;if(p!=null&&(D=new G(p),!D.isInteger()&&(D.c||D.s!==1)||D.lt(we)))throw Error(a+"Argument "+(D.isInteger()?"out of range: ":"not an integer: ")+Ie(D));if(!Ae)return new G(Q);for(y=new G(we),B=C=new G(we),x=k=new G(we),Y=A(Ae),F=y.e=Y.length-Q.e-1,y.c[0]=d[(j=F%f)<0?f+j:j],p=!p||D.comparedTo(y)>0?F>0?y:B:D,j=Z,Z=1/0,D=new G(Y),k.c[0]=0;O=U(D,y,0,1),T=C.plus(O.times(x)),T.comparedTo(p)!=1;)C=x,x=T,B=k.plus(O.times(T=B)),k=T,y=D.minus(O.times(T=y)),D=T;return T=U(p.minus(C),x,0,1),k=k.plus(T.times(B)),C=C.plus(T.times(x)),k.s=B.s=Q.s,F=F*2,M=U(B,x,F,fe).minus(Q).abs().comparedTo(U(k,C,F,fe).minus(Q).abs())<1?[B,x]:[k,C],Z=j,M},W.toNumber=function(){return+Ie(this)},W.toPrecision=function(p,y){return p!=null&&b(p,1,E),pe(this,p,y,2)},W.toString=function(p){var y,C=this,x=C.s,T=C.e;return T===null?x?(y="Infinity",x<0&&(y="-"+y)):y="NaN":(p==null?y=T<=ye||T>=re?S(A(C.c),T):I(A(C.c),T,"0"):p===10&&Le?(C=xe(new G(C),he+T+1,fe),y=I(A(C.c),C.e,"0")):(b(p,2,Ne.length,"Base"),y=H(I(A(C.c),T,"0"),10,p,x,!0)),x<0&&C.c[0]&&(y="-"+y)),y},W.valueOf=W.toJSON=function(){return Ie(this)},W._isBigNumber=!0,L!=null&&G.set(L),G}function v(L){var U=L|0;return L>0||L===U?U:U-1}function A(L){for(var U,H,K=1,W=L.length,we=L[0]+"";K<W;){for(U=L[K++]+"",H=f-U.length;H--;U="0"+U);we+=U}for(W=we.length;we.charCodeAt(--W)===48;);return we.slice(0,W+1||1)}function g(L,U){var H,K,W=L.c,we=U.c,he=L.s,fe=U.s,ye=L.e,re=U.e;if(!he||!fe)return null;if(H=W&&!W[0],K=we&&!we[0],H||K)return H?K?0:-fe:he;if(he!=fe)return he;if(H=he<0,K=ye==re,!W||!we)return K?0:!W^H?1:-1;if(!K)return ye>re^H?1:-1;for(fe=(ye=W.length)<(re=we.length)?ye:re,he=0;he<fe;he++)if(W[he]!=we[he])return W[he]>we[he]^H?1:-1;return ye==re?0:ye>re^H?1:-1}function b(L,U,H,K){if(L<U||L>H||L!==s(L))throw Error(a+(K||"Argument")+(typeof L=="number"?L<U||L>H?" out of range: ":" not an integer: ":" not a primitive number: ")+String(L))}function R(L){var U=L.c.length-1;return v(L.e/f)==U&&L.c[U]%2!=0}function S(L,U){return(L.length>1?L.charAt(0)+"."+L.slice(1):L)+(U<0?"e":"e+")+U}function I(L,U,H){var K,W;if(U<0){for(W=H+".";++U;W+=H);L=W+L}else if(K=L.length,++U>K){for(W=H,U-=K;--U;W+=H);L+=W}else U<K&&(L=L.slice(0,U)+"."+L.slice(U));return L}e=P(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof Ys<"u"&&Ys.exports?Ys.exports=e:(r||(r=typeof self<"u"&&self?self:window),r.BigNumber=e)})(Bh)});var Lh=J((kS,jh)=>{var Nh=Cu(),Ih=jh.exports;(function(){"use strict";function r(h){return h<10?"0"+h:h}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,s,a={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},u;function l(h){return t.lastIndex=0,t.test(h)?'"'+h.replace(t,function(d){var _=a[d];return typeof _=="string"?_:"\\u"+("0000"+d.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function f(h,d){var _,E,P,v,A=n,g,b=d[h],R=b!=null&&(b instanceof Nh||Nh.isBigNumber(b));switch(b&&typeof b=="object"&&typeof b.toJSON=="function"&&(b=b.toJSON(h)),typeof u=="function"&&(b=u.call(d,h,b)),typeof b){case"string":return R?b:l(b);case"number":return isFinite(b)?String(b):"null";case"boolean":case"null":case"bigint":return String(b);case"object":if(!b)return"null";if(n+=s,g=[],Object.prototype.toString.apply(b)==="[object Array]"){for(v=b.length,_=0;_<v;_+=1)g[_]=f(_,b)||"null";return P=g.length===0?"[]":n?`[
`+n+g.join(`,
`+n)+`
`+A+"]":"["+g.join(",")+"]",n=A,P}if(u&&typeof u=="object")for(v=u.length,_=0;_<v;_+=1)typeof u[_]=="string"&&(E=u[_],P=f(E,b),P&&g.push(l(E)+(n?": ":":")+P));else Object.keys(b).forEach(function(S){var I=f(S,b);I&&g.push(l(S)+(n?": ":":")+I)});return P=g.length===0?"{}":n?`{
`+n+g.join(`,
`+n)+`
`+A+"}":"{"+g.join(",")+"}",n=A,P}}typeof Ih.stringify!="function"&&(Ih.stringify=function(h,d,_){var E;if(n="",s="",typeof _=="number")for(E=0;E<_;E+=1)s+=" ";else typeof _=="string"&&(s=_);if(u=d,d&&typeof d!="function"&&(typeof d!="object"||typeof d.length!="number"))throw new Error("JSON.stringify");return f("",{"":h})})})()});var qh=J((FS,Uh)=>{var Xs=null,ob=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,sb=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/,ib=function(r){"use strict";var e={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(r!=null){if(r.strict===!0&&(e.strict=!0),r.storeAsString===!0&&(e.storeAsString=!0),e.alwaysParseAsBig=r.alwaysParseAsBig===!0?r.alwaysParseAsBig:!1,e.useNativeBigInt=r.useNativeBigInt===!0?r.useNativeBigInt:!1,typeof r.constructorAction<"u")if(r.constructorAction==="error"||r.constructorAction==="ignore"||r.constructorAction==="preserve")e.constructorAction=r.constructorAction;else throw new Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${r.constructorAction}`);if(typeof r.protoAction<"u")if(r.protoAction==="error"||r.protoAction==="ignore"||r.protoAction==="preserve")e.protoAction=r.protoAction;else throw new Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${r.protoAction}`)}var t,n,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},a,u=function(A){throw{name:"SyntaxError",message:A,at:t,text:a}},l=function(A){return A&&A!==n&&u("Expected '"+A+"' instead of '"+n+"'"),n=a.charAt(t),t+=1,n},f=function(){var A,g="";for(n==="-"&&(g="-",l("-"));n>="0"&&n<="9";)g+=n,l();if(n===".")for(g+=".";l()&&n>="0"&&n<="9";)g+=n;if(n==="e"||n==="E")for(g+=n,l(),(n==="-"||n==="+")&&(g+=n,l());n>="0"&&n<="9";)g+=n,l();if(A=+g,!isFinite(A))u("Bad number");else return Xs==null&&(Xs=Cu()),g.length>15?e.storeAsString?g:e.useNativeBigInt?BigInt(g):new Xs(g):e.alwaysParseAsBig?e.useNativeBigInt?BigInt(A):new Xs(A):A},h=function(){var A,g,b="",R;if(n==='"')for(var S=t;l();){if(n==='"')return t-1>S&&(b+=a.substring(S,t-1)),l(),b;if(n==="\\"){if(t-1>S&&(b+=a.substring(S,t-1)),l(),n==="u"){for(R=0,g=0;g<4&&(A=parseInt(l(),16),!!isFinite(A));g+=1)R=R*16+A;b+=String.fromCharCode(R)}else if(typeof s[n]=="string")b+=s[n];else break;S=t}}u("Bad string")},d=function(){for(;n&&n<=" ";)l()},_=function(){switch(n){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}u("Unexpected '"+n+"'")},E,P=function(){var A=[];if(n==="["){if(l("["),d(),n==="]")return l("]"),A;for(;n;){if(A.push(E()),d(),n==="]")return l("]"),A;l(","),d()}}u("Bad array")},v=function(){var A,g=Object.create(null);if(n==="{"){if(l("{"),d(),n==="}")return l("}"),g;for(;n;){if(A=h(),d(),l(":"),e.strict===!0&&Object.hasOwnProperty.call(g,A)&&u('Duplicate key "'+A+'"'),ob.test(A)===!0?e.protoAction==="error"?u("Object contains forbidden prototype property"):e.protoAction==="ignore"?E():g[A]=E():sb.test(A)===!0?e.constructorAction==="error"?u("Object contains forbidden constructor property"):e.constructorAction==="ignore"?E():g[A]=E():g[A]=E(),d(),n==="}")return l("}"),g;l(","),d()}}u("Bad object")};return E=function(){switch(d(),n){case"{":return v();case"[":return P();case'"':return h();case"-":return f();default:return n>="0"&&n<="9"?f():_()}},function(A,g){var b;return a=A+"",t=0,n=" ",b=E(),d(),n&&u("Syntax error"),typeof g=="function"?(function R(S,I){var L,U,H=S[I];return H&&typeof H=="object"&&Object.keys(H).forEach(function(K){U=R(H,K),U!==void 0?H[K]=U:delete H[K]}),g.call(S,I,H)})({"":b},""):b}};Uh.exports=ib});var Hh=J((OS,Qs)=>{var Mh=Lh().stringify,$h=qh();Qs.exports=function(r){return{parse:$h(r),stringify:Mh}};Qs.exports.parse=$h();Qs.exports.stringify=Mh});var Eu=J(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.GCE_LINUX_BIOS_PATHS=void 0;It.isGoogleCloudServerless=Jh;It.isGoogleComputeEngineLinux=zh;It.isGoogleComputeEngineMACAddress=Vh;It.isGoogleComputeEngine=Kh;It.detectGCPResidency=ub;var Gh=X("fs"),Wh=X("os");It.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};var ab=/^42:01/;function Jh(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function zh(){if((0,Wh.platform)()!=="linux")return!1;try{(0,Gh.statSync)(It.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let r=(0,Gh.readFileSync)(It.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(r)}catch{return!1}}function Vh(){let r=(0,Wh.networkInterfaces)();for(let e of Object.values(r))if(e){for(let{mac:t}of e)if(ab.test(t))return!0}return!1}function Kh(){return zh()||Vh()}function ub(){return Jh()||Kh()}});var Yh=J(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.Colours=void 0;var Xe=class r{static isEnabled(e){return e&&e.isTTY&&(typeof e.getColorDepth=="function"?e.getColorDepth()>2:!0)}static refresh(){r.enabled=r.isEnabled(process==null?void 0:process.stderr),this.enabled?(r.reset="\x1B[0m",r.bright="\x1B[1m",r.dim="\x1B[2m",r.red="\x1B[31m",r.green="\x1B[32m",r.yellow="\x1B[33m",r.blue="\x1B[34m",r.magenta="\x1B[35m",r.cyan="\x1B[36m",r.white="\x1B[37m",r.grey="\x1B[90m"):(r.reset="",r.bright="",r.dim="",r.red="",r.green="",r.yellow="",r.blue="",r.magenta="",r.cyan="",r.white="",r.grey="")}};Zs.Colours=Xe;Xe.enabled=!1;Xe.reset="";Xe.bright="";Xe.dim="";Xe.red="";Xe.green="";Xe.yellow="";Xe.blue="";Xe.magenta="";Xe.cyan="";Xe.white="";Xe.grey="";Xe.refresh()});var ep=J(ve=>{"use strict";var cb=ve&&ve.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),lb=ve&&ve.__setModuleDefault||(Object.create?(function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}):function(r,e){r.default=e}),Xh=ve&&ve.__importStar||(function(){var r=function(e){return r=Object.getOwnPropertyNames||function(t){var n=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[n.length]=s);return n},r(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n=r(e),s=0;s<n.length;s++)n[s]!=="default"&&cb(t,e,n[s]);return lb(t,e),t}})();Object.defineProperty(ve,"__esModule",{value:!0});ve.env=ve.DebugLogBackendBase=ve.placeholder=ve.AdhocDebugLogger=ve.LogSeverity=void 0;ve.getNodeBackend=wu;ve.getDebugBackend=db;ve.getStructuredBackend=hb;ve.setBackend=pb;ve.log=Zh;var fb=X("events"),go=Xh(X("process")),Qh=Xh(X("util")),dt=Yh(),jt;(function(r){r.DEFAULT="DEFAULT",r.DEBUG="DEBUG",r.INFO="INFO",r.WARNING="WARNING",r.ERROR="ERROR"})(jt||(ve.LogSeverity=jt={}));var yo=class extends fb.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(n,s)=>this.on(n,s)}),this.func.debug=(...n)=>this.invokeSeverity(jt.DEBUG,...n),this.func.info=(...n)=>this.invokeSeverity(jt.INFO,...n),this.func.warn=(...n)=>this.invokeSeverity(jt.WARNING,...n),this.func.error=(...n)=>this.invokeSeverity(jt.ERROR,...n),this.func.sublog=n=>Zh(n,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch{}try{this.emit("log",e,t)}catch{}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}};ve.AdhocDebugLogger=yo;ve.placeholder=new yo("",()=>{}).func;var On=class{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let t=(e=go.env[ve.env.nodeEnables])!==null&&e!==void 0?e:"*";t==="all"&&(t="*"),this.filters=t.split(",")}log(e,t,...n){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let s=this.cached.get(e);s||(s=this.makeLogger(e),this.cached.set(e,s)),s(t,...n)}catch(s){console.error(s)}}};ve.DebugLogBackendBase=On;var Au=class extends On{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...n)=>{var s;let a=`${dt.Colours.green}${e}${dt.Colours.reset}`,u=`${dt.Colours.yellow}${go.pid}${dt.Colours.reset}`,l;switch(t.severity){case jt.ERROR:l=`${dt.Colours.red}${t.severity}${dt.Colours.reset}`;break;case jt.INFO:l=`${dt.Colours.magenta}${t.severity}${dt.Colours.reset}`;break;case jt.WARNING:l=`${dt.Colours.yellow}${t.severity}${dt.Colours.reset}`;break;default:l=(s=t.severity)!==null&&s!==void 0?s:jt.DEFAULT;break}let f=Qh.formatWithOptions({colors:dt.Colours.enabled},...n),h=Object.assign({},t);delete h.severity;let d=Object.getOwnPropertyNames(h).length?JSON.stringify(h):"",_=d?`${dt.Colours.grey}${d}${dt.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",u,a,l,f,d?` ${_}`:"")}:()=>{}}setFilters(){let t=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=new RegExp(`^${t}$`,"i")}};function wu(){return new Au}var Du=class extends On{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(n,...s)=>{t(s[0],...s.slice(1))}}setFilters(){var e;let t=(e=go.env.NODE_DEBUG)!==null&&e!==void 0?e:"";go.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}};function db(r){return new Du(r)}var Su=class extends On{constructor(e){var t;super(),this.upstream=(t=e)!==null&&t!==void 0?t:void 0}makeLogger(e){var t;let n=(t=this.upstream)===null||t===void 0?void 0:t.makeLogger(e);return(s,...a)=>{var u;let l=(u=s.severity)!==null&&u!==void 0?u:jt.INFO,f=Object.assign({severity:l,message:Qh.format(...a)},s),h=JSON.stringify(f);n?n(s,h):console.log("%s",h)}}setFilters(){var e;(e=this.upstream)===null||e===void 0||e.setFilters()}};function hb(r){return new Su(r)}ve.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};var vu=new Map,ht;function pb(r){ht=r,vu.clear()}function Zh(r,e){if(!ht&&!go.env[ve.env.nodeEnables]||!r)return ve.placeholder;e&&(r=`${e.instance.namespace}:${r}`);let t=vu.get(r);if(t)return t.func;if(ht===null)return ve.placeholder;ht===void 0&&(ht=wu());let n=(()=>{let s;return new yo(r,(u,...l)=>{if(s!==ht){if(ht===null)return;ht===void 0&&(ht=wu()),s=ht}ht?.log(r,u,...l)})})();return vu.set(r,n),n.func}});var Tu=J(en=>{"use strict";var mb=en&&en.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),gb=en&&en.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&mb(e,r,t)};Object.defineProperty(en,"__esModule",{value:!0});gb(ep(),en)});var bo=J(ie=>{"use strict";var rp=ie&&ie.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),yb=ie&&ie.__setModuleDefault||(Object.create?(function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}):function(r,e){r.default=e}),_b=ie&&ie.__importStar||(function(){var r=function(e){return r=Object.getOwnPropertyNames||function(t){var n=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[n.length]=s);return n},r(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n=r(e),s=0;s<n.length;s++)n[s]!=="default"&&rp(t,e,n[s]);return yb(t,e),t}})(),bb=ie&&ie.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&rp(e,r,t)};Object.defineProperty(ie,"__esModule",{value:!0});ie.gcpResidencyCache=ie.METADATA_SERVER_DETECTION=ie.HEADERS=ie.HEADER_VALUE=ie.HEADER_NAME=ie.SECONDARY_HOST_ADDRESS=ie.HOST_ADDRESS=ie.BASE_PATH=void 0;ie.instance=Sb;ie.project=vb;ie.universe=Tb;ie.bulk=Rb;ie.isAvailable=Fb;ie.resetIsAvailableCache=Ob;ie.getGCPResidency=Fu;ie.setGCPResidency=np;ie.requestTimeout=op;var Ru=Ve(),Cb=Hh(),Eb=Eu(),Ab=_b(Tu());ie.BASE_PATH="/computeMetadata/v1";ie.HOST_ADDRESS="http://169.254.169.254";ie.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.";ie.HEADER_NAME="Metadata-Flavor";ie.HEADER_VALUE="Google";ie.HEADERS=Object.freeze({[ie.HEADER_NAME]:ie.HEADER_VALUE});var tp=Ab.log("gcp-metadata");ie.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"});function ku(r){return r||(r=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||ie.HOST_ADDRESS),/^https?:\/\//.test(r)||(r=`http://${r}`),new URL(ie.BASE_PATH,r).href}function wb(r){Object.keys(r).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw new Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw new Error(`'${e}' is not a valid configuration option.`)}})}async function _o(r,e={},t=3,n=!1){let s=new Headers(ie.HEADERS),a="",u={};if(typeof r=="object"){let _=r;new Headers(_.headers).forEach((E,P)=>s.set(P,E)),a=_.metadataKey,u=_.params||u,t=_.noResponseRetries||t,n=_.fastFail||n}else a=r;typeof e=="string"?a+=`/${e}`:(wb(e),e.property&&(a+=`/${e.property}`),new Headers(e.headers).forEach((_,E)=>s.set(E,_)),u=e.params||u);let l=n?Db:Ru.request,f={url:`${ku()}/${a}`,headers:s,retryConfig:{noResponseRetries:t},params:u,responseType:"text",timeout:op()};tp.info("instance request %j",f);let h=await l(f);tp.info("instance metadata is %s",h.data);let d=h.headers.get(ie.HEADER_NAME);if(d!==ie.HEADER_VALUE)throw new RangeError(`Invalid response from metadata service: incorrect ${ie.HEADER_NAME} header. Expected '${ie.HEADER_VALUE}', got ${d?`'${d}'`:"no header"}`);if(typeof h.data=="string")try{return Cb.parse(h.data)}catch{}return h.data}async function Db(r){let e={...r,url:r.url?.toString().replace(ku(),ku(ie.SECONDARY_HOST_ADDRESS))},t=(0,Ru.request)(r),n=(0,Ru.request)(e);return Promise.any([t,n])}function Sb(r){return _o("instance",r)}function vb(r){return _o("project",r)}function Tb(r){return _o("universe",r)}async function Rb(r){let e={};return await Promise.all(r.map(t=>(async()=>{let n=await _o(t),s=t.metadataKey;e[s]=n})())),e}function kb(){return process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0}var ei;async function Fb(){if(process.env.METADATA_SERVER_DETECTION){let r=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(r in ie.METADATA_SERVER_DETECTION))throw new RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${r}\`, but it should be \`${Object.keys(ie.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(r){case"assume-present":return!0;case"none":return!1;case"bios-only":return Fu();case"ping-only":}}try{return ei===void 0&&(ei=_o("instance",void 0,kb(),!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await ei,!0}catch(r){let e=r;if(process.env.DEBUG_AUTH&&console.info(e),e.type==="request-timeout"||e.response&&e.response.status===404)return!1;if(!(e.response&&e.response.status===404)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function Ob(){ei=void 0}ie.gcpResidencyCache=null;function Fu(){return ie.gcpResidencyCache===null&&np(),ie.gcpResidencyCache}function np(r=null){ie.gcpResidencyCache=r!==null?r:(0,Eb.detectGCPResidency)()}function op(){return Fu()?0:3e3}bb(Eu(),ie)});var ap=J(ti=>{"use strict";ti.byteLength=xb;ti.toByteArray=Nb;ti.fromByteArray=Lb;var zt=[],St=[],Pb=typeof Uint8Array<"u"?Uint8Array:Array,Ou="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(tn=0,sp=Ou.length;tn<sp;++tn)zt[tn]=Ou[tn],St[Ou.charCodeAt(tn)]=tn;var tn,sp;St[45]=62;St[95]=63;function ip(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function xb(r){var e=ip(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Bb(r,e,t){return(e+t)*3/4-t}function Nb(r){var e,t=ip(r),n=t[0],s=t[1],a=new Pb(Bb(r,n,s)),u=0,l=s>0?n-4:n,f;for(f=0;f<l;f+=4)e=St[r.charCodeAt(f)]<<18|St[r.charCodeAt(f+1)]<<12|St[r.charCodeAt(f+2)]<<6|St[r.charCodeAt(f+3)],a[u++]=e>>16&255,a[u++]=e>>8&255,a[u++]=e&255;return s===2&&(e=St[r.charCodeAt(f)]<<2|St[r.charCodeAt(f+1)]>>4,a[u++]=e&255),s===1&&(e=St[r.charCodeAt(f)]<<10|St[r.charCodeAt(f+1)]<<4|St[r.charCodeAt(f+2)]>>2,a[u++]=e>>8&255,a[u++]=e&255),a}function Ib(r){return zt[r>>18&63]+zt[r>>12&63]+zt[r>>6&63]+zt[r&63]}function jb(r,e,t){for(var n,s=[],a=e;a<t;a+=3)n=(r[a]<<16&16711680)+(r[a+1]<<8&65280)+(r[a+2]&255),s.push(Ib(n));return s.join("")}function Lb(r){for(var e,t=r.length,n=t%3,s=[],a=16383,u=0,l=t-n;u<l;u+=a)s.push(jb(r,u,u+a>l?l:u+a));return n===1?(e=r[t-1],s.push(zt[e>>2]+zt[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(zt[e>>10]+zt[e>>4&63]+zt[e<<2&63]+"=")),s.join("")}});var xu=J(Pu=>{"use strict";Object.defineProperty(Pu,"__esModule",{value:!0});Pu.fromArrayBufferToHex=Ub;function Ub(r){return Array.from(new Uint8Array(r)).map(t=>t.toString(16).padStart(2,"0")).join("")}});var up=J(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.BrowserCrypto=void 0;var Pn=ap(),qb=xu(),Bu=class r{constructor(){if(typeof window>"u"||window.crypto===void 0||window.crypto.subtle===void 0)throw new Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return Pn.fromByteArray(new Uint8Array(n))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),Pn.fromByteArray(t)}static padBase64(e){for(;e.length%4!==0;)e+="=";return e}async verify(e,t,n){let s={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},a=new TextEncoder().encode(t),u=Pn.toByteArray(r.padBase64(n)),l=await window.crypto.subtle.importKey("jwk",e,s,!0,["verify"]);return await window.crypto.subtle.verify(s,l,u,a)}async sign(e,t){let n={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),a=await window.crypto.subtle.importKey("jwk",e,n,!0,["sign"]),u=await window.crypto.subtle.sign(n,a,s);return Pn.fromByteArray(new Uint8Array(u))}decodeBase64StringUtf8(e){let t=Pn.toByteArray(r.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return Pn.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return(0,qb.fromArrayBufferToHex)(n)}async signWithHmacSha256(e,t){let n=typeof e=="string"?e:String.fromCharCode(...new Uint16Array(e)),s=new TextEncoder,a=await window.crypto.subtle.importKey("raw",s.encode(n),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",a,s.encode(t))}};ri.BrowserCrypto=Bu});var cp=J(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.NodeCrypto=void 0;var xn=X("crypto"),Nu=class{async sha256DigestBase64(e){return xn.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return xn.randomBytes(e).toString("base64")}async verify(e,t,n){let s=xn.createVerify("RSA-SHA256");return s.update(t),s.end(),s.verify(e,n,"base64")}async sign(e,t){let n=xn.createSign("RSA-SHA256");return n.update(t),n.end(),n.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return xn.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){let n=typeof e=="string"?e:$b(e);return Mb(xn.createHmac("sha256",n).update(t).digest())}};ni.NodeCrypto=Nu;function Mb(r){return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function $b(r){return Buffer.from(r)}});var Co=J(dr=>{"use strict";var Hb=dr&&dr.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),Gb=dr&&dr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Hb(e,r,t)};Object.defineProperty(dr,"__esModule",{value:!0});dr.createCrypto=zb;dr.hasBrowserCrypto=lp;var Wb=up(),Jb=cp();Gb(xu(),dr);function zb(){return lp()?new Wb.BrowserCrypto:new Jb.NodeCrypto}function lp(){return typeof window<"u"&&typeof window.crypto<"u"&&typeof window.crypto.subtle<"u"}});var Bn=J((Iu,dp)=>{var oi=X("buffer"),Vt=oi.Buffer;function fp(r,e){for(var t in r)e[t]=r[t]}Vt.from&&Vt.alloc&&Vt.allocUnsafe&&Vt.allocUnsafeSlow?dp.exports=oi:(fp(oi,Iu),Iu.Buffer=rn);function rn(r,e,t){return Vt(r,e,t)}rn.prototype=Object.create(Vt.prototype);fp(Vt,rn);rn.from=function(r,e,t){if(typeof r=="number")throw new TypeError("Argument must not be a number");return Vt(r,e,t)};rn.alloc=function(r,e,t){if(typeof r!="number")throw new TypeError("Argument must be a number");var n=Vt(r);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n};rn.allocUnsafe=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return Vt(r)};rn.allocUnsafeSlow=function(r){if(typeof r!="number")throw new TypeError("Argument must be a number");return oi.SlowBuffer(r)}});var pp=J(($S,hp)=>{"use strict";function ju(r){var e=(r/8|0)+(r%8===0?0:1);return e}var Vb={ES256:ju(256),ES384:ju(384),ES512:ju(521)};function Kb(r){var e=Vb[r];if(e)return e;throw new Error('Unknown algorithm "'+r+'"')}hp.exports=Kb});var Lu=J((HS,Cp)=>{"use strict";var si=Bn().Buffer,gp=pp(),ii=128,yp=0,Yb=32,Xb=16,Qb=2,_p=Xb|Yb|yp<<6,ai=Qb|yp<<6;function Zb(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function bp(r){if(si.isBuffer(r))return r;if(typeof r=="string")return si.from(r,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function eC(r,e){r=bp(r);var t=gp(e),n=t+1,s=r.length,a=0;if(r[a++]!==_p)throw new Error('Could not find expected "seq"');var u=r[a++];if(u===(ii|1)&&(u=r[a++]),s-a<u)throw new Error('"seq" specified length of "'+u+'", only "'+(s-a)+'" remaining');if(r[a++]!==ai)throw new Error('Could not find expected "int" for "r"');var l=r[a++];if(s-a-2<l)throw new Error('"r" specified length of "'+l+'", only "'+(s-a-2)+'" available');if(n<l)throw new Error('"r" specified length of "'+l+'", max of "'+n+'" is acceptable');var f=a;if(a+=l,r[a++]!==ai)throw new Error('Could not find expected "int" for "s"');var h=r[a++];if(s-a!==h)throw new Error('"s" specified length of "'+h+'", expected "'+(s-a)+'"');if(n<h)throw new Error('"s" specified length of "'+h+'", max of "'+n+'" is acceptable');var d=a;if(a+=h,a!==s)throw new Error('Expected to consume entire buffer, but "'+(s-a)+'" bytes remain');var _=t-l,E=t-h,P=si.allocUnsafe(_+l+E+h);for(a=0;a<_;++a)P[a]=0;r.copy(P,a,f+Math.max(-_,0),f+l),a=t;for(var v=a;a<v+E;++a)P[a]=0;return r.copy(P,a,d+Math.max(-E,0),d+h),P=P.toString("base64"),P=Zb(P),P}function mp(r,e,t){for(var n=0;e+n<t&&r[e+n]===0;)++n;var s=r[e+n]>=ii;return s&&--n,n}function tC(r,e){r=bp(r);var t=gp(e),n=r.length;if(n!==t*2)throw new TypeError('"'+e+'" signatures must be "'+t*2+'" bytes, saw "'+n+'"');var s=mp(r,0,t),a=mp(r,t,r.length),u=t-s,l=t-a,f=2+u+1+1+l,h=f<ii,d=si.allocUnsafe((h?2:3)+f),_=0;return d[_++]=_p,h?d[_++]=f:(d[_++]=ii|1,d[_++]=f&255),d[_++]=ai,d[_++]=u,s<0?(d[_++]=0,_+=r.copy(d,_,0,t)):_+=r.copy(d,_,s,t),d[_++]=ai,d[_++]=l,a<0?(d[_++]=0,r.copy(d,_,t)):r.copy(d,_,t+a),d}Cp.exports={derToJose:eC,joseToDer:tC}});var Lt=J(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.LRUCache=void 0;hr.snakeToCamel=Ap;hr.originalOrCamelOptions=sC;hr.removeUndefinedValuesInObject=iC;hr.isValidFile=aC;hr.getWellKnownCertificateConfigFileLocation=uC;var rC=X("fs"),nC=X("os"),Uu=X("path"),oC="certificate_config.json",Ep="gcloud";function Ap(r){return r.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}function sC(r){function e(t){let n=r||{};return n[t]??n[Ap(t)]}return{get:e}}var qu=class{capacity;#e=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#t(e,t){this.#e.delete(e),this.#e.set(e,{value:t,lastAccessed:Date.now()})}set(e,t){this.#t(e,t),this.#r()}get(e){let t=this.#e.get(e);if(t)return this.#t(e,t.value),this.#r(),t.value}#r(){let e=this.maxAge?Date.now()-this.maxAge:0,t=this.#e.entries().next();for(;!t.done&&(this.#e.size>this.capacity||t.value[1].lastAccessed<e);)this.#e.delete(t.value[0]),t=this.#e.entries().next()}};hr.LRUCache=qu;function iC(r){return Object.entries(r).forEach(([e,t])=>{(t===void 0||t==="undefined")&&delete r[e]}),r}async function aC(r){try{return(await rC.promises.lstat(r)).isFile()}catch{return!1}}function uC(){let r=process.env.CLOUDSDK_CONFIG||(cC()?Uu.join(process.env.APPDATA||"",Ep):Uu.join(process.env.HOME||"",".config",Ep));return Uu.join(r,oC)}function cC(){return nC.platform().startsWith("win")}});var wp=J((WS,lC)=>{lC.exports={name:"google-auth-library",version:"10.2.1",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^7.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^4.0.0","jsdoc-region-tag":"^3.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",linkinator:"^6.1.2",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"14.0.5","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"5.8.2",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"linkinator docs","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"}});var Mu=J(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.USER_AGENT=Br.PRODUCT_NAME=Br.pkg=void 0;var Dp=wp();Br.pkg=Dp;var Sp="google-api-nodejs-client";Br.PRODUCT_NAME=Sp;var fC=`${Sp}/${Dp.version}`;Br.USER_AGENT=fC});var pt=J(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.AuthClient=Ut.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=Ut.DEFAULT_UNIVERSE=void 0;var dC=X("events"),$u=Ve(),hC=Lt(),pC=Tu(),Hu=Mu();Ut.DEFAULT_UNIVERSE="googleapis.com";Ut.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=300*1e3;var Gu=class r extends dC.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=Ut.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=Ut.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let t=(0,hC.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=t.get("project_id")??null,this.quotaProjectId=t.get("quota_project_id"),this.credentials=t.get("credentials")??{},this.universeDomain=t.get("universe_domain")??Ut.DEFAULT_UNIVERSE,this.transporter=e.transporter??new $u.Gaxios(e.transporterOptions),t.get("useAuthRequestParameters")!==!1&&(this.transporter.interceptors.request.add(r.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(r.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let t=e[0],n=e[1],s,a=new Headers;return typeof t=="string"?s=new URL(t):t instanceof URL?s=t:t&&t.url&&(s=new URL(t.url)),t&&typeof t=="object"&&"headers"in t&&$u.Gaxios.mergeHeaders(a,t.headers),n&&$u.Gaxios.mergeHeaders(a,new Headers(n.headers)),typeof t=="object"&&!(t instanceof URL)?this.request({...n,...t,headers:a,url:s}):this.request({...n,headers:a,url:s})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,t){let n=t.get("x-goog-user-project"),s=t.get("authorization");return n&&e.set("x-goog-user-project",n),s&&e.set("authorization",s),e}static log=(0,pC.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let n=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${n}`)}let t=e.headers.get("User-Agent");t?t.includes(`${Hu.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${t} ${Hu.USER_AGENT}`):e.headers.set("User-Agent",Hu.USER_AGENT);try{let n=e,s=n[r.RequestMethodNameSymbol],a=`${Math.floor(Math.random()*1e3)}`;n[r.RequestLogIdSymbol]=a;let u={url:e.url,headers:e.headers};s?r.log.info("%s [%s] request %j",s,a,u):r.log.info("[%s] request %j",a,u)}catch{}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let t=e.config,n=t[r.RequestMethodNameSymbol],s=t[r.RequestLogIdSymbol];n?r.log.info("%s [%s] response %j",n,s,e.data):r.log.info("[%s] response %j",s,e.data)}catch{}return e},rejected:async e=>{try{let t=e.config,n=t[r.RequestMethodNameSymbol],s=t[r.RequestLogIdSymbol];n?r.log.info("%s [%s] error %j",n,s,e.response?.data):r.log.error("[%s] error %j",s,e.response?.data)}catch{}throw e}};static setMethodName(e,t){try{let n=e;n[r.RequestMethodNameSymbol]=t}catch{}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};Ut.AuthClient=Gu});var Ju=J(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.LoginTicket=void 0;var Wu=class{envelope;payload;constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}};ui.LoginTicket=Wu});var nn=J(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.OAuth2Client=Kt.ClientAuthentication=Kt.CertificateFormat=Kt.CodeChallengeMethod=void 0;var vp=Ve(),mC=X("querystring"),gC=X("stream"),yC=Lu(),Tp=Lt(),zu=Co(),Nn=pt(),_C=Ju(),Rp;(function(r){r.Plain="plain",r.S256="S256"})(Rp||(Kt.CodeChallengeMethod=Rp={}));var pr;(function(r){r.PEM="PEM",r.JWK="JWK"})(pr||(Kt.CertificateFormat=pr={}));var Eo;(function(r){r.ClientSecretPost="ClientSecretPost",r.ClientSecretBasic="ClientSecretBasic",r.None="None"})(Eo||(Kt.ClientAuthentication=Eo={}));var Vu=class r extends Nn.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=pr.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},t,n){super(typeof e=="object"?e:{}),typeof e!="object"&&(e={clientId:e,clientSecret:t,redirectUri:n}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||Eo.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw new Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+mC.stringify(e)}generateCodeVerifier(){throw new Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,zu.createCrypto)(),n=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),a=(await e.sha256DigestBase64(n)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:n,codeChallenge:a}}getToken(e,t){let n=typeof e=="string"?{code:e}:e;if(t)this.getTokenAsync(n).then(s=>t(null,s.tokens,s.res),s=>t(s,null,s.response));else return this.getTokenAsync(n)}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),n=new Headers,s={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===Eo.ClientSecretBasic){let f=Buffer.from(`${this._clientId}:${this._clientSecret}`);n.set("authorization",`Basic ${f.toString("base64")}`)}this.clientAuthentication===Eo.ClientSecretPost&&(s.client_secret=this._clientSecret);let a={...r.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,Tp.removeUndefinedValuesInObject)(s)),headers:n};Nn.AuthClient.setMethodName(a,"getTokenAsync");let u=await this.transporter.request(a),l=u.data;return u.data&&u.data.expires_in&&(l.expiry_date=new Date().getTime()+u.data.expires_in*1e3,delete l.expires_in),this.emit("tokens",l),{tokens:l,res:u}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(n=>(this.refreshTokenPromises.delete(e),n),n=>{throw this.refreshTokenPromises.delete(e),n});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){if(!e)throw new Error("No refresh token is set.");let t=this.endpoints.oauth2TokenUrl.toString(),n={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"},s;try{let u={...r.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,Tp.removeUndefinedValuesInObject)(n))};Nn.AuthClient.setMethodName(u,"refreshTokenNoCache"),s=await this.transporter.request(u)}catch(u){throw u instanceof vp.GaxiosError&&u.message==="invalid_grant"&&u.response?.data&&/ReAuth/i.test(u.response.data.error_description)&&(u.message=JSON.stringify(u.response.data)),u}let a=s.data;return s.data&&s.data.expires_in&&(a.expiry_date=new Date().getTime()+s.data.expires_in*1e3,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:s}}refreshAccessToken(e){if(e)this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e);else return this.refreshAccessTokenAsync()}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(e)this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e);else return this.getAccessTokenAsync()}async getAccessTokenAsync(){if(!this.credentials.access_token||this.isTokenExpiring()){if(!this.credentials.refresh_token)if(this.refreshHandler){let n=await this.processAndValidateRefreshHandler();if(n?.access_token)return this.setCredentials(n),{token:this.credentials.access_token}}else throw new Error("No refresh token or refresh handler callback is set.");let t=await this.refreshAccessTokenAsync();if(!t.credentials||t.credentials&&!t.credentials.access_token)throw new Error("Could not refresh access token.");return{token:t.credentials.access_token,res:t.res}}else return{token:this.credentials.access_token}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw new Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let l=new Headers({authorization:t.token_type+" "+t.access_token});return{headers:this.addSharedMetadataHeaders(l)}}if(this.refreshHandler){let l=await this.processAndValidateRefreshHandler();if(l?.access_token){this.setCredentials(l);let f=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(f)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let n=null,s=null;try{n=await this.refreshToken(t.refresh_token),s=n.tokens}catch(l){let f=l;throw f.response&&(f.response.status===403||f.response.status===404)&&(f.message=`Could not refresh access token: ${f.message}`),f}let a=this.credentials;a.token_type=a.token_type||"Bearer",s.refresh_token=a.refresh_token,this.credentials=s;let u=new Headers({authorization:a.token_type+" "+s.access_token});return{headers:this.addSharedMetadataHeaders(u),res:n.res}}static getRevokeTokenUrl(e){return new r().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let n={...r.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(Nn.AuthClient.setMethodName(n,"revokeToken"),t)this.transporter.request(n).then(s=>t(null,s),t);else return this.transporter.request(n)}revokeCredentials(e){if(e)this.revokeCredentialsAsync().then(t=>e(null,t),e);else return this.revokeCredentialsAsync()}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw new Error("No access token to revoke.")}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){try{let n=await this.getRequestMetadataAsync();return e.headers=vp.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,n.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(n){let s=n.response;if(s){let a=s.status,u=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),l=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,f=s.config.data instanceof gC.Readable,h=a===401||a===403;if(!t&&h&&!f&&u)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&h&&!f&&l){let d=await this.processAndValidateRefreshHandler();return d?.access_token&&this.setCredentials(d),this.requestAsync(e,!0)}}throw n}}verifyIdToken(e,t){if(t&&typeof t!="function")throw new Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(t)this.verifyIdTokenAsync(e).then(n=>t(null,n),t);else return this.verifyIdTokenAsync(e)}async verifyIdTokenAsync(e){if(!e.idToken)throw new Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...r.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),n=Object.assign({expiry_date:new Date().getTime()+t.expires_in*1e3,scopes:t.scope.split(" ")},t);return delete n.expires_in,delete n.scope,n}getFederatedSignonCerts(e){if(e)this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){let e=new Date().getTime(),t=(0,zu.hasBrowserCrypto)()?pr.JWK:pr.PEM;if(this.certificateExpiry&&e<this.certificateExpiry.getTime()&&this.certificateCacheFormat===t)return{certs:this.certificateCache,format:t};let n,s;switch(t){case pr.PEM:s=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case pr.JWK:s=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw new Error(`Unsupported certificate format ${t}`)}try{let h={...r.RETRY_CONFIG,url:s};Nn.AuthClient.setMethodName(h,"getFederatedSignonCertsAsync"),n=await this.transporter.request(h)}catch(h){throw h instanceof Error&&(h.message=`Failed to retrieve verification certificates: ${h.message}`),h}let a=n?.headers.get("cache-control"),u=-1;if(a){let h=/max-age=(?<maxAge>[0-9]+)/.exec(a)?.groups?.maxAge;h&&(u=Number(h)*1e3)}let l={};switch(t){case pr.PEM:l=n.data;break;case pr.JWK:for(let h of n.data.keys)l[h.kid]=h;break;default:throw new Error(`Unsupported certificate format ${t}`)}let f=new Date;return this.certificateExpiry=u===-1?null:new Date(f.getTime()+u),this.certificateCache=l,this.certificateCacheFormat=t,{certs:l,format:t,res:n}}getIapPublicKeys(e){if(e)this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e);else return this.getIapPublicKeysAsync()}async getIapPublicKeysAsync(){let e,t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let n={...r.RETRY_CONFIG,url:t};Nn.AuthClient.setMethodName(n,"getIapPublicKeysAsync"),e=await this.transporter.request(n)}catch(n){throw n instanceof Error&&(n.message=`Failed to retrieve verification certificates: ${n.message}`),n}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw new Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,n,s,a){let u=(0,zu.createCrypto)();a||(a=r.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let l=e.split(".");if(l.length!==3)throw new Error("Wrong number of segments in token: "+e);let f=l[0]+"."+l[1],h=l[2],d,_;try{d=JSON.parse(u.decodeBase64StringUtf8(l[0]))}catch(S){throw S instanceof Error&&(S.message=`Can't parse token envelope: ${l[0]}': ${S.message}`),S}if(!d)throw new Error("Can't parse token envelope: "+l[0]);try{_=JSON.parse(u.decodeBase64StringUtf8(l[1]))}catch(S){throw S instanceof Error&&(S.message=`Can't parse token payload '${l[0]}`),S}if(!_)throw new Error("Can't parse token payload: "+l[1]);if(!Object.prototype.hasOwnProperty.call(t,d.kid))throw new Error("No pem found for envelope: "+JSON.stringify(d));let E=t[d.kid];if(d.alg==="ES256"&&(h=yC.joseToDer(h,"ES256").toString("base64")),!await u.verify(E,f,h))throw new Error("Invalid token signature: "+e);if(!_.iat)throw new Error("No issue time in token: "+JSON.stringify(_));if(!_.exp)throw new Error("No expiration time in token: "+JSON.stringify(_));let v=Number(_.iat);if(isNaN(v))throw new Error("iat field using invalid format");let A=Number(_.exp);if(isNaN(A))throw new Error("exp field using invalid format");let g=new Date().getTime()/1e3;if(A>=g+a)throw new Error("Expiration time too far in future: "+JSON.stringify(_));let b=v-r.CLOCK_SKEW_SECS_,R=A+r.CLOCK_SKEW_SECS_;if(g<b)throw new Error("Token used too early, "+g+" < "+b+": "+JSON.stringify(_));if(g>R)throw new Error("Token used too late, "+g+" > "+R+": "+JSON.stringify(_));if(s&&s.indexOf(_.iss)<0)throw new Error("Invalid issuer, expected one of ["+s+"], but got "+_.iss);if(typeof n<"u"&&n!==null){let S=_.aud,I=!1;if(n.constructor===Array?I=n.indexOf(S)>-1:I=S===n,!I)throw new Error("Wrong recipient, payload audience != requiredAudience")}return new _C.LoginTicket(d,_)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw new Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return e?e<=new Date().getTime()+this.eagerRefreshThresholdMillis:!1}};Kt.OAuth2Client=Vu});var Yu=J(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.Compute=void 0;var bC=Ve(),kp=bo(),CC=nn(),Ku=class extends CC.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e=`service-accounts/${this.serviceAccountEmail}/token`,t;try{let s={property:e};this.scopes.length>0&&(s.params={scopes:this.scopes.join(",")}),t=await kp.instance(s)}catch(s){throw s instanceof bC.GaxiosError&&(s.message=`Could not refresh access token: ${s.message}`,this.wrapError(s)),s}let n=t;return t&&t.expires_in&&(n.expiry_date=new Date().getTime()+t.expires_in*1e3,delete n.expires_in),this.emit("tokens",n),{tokens:n,res:null}}async fetchIdToken(e){let t=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`,n;try{let s={property:t};n=await kp.instance(s)}catch(s){throw s instanceof Error&&(s.message=`Could not fetch ID token: ${s.message}`),s}return n}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,t.status===403?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:t.status===404&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}};ci.Compute=Ku});var Qu=J(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.IdTokenClient=void 0;var EC=nn(),Xu=class extends EC.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let t=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:t,expiry_date:this.getIdTokenExpiryDate(t)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp*1e3}};li.IdTokenClient=Xu});var Zu=J(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.GCPEnv=void 0;In.clear=AC;In.getEnv=wC;var Fp=bo(),mr;(function(r){r.APP_ENGINE="APP_ENGINE",r.KUBERNETES_ENGINE="KUBERNETES_ENGINE",r.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",r.COMPUTE_ENGINE="COMPUTE_ENGINE",r.CLOUD_RUN="CLOUD_RUN",r.NONE="NONE"})(mr||(In.GCPEnv=mr={}));var Ao;function AC(){Ao=void 0}async function wC(){return Ao||(Ao=DC(),Ao)}async function DC(){let r=mr.NONE;return SC()?r=mr.APP_ENGINE:vC()?r=mr.CLOUD_FUNCTIONS:await kC()?await RC()?r=mr.KUBERNETES_ENGINE:TC()?r=mr.CLOUD_RUN:r=mr.COMPUTE_ENGINE:r=mr.NONE,r}function SC(){return!!(process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME)}function vC(){return!!(process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET)}function TC(){return!!process.env.K_CONFIGURATION}async function RC(){try{return await Fp.instance("attributes/cluster-name"),!0}catch{return!1}}async function kC(){return Fp.isAvailable()}});var ec=J((ZS,Op)=>{var fi=Bn().Buffer,FC=X("stream"),OC=X("util");function di(r){if(this.buffer=null,this.writable=!0,this.readable=!0,!r)return this.buffer=fi.alloc(0),this;if(typeof r.pipe=="function")return this.buffer=fi.alloc(0),r.pipe(this),this;if(r.length||typeof r=="object")return this.buffer=r,this.writable=!1,process.nextTick(function(){this.emit("end",r),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof r+")")}OC.inherits(di,FC);di.prototype.write=function(e){this.buffer=fi.concat([this.buffer,fi.from(e)]),this.emit("data",e)};di.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};Op.exports=di});var xp=J((ev,Pp)=>{"use strict";var wo=X("buffer").Buffer,tc=X("buffer").SlowBuffer;Pp.exports=hi;function hi(r,e){if(!wo.isBuffer(r)||!wo.isBuffer(e)||r.length!==e.length)return!1;for(var t=0,n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}hi.install=function(){wo.prototype.equal=tc.prototype.equal=function(e){return hi(this,e)}};var PC=wo.prototype.equal,xC=tc.prototype.equal;hi.restore=function(){wo.prototype.equal=PC,tc.prototype.equal=xC}});var sc=J((tv,$p)=>{var Ln=Bn().Buffer,vt=X("crypto"),Np=Lu(),Bp=X("util"),BC=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,Do="secret must be a string or buffer",jn="key must be a string or a buffer",NC="key must be a string, a buffer or an object",nc=typeof vt.createPublicKey=="function";nc&&(jn+=" or a KeyObject",Do+="or a KeyObject");function Ip(r){if(!Ln.isBuffer(r)&&typeof r!="string"&&(!nc||typeof r!="object"||typeof r.type!="string"||typeof r.asymmetricKeyType!="string"||typeof r.export!="function"))throw qt(jn)}function jp(r){if(!Ln.isBuffer(r)&&typeof r!="string"&&typeof r!="object")throw qt(NC)}function IC(r){if(!Ln.isBuffer(r)){if(typeof r=="string")return r;if(!nc||typeof r!="object"||r.type!=="secret"||typeof r.export!="function")throw qt(Do)}}function oc(r){return r.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Lp(r){r=r.toString();var e=4-r.length%4;if(e!==4)for(var t=0;t<e;++t)r+="=";return r.replace(/\-/g,"+").replace(/_/g,"/")}function qt(r){var e=[].slice.call(arguments,1),t=Bp.format.bind(Bp,r).apply(null,e);return new TypeError(t)}function jC(r){return Ln.isBuffer(r)||typeof r=="string"}function So(r){return jC(r)||(r=JSON.stringify(r)),r}function Up(r){return function(t,n){IC(n),t=So(t);var s=vt.createHmac("sha"+r,n),a=(s.update(t),s.digest("base64"));return oc(a)}}var rc,LC="timingSafeEqual"in vt?function(e,t){return e.byteLength!==t.byteLength?!1:vt.timingSafeEqual(e,t)}:function(e,t){return rc||(rc=xp()),rc(e,t)};function UC(r){return function(t,n,s){var a=Up(r)(t,s);return LC(Ln.from(n),Ln.from(a))}}function qp(r){return function(t,n){jp(n),t=So(t);var s=vt.createSign("RSA-SHA"+r),a=(s.update(t),s.sign(n,"base64"));return oc(a)}}function Mp(r){return function(t,n,s){Ip(s),t=So(t),n=Lp(n);var a=vt.createVerify("RSA-SHA"+r);return a.update(t),a.verify(s,n,"base64")}}function qC(r){return function(t,n){jp(n),t=So(t);var s=vt.createSign("RSA-SHA"+r),a=(s.update(t),s.sign({key:n,padding:vt.constants.RSA_PKCS1_PSS_PADDING,saltLength:vt.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return oc(a)}}function MC(r){return function(t,n,s){Ip(s),t=So(t),n=Lp(n);var a=vt.createVerify("RSA-SHA"+r);return a.update(t),a.verify({key:s,padding:vt.constants.RSA_PKCS1_PSS_PADDING,saltLength:vt.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function $C(r){var e=qp(r);return function(){var n=e.apply(null,arguments);return n=Np.derToJose(n,"ES"+r),n}}function HC(r){var e=Mp(r);return function(n,s,a){s=Np.joseToDer(s,"ES"+r).toString("base64");var u=e(n,s,a);return u}}function GC(){return function(){return""}}function WC(){return function(e,t){return t===""}}$p.exports=function(e){var t={hs:Up,rs:qp,ps:qC,es:$C,none:GC},n={hs:UC,rs:Mp,ps:MC,es:HC,none:WC},s=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!s)throw qt(BC,e);var a=(s[1]||s[3]).toLowerCase(),u=s[2];return{sign:t[a](u),verify:n[a](u)}}});var ic=J((rv,Hp)=>{var JC=X("buffer").Buffer;Hp.exports=function(e){return typeof e=="string"?e:typeof e=="number"||JC.isBuffer(e)?e.toString():JSON.stringify(e)}});var Kp=J((nv,Vp)=>{var zC=Bn().Buffer,Gp=ec(),VC=sc(),KC=X("stream"),Wp=ic(),ac=X("util");function Jp(r,e){return zC.from(r,e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function YC(r,e,t){t=t||"utf8";var n=Jp(Wp(r),"binary"),s=Jp(Wp(e),t);return ac.format("%s.%s",n,s)}function zp(r){var e=r.header,t=r.payload,n=r.secret||r.privateKey,s=r.encoding,a=VC(e.alg),u=YC(e,t,s),l=a.sign(u,n);return ac.format("%s.%s",u,l)}function pi(r){var e=r.secret||r.privateKey||r.key,t=new Gp(e);this.readable=!0,this.header=r.header,this.encoding=r.encoding,this.secret=this.privateKey=this.key=t,this.payload=new Gp(r.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}ac.inherits(pi,KC);pi.prototype.sign=function(){try{var e=zp({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(t){this.readable=!1,this.emit("error",t),this.emit("close")}};pi.sign=zp;Vp.exports=pi});var sm=J((ov,om)=>{var Xp=Bn().Buffer,Yp=ec(),XC=sc(),QC=X("stream"),Qp=ic(),ZC=X("util"),eE=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function tE(r){return Object.prototype.toString.call(r)==="[object Object]"}function rE(r){if(tE(r))return r;try{return JSON.parse(r)}catch{return}}function Zp(r){var e=r.split(".",1)[0];return rE(Xp.from(e,"base64").toString("binary"))}function nE(r){return r.split(".",2).join(".")}function em(r){return r.split(".")[2]}function oE(r,e){e=e||"utf8";var t=r.split(".")[1];return Xp.from(t,"base64").toString(e)}function tm(r){return eE.test(r)&&!!Zp(r)}function rm(r,e,t){if(!e){var n=new Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}r=Qp(r);var s=em(r),a=nE(r),u=XC(e);return u.verify(a,s,t)}function nm(r,e){if(e=e||{},r=Qp(r),!tm(r))return null;var t=Zp(r);if(!t)return null;var n=oE(r);return(t.typ==="JWT"||e.json)&&(n=JSON.parse(n,e.encoding)),{header:t,payload:n,signature:em(r)}}function Un(r){r=r||{};var e=r.secret||r.publicKey||r.key,t=new Yp(e);this.readable=!0,this.algorithm=r.algorithm,this.encoding=r.encoding,this.secret=this.publicKey=this.key=t,this.signature=new Yp(r.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}ZC.inherits(Un,QC);Un.prototype.verify=function(){try{var e=rm(this.signature.buffer,this.algorithm,this.key.buffer),t=nm(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(n){this.readable=!1,this.emit("error",n),this.emit("close")}};Un.decode=nm;Un.isValid=tm;Un.verify=rm;om.exports=Un});var uc=J(Nr=>{var im=Kp(),mi=sm(),sE=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];Nr.ALGORITHMS=sE;Nr.sign=im.sign;Nr.verify=mi.verify;Nr.decode=mi.decode;Nr.isValid=mi.isValid;Nr.createSign=function(e){return new im(e)};Nr.createVerify=function(e){return new mi(e)}});var Em=J(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.GoogleToken=void 0;var am=gi(X("fs")),iE=Ve(),aE=gi(uc()),uE=gi(X("path")),cE=X("util");function gi(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(gi=function(a,u){if(!u&&a&&a.__esModule)return a;var l,f,h={__proto__:null,default:a};if(a===null||gr(a)!="object"&&typeof a!="function")return h;if(l=u?n:t){if(l.has(a))return l.get(a);l.set(a,h)}for(var d in a)d!=="default"&&{}.hasOwnProperty.call(a,d)&&((f=(l=Object.defineProperty)&&Object.getOwnPropertyDescriptor(a,d))&&(f.get||f.set)?l(h,d,f):h[d]=a[d]);return h})(r,e)}function gr(r){"@babel/helpers - typeof";return gr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gr(r)}function lE(r,e){gm(r,e),e.add(r)}function fE(r,e,t){gm(r,e),e.set(r,t)}function gm(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function um(r,e,t){return r.set(Mt(r,e),t),t}function cm(r,e){return r.get(Mt(r,e))}function Mt(r,e,t){if(typeof r=="function"?r===e:r.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function lm(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,bm(n.key),n)}}function ym(r,e,t){return e&&lm(r.prototype,e),t&&lm(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function _m(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function dE(r,e,t){return e=ko(e),hE(r,pc()?Reflect.construct(e,t||[],ko(r).constructor):e.apply(r,t))}function hE(r,e){if(e&&(gr(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pE(r)}function pE(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function mE(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&Ro(r,e)}function cc(r){var e=typeof Map=="function"?new Map:void 0;return cc=function(n){if(n===null||!yE(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,s)}function s(){return gE(n,arguments,ko(this).constructor)}return s.prototype=Object.create(n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Ro(s,n)},cc(r)}function gE(r,e,t){if(pc())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var s=new(r.bind.apply(r,n));return t&&Ro(s,t.prototype),s}function pc(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pc=function(){return!!r})()}function yE(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function Ro(r,e){return Ro=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Ro(r,e)}function ko(r){return ko=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ko(r)}function mt(r,e,t){return(e=bm(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function bm(r){var e=_E(r,"string");return gr(e)=="symbol"?e:e+""}function _E(r,e){if(gr(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(gr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function yt(){var r,e,t=typeof Symbol=="function"?Symbol:{},n=t.iterator||"@@iterator",s=t.toStringTag||"@@toStringTag";function a(P,v,A,g){var b=v&&v.prototype instanceof l?v:l,R=Object.create(b.prototype);return gt(R,"_invoke",(function(S,I,L){var U,H,K,W=0,we=L||[],he=!1,fe={p:0,n:0,v:r,a:ye,f:ye.bind(r,4),d:function(de,Z){return U=de,H=0,K=r,fe.n=Z,u}};function ye(re,de){for(H=re,K=de,e=0;!he&&W&&!Z&&e<we.length;e++){var Z,ue=we[e],z=fe.p,oe=ue[2];re>3?(Z=oe===de)&&(K=ue[(H=ue[4])?5:(H=3,3)],ue[4]=ue[5]=r):ue[0]<=z&&((Z=re<2&&z<ue[1])?(H=0,fe.v=de,fe.n=ue[1]):z<oe&&(Z=re<3||ue[0]>de||de>oe)&&(ue[4]=re,ue[5]=de,fe.n=oe,H=0))}if(Z||re>1)return u;throw he=!0,de}return function(re,de,Z){if(W>1)throw TypeError("Generator is already running");for(he&&de===1&&ye(de,Z),H=de,K=Z;(e=H<2?r:K)||!he;){U||(H?H<3?(H>1&&(fe.n=-1),ye(H,K)):fe.n=K:fe.v=K);try{if(W=2,U){if(H||(re="next"),e=U[re]){if(!(e=e.call(U,K)))throw TypeError("iterator result is not an object");if(!e.done)return e;K=e.value,H<2&&(H=0)}else H===1&&(e=U.return)&&e.call(U),H<2&&(K=TypeError("The iterator does not provide a '"+re+"' method"),H=1);U=r}else if((e=(he=fe.n<0)?K:S.call(I,fe))!==u)break}catch(ue){U=r,H=1,K=ue}finally{W=1}}return{value:e,done:he}}})(P,A,g),!0),R}var u={};function l(){}function f(){}function h(){}e=Object.getPrototypeOf;var d=[][n]?e(e([][n]())):(gt(e={},n,function(){return this}),e),_=h.prototype=l.prototype=Object.create(d);function E(P){return Object.setPrototypeOf?Object.setPrototypeOf(P,h):(P.__proto__=h,gt(P,s,"GeneratorFunction")),P.prototype=Object.create(_),P}return f.prototype=h,gt(_,"constructor",h),gt(h,"constructor",f),f.displayName="GeneratorFunction",gt(h,s,"GeneratorFunction"),gt(_),gt(_,s,"Generator"),gt(_,n,function(){return this}),gt(_,"toString",function(){return"[object Generator]"}),(yt=function(){return{w:a,m:E}})()}function gt(r,e,t,n){var s=Object.defineProperty;try{s({},"",{})}catch{s=0}gt=function(u,l,f,h){if(l)s?s(u,l,{value:f,enumerable:!h,configurable:!h,writable:!h}):u[l]=f;else{var d=function(E,P){gt(u,E,function(v){return this._invoke(E,P,v)})};d("next",0),d("throw",1),d("return",2)}},gt(r,e,t,n)}function fm(r,e,t,n,s,a,u){try{var l=r[a](u),f=l.value}catch(h){return void t(h)}l.done?e(f):Promise.resolve(f).then(n,s)}function qn(r){return function(){var e=this,t=arguments;return new Promise(function(n,s){var a=r.apply(e,t);function u(f){fm(a,n,s,u,l,"next",f)}function l(f){fm(a,n,s,u,l,"throw",f)}u(void 0)})}}var dm=am.readFile?(0,cE.promisify)(am.readFile):qn(yt().m(function r(){return yt().w(function(e){for(;;)switch(e.n){case 0:throw new To("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},r)})),hm="https://oauth2.googleapis.com/token",bE="https://oauth2.googleapis.com/revoke?token=",To=(function(r){function e(t,n){var s;return _m(this,e),s=dE(this,e,[t]),mt(s,"code",void 0),s.code=n,s}return mE(e,r),ym(e)})(cc(Error)),vo=new WeakMap,Yt=new WeakSet,iv=yi.GoogleToken=(function(){function r(e){_m(this,r),lE(this,Yt),mt(this,"expiresAt",void 0),mt(this,"key",void 0),mt(this,"keyFile",void 0),mt(this,"iss",void 0),mt(this,"sub",void 0),mt(this,"scope",void 0),mt(this,"rawToken",void 0),mt(this,"tokenExpires",void 0),mt(this,"email",void 0),mt(this,"additionalClaims",void 0),mt(this,"eagerRefreshThresholdMillis",void 0),mt(this,"transporter",{request:function(n){return(0,iE.request)(n)}}),fE(this,vo,void 0),Mt(Yt,this,Cm).call(this,e)}return ym(r,[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var t=new Date().getTime();return this.rawToken&&this.expiresAt?t>=this.expiresAt:!0}},{key:"isTokenExpiring",value:function(){var t,n=new Date().getTime(),s=(t=this.eagerRefreshThresholdMillis)!==null&&t!==void 0?t:0;return this.rawToken&&this.expiresAt?this.expiresAt<=n+s:!0}},{key:"getToken",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(gr(t)==="object"&&(n=t,t=void 0),n=Object.assign({forceRefresh:!1},n),t){var s=t;Mt(Yt,this,pm).call(this,n).then(function(a){return s(null,a)},t);return}return Mt(Yt,this,pm).call(this,n)}},{key:"getCredentials",value:(function(){var e=qn(yt().m(function n(s){var a,u,l,f,h,d,_;return yt().w(function(E){for(;;)switch(E.n){case 0:a=uE.extname(s),_=a,E.n=_===".json"?1:_===".der"||_===".crt"||_===".pem"?4:_===".p12"||_===".pfx"?6:7;break;case 1:return E.n=2,dm(s,"utf8");case 2:if(u=E.v,l=JSON.parse(u),f=l.private_key,h=l.client_email,!(!f||!h)){E.n=3;break}throw new To("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return E.a(2,{privateKey:f,clientEmail:h});case 4:return E.n=5,dm(s,"utf8");case 5:return d=E.v,E.a(2,{privateKey:d});case 6:throw new To("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new To("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return E.a(2)}},n)}));function t(n){return e.apply(this,arguments)}return t})()},{key:"revokeToken",value:function(t){if(t){Mt(Yt,this,mm).call(this).then(function(){return t()},t);return}return Mt(Yt,this,mm).call(this)}}])})();function pm(r){return lc.apply(this,arguments)}function lc(){return lc=qn(yt().m(function r(e){return yt().w(function(t){for(;;)switch(t.n){case 0:if(!(cm(vo,this)&&!e.forceRefresh)){t.n=1;break}return t.a(2,cm(vo,this));case 1:return t.p=1,t.n=2,um(vo,this,Mt(Yt,this,CE).call(this,e));case 2:return t.a(2,t.v);case 3:return t.p=3,um(vo,this,void 0),t.f(3);case 4:return t.a(2)}},r,this,[[1,,3,4]])})),lc.apply(this,arguments)}function CE(r){return fc.apply(this,arguments)}function fc(){return fc=qn(yt().m(function r(e){var t;return yt().w(function(n){for(;;)switch(n.n){case 0:if(!(this.isTokenExpiring()===!1&&e.forceRefresh===!1)){n.n=1;break}return n.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){n.n=2;break}throw new Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){n.n=4;break}return n.n=3,this.getCredentials(this.keyFile);case 3:t=n.v,this.key=t.privateKey,this.iss=t.clientEmail||this.iss,t.clientEmail||Mt(Yt,this,EE).call(this);case 4:return n.a(2,Mt(Yt,this,AE).call(this))}},r,this)})),fc.apply(this,arguments)}function EE(){if(!this.iss)throw new To("email is required.","MISSING_CREDENTIALS")}function mm(){return dc.apply(this,arguments)}function dc(){return dc=qn(yt().m(function r(){var e;return yt().w(function(t){for(;;)switch(t.n){case 0:if(this.accessToken){t.n=1;break}throw new Error("No token to revoke.");case 1:return e=bE+this.accessToken,t.n=2,this.transporter.request({url:e,retry:!0});case 2:Mt(Yt,this,Cm).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return t.a(2)}},r,this)})),dc.apply(this,arguments)}function Cm(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.keyFile=r.keyFile,this.key=r.key,this.rawToken=void 0,this.iss=r.email||r.iss,this.sub=r.sub,this.additionalClaims=r.additionalClaims,gr(r.scope)==="object"?this.scope=r.scope.join(" "):this.scope=r.scope,this.eagerRefreshThresholdMillis=r.eagerRefreshThresholdMillis,r.transporter&&(this.transporter=r.transporter)}function AE(){return hc.apply(this,arguments)}function hc(){return hc=qn(yt().m(function r(){var e,t,n,s,a,u,l,f,h,d;return yt().w(function(_){for(;;)switch(_.n){case 0:return e=Math.floor(new Date().getTime()/1e3),t=this.additionalClaims||{},n=Object.assign({iss:this.iss,scope:this.scope,aud:hm,exp:e+3600,iat:e,sub:this.sub},t),s=aE.sign({header:{alg:"RS256"},payload:n,secret:this.key}),_.p=1,_.n=2,this.transporter.request({method:"POST",url:hm,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:s}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return a=_.v,this.rawToken=a.data,this.expiresAt=a.data.expires_in===null||a.data.expires_in===void 0?void 0:(e+a.data.expires_in)*1e3,_.a(2,this.rawToken);case 3:throw _.p=3,d=_.v,this.rawToken=void 0,this.tokenExpires=void 0,f=d.response&&(u=d.response)!==null&&u!==void 0&&u.data?(l=d.response)===null||l===void 0?void 0:l.data:{},f.error&&(h=f.error_description?": ".concat(f.error_description):"",d.message="".concat(f.error).concat(h)),d;case 4:return _.a(2)}},r,this,[[1,3]])})),hc.apply(this,arguments)}});var gc=J(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.JWTAccess=void 0;var wE=uc(),DE=Lt(),Am={alg:"RS256",typ:"JWT"},mc=class r{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new DE.LRUCache({capacity:500,maxAge:3600*1e3});constructor(e,t,n,s){this.email=e,this.key=t,this.keyId=n,this.eagerRefreshThresholdMillis=s??300*1e3}getCachedKey(e,t){let n=e;if(t&&Array.isArray(t)&&t.length?n=e?`${e}_${t.join("_")}`:`${t.join("_")}`:typeof t=="string"&&(n=e?`${e}_${t}`:t),!n)throw Error("Scopes or url must be provided");return n}getRequestHeaders(e,t,n){let s=this.getCachedKey(e,n),a=this.cache.get(s),u=Date.now();if(a&&a.expiration-u>this.eagerRefreshThresholdMillis)return new Headers(a.headers);let l=Math.floor(Date.now()/1e3),f=r.getExpirationTime(l),h;if(Array.isArray(n)&&(n=n.join(" ")),n?h={iss:this.email,sub:this.email,scope:n,exp:f,iat:l}:h={iss:this.email,sub:this.email,aud:e,exp:f,iat:l},t){for(let v in h)if(t[v])throw new Error(`The '${v}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let d=this.keyId?{...Am,kid:this.keyId}:Am,_=Object.assign(h,t),E=wE.sign({header:d,payload:_,secret:this.key}),P=new Headers({authorization:`Bearer ${E}`});return this.cache.set(s,{expiration:f*1e3,headers:P}),P}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,n)=>{e||n(new Error("Must pass in a stream containing the service account auth settings."));let s="";e.setEncoding("utf8").on("data",a=>s+=a).on("error",n).on("end",()=>{try{let a=JSON.parse(s);this.fromJSON(a),t()}catch(a){n(a)}})})}};_i.JWTAccess=mc});var _c=J(Ci=>{"use strict";Object.defineProperty(Ci,"__esModule",{value:!0});Ci.JWT=void 0;var wm=Em(),SE=gc(),vE=nn(),bi=pt(),yc=class r extends vE.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new r(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==bi.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==bi.DEFAULT_UNIVERSE)throw new RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${bi.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:n}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${n.id_token}`}))}}else{this.access||(this.access=new SE.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis));let n;this.hasUserScopes()?n=this.scopes:e||(n=this.defaultScopes);let s=this.useJWTAccessWithScope||this.universeDomain!==bi.DEFAULT_UNIVERSE,a=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,s?n:void 0);return{headers:this.addSharedMetadataHeaders(a)}}else return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let t=new wm.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw new Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return this.scopes?this.scopes.length>0:!1}hasAnyScopes(){return!!(this.scopes&&this.scopes.length>0||this.defaultScopes&&this.defaultScopes.length>0)}authorize(e){if(e)this.authorizeAsync().then(t=>e(null,t),e);else return this.authorizeAsync()}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw new Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),n={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",n),{res:null,tokens:n}}createGToken(){return this.gtoken||(this.gtoken=new wm.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,n)=>{if(!e)throw new Error("Must pass in a stream containing the service account auth settings.");let s="";e.setEncoding("utf8").on("error",n).on("data",a=>s+=a).on("end",()=>{try{let a=JSON.parse(s);this.fromJSON(a),t()}catch(a){n(a)}})})}fromAPIKey(e){if(typeof e!="string")throw new Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let t=await this.createGToken().getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw new Error("A key or a keyFile must be provided to getCredentials.")}};Ci.JWT=yc});var Cc=J(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.UserRefreshClient=Mn.USER_REFRESH_ACCOUNT_TYPE=void 0;var TE=nn(),RE=pt();Mn.USER_REFRESH_ACCOUNT_TYPE="authorized_user";var bc=class r extends TE.OAuth2Client{_refreshToken;constructor(e,t,n,s,a){let u=e&&typeof e=="object"?e:{clientId:e,clientSecret:t,refreshToken:n,eagerRefreshThresholdMillis:s,forceRefreshOnFailure:a};super(u),this._refreshToken=u.refreshToken,this.credentials.refresh_token=u.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let t={...r.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return RE.AuthClient.setMethodName(t,"fetchIdToken"),(await this.transporter.request(t)).data.id_token}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the user refresh token");if(e.type!=="authorized_user")throw new Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw new Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw new Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw new Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}async fromStreamAsync(e){return new Promise((t,n)=>{if(!e)return n(new Error("Must pass in a stream containing the user refresh token."));let s="";e.setEncoding("utf8").on("error",n).on("data",a=>s+=a).on("end",()=>{try{let a=JSON.parse(s);return this.fromJSON(a),t()}catch(a){return n(a)}})})}static fromJSON(e){let t=new r;return t.fromJSON(e),t}};Mn.UserRefreshClient=bc});var Ac=J($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.Impersonated=$n.IMPERSONATED_ACCOUNT_TYPE=void 0;var Dm=nn(),kE=Ve(),FE=Lt();$n.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";var Ec=class r extends Dm.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new Dm.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,!!!(0,FE.originalOrCamelOptions)(e).get("universe_domain"))this.universeDomain=this.sourceClient.universeDomain;else if(this.sourceClient.universeDomain!==this.universeDomain)throw new RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`);this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${t}:signBlob`,s={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...r.RETRY_CONFIG,url:n,data:s,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,n={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},s=await this.sourceClient.request({...r.RETRY_CONFIG,url:t,data:n,method:"POST"}),a=s.data;return this.credentials.access_token=a.accessToken,this.credentials.expiry_date=Date.parse(a.expireTime),{tokens:this.credentials,res:s}}catch(e){if(!(e instanceof Error))throw e;let t=0,n="";throw e instanceof kE.GaxiosError&&(t=e?.response?.data?.error?.status,n=e?.response?.data?.error?.message),t&&n?(e.message=`${t}: unable to impersonate: ${n}`,e):(e.message=`unable to impersonate: ${e}`,e)}}async fetchIdToken(e,t){await this.sourceClient.getAccessToken();let n=`projects/-/serviceAccounts/${this.targetPrincipal}`,s=`${this.endpoint}/v1/${n}:generateIdToken`,a={delegates:this.delegates,audience:e,includeEmail:t?.includeEmail??!0,useEmailAzp:t?.includeEmail??!0};return(await this.sourceClient.request({...r.RETRY_CONFIG,url:s,data:a,method:"POST"})).data.token}};$n.Impersonated=Ec});var Dc=J(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.OAuthClientAuthHandler=void 0;Fo.getErrorFromOAuthErrorResponse=xE;var Hn=Ve(),OE=Co(),PE=["PUT","POST","PATCH"],wc=class{#e=(0,OE.createCrypto)();#t;transporter;constructor(e){e&&"clientId"in e?(this.#t=e,this.transporter=new Hn.Gaxios):(this.#t=e?.clientAuthentication,this.transporter=e?.transporter||new Hn.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=Hn.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){if(t)e.headers=Hn.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(this.#t?.confidentialClientType==="basic"){e.headers=Hn.Gaxios.mergeHeaders(e.headers);let n=this.#t.clientId,s=this.#t.clientSecret||"",a=this.#e.encodeBase64StringUtf8(`${n}:${s}`);Hn.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${a}`})}}injectAuthenticatedRequestBody(e){if(this.#t?.confidentialClientType==="request-body"){let t=(e.method||"GET").toUpperCase();if(!PE.includes(t))throw new Error(`${t} HTTP method does not support ${this.#t.confidentialClientType} client authentication`);let s=new Headers(e.headers).get("content-type");if(s?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let a=new URLSearchParams(e.data??"");a.append("client_id",this.#t.clientId),a.append("client_secret",this.#t.clientSecret||""),e.data=a}else if(s?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#t.clientId,client_secret:this.#t.clientSecret||""});else throw new Error(`${s} content-types are not supported with ${this.#t.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};Fo.OAuthClientAuthHandler=wc;function xE(r,e){let t=r.error,n=r.error_description,s=r.error_uri,a=`Error code ${t}`;typeof n<"u"&&(a+=`: ${n}`),typeof s<"u"&&(a+=` - ${s}`);let u=new Error(a);if(e){let l=Object.keys(e);e.stack&&l.push("stack"),l.forEach(f=>{f!=="message"&&Object.defineProperty(u,f,{value:e[f],writable:!1,enumerable:!0})})}return u}});var Ai=J(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.StsCredentials=void 0;var BE=Ve(),NE=pt(),Sm=Dc(),IE=Lt(),Sc=class r extends Sm.OAuthClientAuthHandler{#e;constructor(e={tokenExchangeEndpoint:""},t){(typeof e!="object"||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:t}),super(e),this.#e=e.tokenExchangeEndpoint}async exchangeToken(e,t,n){let s={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:n&&JSON.stringify(n)},a={...r.RETRY_CONFIG,url:this.#e.toString(),method:"POST",headers:t,data:new URLSearchParams((0,IE.removeUndefinedValuesInObject)(s))};NE.AuthClient.setMethodName(a,"exchangeToken"),this.applyClientAuthenticationOptions(a);try{let u=await this.transporter.request(a),l=u.data;return l.res=u,l}catch(u){throw u instanceof BE.GaxiosError&&u.response?(0,Sm.getErrorFromOAuthErrorResponse)(u.response.data,u):u}}};Ei.StsCredentials=Sc});var Ir=J(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.BaseExternalAccountClient=Tt.CLOUD_RESOURCE_MANAGER=Tt.EXTERNAL_ACCOUNT_TYPE=Tt.EXPIRATION_TIME_OFFSET=void 0;var jE=Ve(),LE=X("stream"),vc=pt(),UE=Ai(),vm=Lt(),qE=Mu(),ME="urn:ietf:params:oauth:grant-type:token-exchange",$E="urn:ietf:params:oauth:token-type:access_token",Tc="https://www.googleapis.com/auth/cloud-platform",HE=3600;Tt.EXPIRATION_TIME_OFFSET=300*1e3;Tt.EXTERNAL_ACCOUNT_TYPE="external_account";Tt.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";var GE="//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+",WE="https://sts.{universeDomain}/v1/token",Rc=class r extends vc.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#e=null;constructor(e){super(e);let t=(0,vm.originalOrCamelOptions)(e),n=t.get("type");if(n&&n!==Tt.EXTERNAL_ACCOUNT_TYPE)throw new Error(`Expected "${Tt.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let s=t.get("client_id"),a=t.get("client_secret");this.tokenUrl=t.get("token_url")??WE.replace("{universeDomain}",this.universeDomain);let u=t.get("subject_token_type"),l=t.get("workforce_pool_user_project"),f=t.get("service_account_impersonation_url"),h=t.get("service_account_impersonation"),d=(0,vm.originalOrCamelOptions)(h).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(t.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),s&&(this.clientAuth={confidentialClientType:"basic",clientId:s,clientSecret:a}),this.stsCredential=new UE.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=t.get("scopes")||[Tc],this.cachedAccessToken=null,this.audience=t.get("audience"),this.subjectTokenType=u,this.workforcePoolUserProject=l;let _=new RegExp(GE);if(this.workforcePoolUserProject&&!this.audience.match(_))throw new Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=f,this.serviceAccountImpersonationLifetime=d,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=HE),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw new RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);return/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl)?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),n={...r.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`};vc.AuthClient.setMethodName(n,"getProjectId");let s=await this.transporter.request(n);return this.projectId=s.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=jE.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let u=a.status,l=a.config.data instanceof LE.Readable;if(!t&&(u===401||u===403)&&!l&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){this.#e=this.#e||this.#t();try{return await this.#e}finally{this.#e=null}}async#t(){let e=await this.retrieveSubjectToken(),t={grantType:ME,audience:this.audience,requestedTokenType:$E,subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[Tc]:this.getScopesArray()},n=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,s=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),a=await this.stsCredential.exchangeToken(t,s,n);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(a.access_token):a.expires_in?this.cachedAccessToken={access_token:a.access_token,expiry_date:new Date().getTime()+a.expires_in*1e3,res:a.res}:this.cachedAccessToken={access_token:a.access_token,res:a.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...r.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};vc.AuthClient.setMethodName(t,"getImpersonatedAccessToken");let n=await this.transporter.request(t),s=n.data;return{access_token:s.accessToken,expiry_date:new Date(s.expireTime).getTime(),res:n}}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}getScopesArray(){return typeof this.scopes=="string"?[this.scopes]:this.scopes||[Tc]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=this.serviceAccountImpersonationUrl!==void 0,n=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${qE.pkg.version} google-byoid-sdk source/${n} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}};Tt.BaseExternalAccountClient=Rc});var Tm=J(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.FileSubjectTokenSupplier=void 0;var Fc=X("util"),Oc=X("fs"),JE=(0,Fc.promisify)(Oc.readFile??(()=>{})),zE=(0,Fc.promisify)(Oc.realpath??(()=>{})),VE=(0,Fc.promisify)(Oc.lstat??(()=>{})),kc=class{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e=this.filePath;try{if(e=await zE(e),!(await VE(e)).isFile())throw new Error}catch(s){throw s instanceof Error&&(s.message=`The file at ${e} does not exist, or it is not a file. ${s.message}`),s}let t,n=await JE(e,{encoding:"utf8"});if(this.formatType==="text"?t=n:this.formatType==="json"&&this.subjectTokenFieldName&&(t=JSON.parse(n)[this.subjectTokenFieldName]),!t)throw new Error("Unable to parse the subject_token from the credential_source file");return t}};wi.FileSubjectTokenSupplier=kc});var Rm=J(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.UrlSubjectTokenSupplier=void 0;var KE=pt(),Pc=class{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};KE.AuthClient.setMethodName(t,"getSubjectToken");let n;if(this.formatType==="text"?n=(await e.transporter.request(t)).data:this.formatType==="json"&&this.subjectTokenFieldName&&(n=(await e.transporter.request(t)).data[this.subjectTokenFieldName]),!n)throw new Error("Unable to parse the subject_token from the credential_source URL");return n}};Di.UrlSubjectTokenSupplier=Pc});var km=J(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.CertificateSubjectTokenSupplier=_t.InvalidConfigurationError=_t.CertificateSourceUnavailableError=_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;var Si=Lt(),vi=X("fs"),Ti=X("crypto"),YE=X("https");_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";var Xt=class extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}};_t.CertificateSourceUnavailableError=Xt;var Rt=class extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}};_t.InvalidConfigurationError=Rt;var xc=class{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new Rt("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new Rt("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new Rt("Cannot create mTLS Agent with missing certificate or key");return new YE.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#e();let{certPath:e,keyPath:t}=await this.#t();return{cert:this.cert,key:this.key}=await this.#r(e,t),await this.#n(this.cert)}async#e(){let e=this.certificateConfigPath;if(e){if(await(0,Si.isValidFile)(e))return e;throw new Xt(`Provided certificate config path is invalid: ${e}`)}let t=process.env[_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(t){if(await(0,Si.isValidFile)(t))return t;throw new Xt(`Path from environment variable "${_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${t}`)}let n=(0,Si.getWellKnownCertificateConfigFileLocation)();if(await(0,Si.isValidFile)(n))return n;throw new Xt(`Could not find certificate configuration file. Searched override path, the "${_t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${n}).`)}async#t(){let e=this.certificateConfigPath,t;try{t=await vi.promises.readFile(e,"utf8")}catch{throw new Xt(`Failed to read certificate config file at: ${e}`)}try{let n=JSON.parse(t),s=n?.cert_configs?.workload?.cert_path,a=n?.cert_configs?.workload?.key_path;if(!s||!a)throw new Rt(`Certificate config file (${e}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:s,keyPath:a}}catch(n){throw n instanceof Rt?n:new Rt(`Failed to parse certificate config from ${e}: ${n.message}`)}}async#r(e,t){let n,s;try{n=await vi.promises.readFile(e),new Ti.X509Certificate(n)}catch(a){let u=a instanceof Error?a.message:String(a);throw new Xt(`Failed to read certificate file at ${e}: ${u}`)}try{s=await vi.promises.readFile(t),(0,Ti.createPrivateKey)(s)}catch(a){let u=a instanceof Error?a.message:String(a);throw new Xt(`Failed to read private key file at ${t}: ${u}`)}return{cert:n,key:s}}async#n(e){let t=new Ti.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let a=((await vi.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((f,h)=>{try{return new Ti.X509Certificate(f)}catch(d){let _=d instanceof Error?d.message:String(d);throw new Rt(`Failed to parse certificate at index ${h} in trust chain file ${this.trustChainPath}: ${_}`)}}),u=a.findIndex(f=>t.raw.equals(f.raw)),l;if(u===-1)l=[t,...a];else if(u===0)l=a;else throw new Rt(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${u}).`);return JSON.stringify(l.map(f=>f.raw.toString("base64")))}catch(n){if(n instanceof Rt)throw n;let s=n instanceof Error?n.message:String(n);throw new Xt(`Failed to process certificate chain from ${this.trustChainPath}: ${s}`)}}};_t.CertificateSubjectTokenSupplier=xc});var Ic=J(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});Ri.IdentityPoolClient=void 0;var XE=Ir(),Bc=Lt(),QE=Tm(),ZE=Rm(),Fm=km(),eA=Ai(),Om=Ve(),Nc=class r extends XE.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let t=(0,Bc.originalOrCamelOptions)(e),n=t.get("credential_source"),s=t.get("subject_token_supplier");if(!n&&!s)throw new Error("A credential source or subject token supplier must be specified.");if(n&&s)throw new Error("Only one of credential source or subject token supplier can be specified.");if(s)this.subjectTokenSupplier=s,this.credentialSourceType="programmatic";else{let a=(0,Bc.originalOrCamelOptions)(n),u=(0,Bc.originalOrCamelOptions)(a.get("format")),l=u.get("type")||"text",f=u.get("subject_token_field_name");if(l!=="json"&&l!=="text")throw new Error(`Invalid credential_source format "${l}"`);if(l==="json"&&!f)throw new Error("Missing subject_token_field_name for JSON credential_source format");let h=a.get("file"),d=a.get("url"),_=a.get("certificate"),E=a.get("headers");if(h&&d||d&&_||h&&_)throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(h)this.credentialSourceType="file",this.subjectTokenSupplier=new QE.FileSubjectTokenSupplier({filePath:h,formatType:l,subjectTokenFieldName:f});else if(d)this.credentialSourceType="url",this.subjectTokenSupplier=new ZE.UrlSubjectTokenSupplier({url:d,formatType:l,subjectTokenFieldName:f,headers:E,additionalGaxiosOptions:r.RETRY_CONFIG});else if(_){this.credentialSourceType="certificate";let P=new Fm.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:_.use_default_certificate_config,certificateConfigLocation:_.certificate_config_location,trustChainPath:_.trust_chain_path});this.subjectTokenSupplier=P}else throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof Fm.CertificateSubjectTokenSupplier){let t=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new eA.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new Om.Gaxios({agent:t})}),this.transporter=new Om.Gaxios({...this.transporter.defaults||{},agent:t})}return e}};Ri.IdentityPoolClient=Nc});var Lc=J(Fi=>{"use strict";Object.defineProperty(Fi,"__esModule",{value:!0});Fi.AwsRequestSigner=void 0;var ki=Ve(),xm=Co(),Pm="AWS4-HMAC-SHA256",tA="aws4_request",jc=class{getCredentials;region;crypto;constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,xm.createCrypto)()}async getRequestOptions(e){if(!e.url)throw new RangeError('"url" is required in "amzOptions"');let t=typeof e.data=="object"?JSON.stringify(e.data):e.data,n=e.url,s=e.method||"GET",a=e.body||t,u=e.headers,l=await this.getCredentials(),f=new URL(n);if(typeof a!="string"&&a!==void 0)throw new TypeError(`'requestPayload' is expected to be a string if provided. Got: ${a}`);let h=await nA({crypto:this.crypto,host:f.host,canonicalUri:f.pathname,canonicalQuerystring:f.search.slice(1),method:s,region:this.region,securityCredentials:l,requestPayload:a,additionalAmzHeaders:u}),d=ki.Gaxios.mergeHeaders(h.amzDate?{"x-amz-date":h.amzDate}:{},{authorization:h.authorizationHeader,host:f.host},u||{});l.token&&ki.Gaxios.mergeHeaders(d,{"x-amz-security-token":l.token});let _={url:n,method:s,headers:d};return a!==void 0&&(_.body=a),_}};Fi.AwsRequestSigner=jc;async function Oo(r,e,t){return await r.signWithHmacSha256(e,t)}async function rA(r,e,t,n,s){let a=await Oo(r,`AWS4${e}`,t),u=await Oo(r,a,n),l=await Oo(r,u,s);return await Oo(r,l,"aws4_request")}async function nA(r){let e=ki.Gaxios.mergeHeaders(r.additionalAmzHeaders),t=r.requestPayload||"",n=r.host.split(".")[0],s=new Date,a=s.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),u=s.toISOString().replace(/[-]/g,"").replace(/T.*/,"");r.securityCredentials.token&&e.set("x-amz-security-token",r.securityCredentials.token);let l=ki.Gaxios.mergeHeaders({host:r.host},e.has("date")?{}:{"x-amz-date":a},e),f="",h=[...l.keys()].sort();h.forEach(R=>{f+=`${R}:${l.get(R)}
`});let d=h.join(";"),_=await r.crypto.sha256DigestHex(t),E=`${r.method.toUpperCase()}
${r.canonicalUri}
${r.canonicalQuerystring}
${f}
${d}
${_}`,P=`${u}/${r.region}/${n}/${tA}`,v=`${Pm}
${a}
${P}
`+await r.crypto.sha256DigestHex(E),A=await rA(r.crypto,r.securityCredentials.secretAccessKey,u,r.region,n),g=await Oo(r.crypto,A,v),b=`${Pm} Credential=${r.securityCredentials.accessKeyId}/${P}, SignedHeaders=${d}, Signature=${(0,xm.fromArrayBufferToHex)(g)}`;return{amzDate:e.has("date")?void 0:a,authorizationHeader:b,canonicalQuerystring:r.canonicalQuerystring}}});var Bm=J(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.DefaultAwsSecurityCredentialsSupplier=void 0;var Oi=pt(),Uc=class{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#n)return this.#n;let t=new Headers;if(!this.#n&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#e(e.transporter)),!this.regionUrl)throw new RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let n={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};Oi.AuthClient.setMethodName(n,"getAwsRegion");let s=await e.transporter.request(n);return s.data.substr(0,s.data.length-1)}async getAwsSecurityCredentials(e){if(this.#o)return this.#o;let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#e(e.transporter));let n=await this.#t(t,e.transporter),s=await this.#r(n,t,e.transporter);return{accessKeyId:s.AccessKeyId,secretAccessKey:s.SecretAccessKey,token:s.Token}}async#e(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return Oi.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data}async#t(e,t){if(!this.securityCredentialsUrl)throw new Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let n={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return Oi.AuthClient.setMethodName(n,"#getAwsRoleName"),(await t.request(n)).data}async#r(e,t,n){let s={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return Oi.AuthClient.setMethodName(s,"#retrieveAwsSecurityCredentials"),(await n.request(s)).data}get#n(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get#o(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}};Pi.DefaultAwsSecurityCredentialsSupplier=Uc});var Mc=J(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});xi.AwsClient=void 0;var oA=Lc(),sA=Ir(),iA=Bm(),Nm=Lt(),aA=Ve(),qc=class r extends sA.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static#e="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let t=(0,Nm.originalOrCamelOptions)(e),n=t.get("credential_source"),s=t.get("aws_security_credentials_supplier");if(!n&&!s)throw new Error("A credential source or AWS security credentials supplier must be specified.");if(n&&s)throw new Error("Only one of credential source or AWS security credentials supplier can be specified.");if(s)this.awsSecurityCredentialsSupplier=s,this.regionalCredVerificationUrl=r.#e,this.credentialSourceType="programmatic";else{let a=(0,Nm.originalOrCamelOptions)(n);this.environmentId=a.get("environment_id");let u=a.get("region_url"),l=a.get("url"),f=a.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new iA.DefaultAwsSecurityCredentialsSupplier({regionUrl:u,securityCredentialsUrl:l,imdsV2SessionTokenUrl:f}),this.regionalCredVerificationUrl=a.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(!e||!this.regionalCredVerificationUrl)throw new Error('No valid AWS "credential_source" provided');if(parseInt(e[2],10)!==1)throw new Error(`aws version "${e[2]}" is not supported in the current build.`)}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new oA.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...r.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[];return aA.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((s,a)=>t.push({key:a,value:s})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}};xi.AwsClient=qc});var Jc=J(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.InvalidSubjectTokenError=je.InvalidMessageFieldError=je.InvalidCodeFieldError=je.InvalidTokenTypeFieldError=je.InvalidExpirationTimeFieldError=je.InvalidSuccessFieldError=je.InvalidVersionFieldError=je.ExecutableResponseError=je.ExecutableResponse=void 0;var Bi="urn:ietf:params:oauth:token-type:saml2",$c="urn:ietf:params:oauth:token-type:id_token",Hc="urn:ietf:params:oauth:token-type:jwt",Gc=class{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new Ni("Executable response must contain a 'version' field.");if(e.success===void 0)throw new Ii("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==Bi&&this.tokenType!==$c&&this.tokenType!==Hc)throw new ji(`Executable response must contain a 'token_type' field when successful and it must be one of ${$c}, ${Hc}, or ${Bi}.`);if(this.tokenType===Bi){if(!e.saml_response)throw new Po(`Executable response must contain a 'saml_response' field when token_type=${Bi}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new Po(`Executable response must contain a 'id_token' field when token_type=${$c} or ${Hc}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new Li("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new Ui("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return this.expirationTime!==void 0&&this.expirationTime<Math.round(Date.now()/1e3)}};je.ExecutableResponse=Gc;var Qt=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};je.ExecutableResponseError=Qt;var Ni=class extends Qt{};je.InvalidVersionFieldError=Ni;var Ii=class extends Qt{};je.InvalidSuccessFieldError=Ii;var Wc=class extends Qt{};je.InvalidExpirationTimeFieldError=Wc;var ji=class extends Qt{};je.InvalidTokenTypeFieldError=ji;var Li=class extends Qt{};je.InvalidCodeFieldError=Li;var Ui=class extends Qt{};je.InvalidMessageFieldError=Ui;var Po=class extends Qt{};je.InvalidSubjectTokenError=Po});var Kc=J(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.PluggableAuthHandler=Gn.ExecutableError=void 0;var on=Jc(),uA=X("child_process"),zc=X("fs"),qi=class extends Error{code;constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}};Gn.ExecutableError=qi;var Vc=class r{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw new Error("No command provided.");if(this.commandComponents=r.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw new Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,n)=>{let s=uA.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),a="";s.stdout.on("data",l=>{a+=l}),s.stderr.on("data",l=>{a+=l});let u=setTimeout(()=>(s.removeAllListeners(),s.kill(),n(new Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);s.on("close",l=>{if(clearTimeout(u),l===0)try{let f=JSON.parse(a),h=new on.ExecutableResponse(f);return t(h)}catch(f){return f instanceof on.ExecutableResponseError?n(f):n(new on.ExecutableResponseError(`The executable returned an invalid response: ${a}`))}else return n(new qi(a,l.toString()))})})}async retrieveCachedResponse(){if(!this.outputFile||this.outputFile.length===0)return;let e;try{e=await zc.promises.realpath(this.outputFile)}catch{return}if(!(await zc.promises.lstat(e)).isFile())return;let t=await zc.promises.readFile(e,{encoding:"utf8"});if(t!=="")try{let n=JSON.parse(t);return new on.ExecutableResponse(n).isValid()?new on.ExecutableResponse(n):void 0}catch(n){throw n instanceof on.ExecutableResponseError?n:new on.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw new Error(`Provided command: "${e}" could not be parsed.`);for(let n=0;n<t.length;n++)t[n][0]==='"'&&t[n].slice(-1)==='"'&&(t[n]=t[n].slice(1,-1));return t}};Gn.PluggableAuthHandler=Vc});var Xc=J(Wn=>{"use strict";Object.defineProperty(Wn,"__esModule",{value:!0});Wn.PluggableAuthClient=Wn.ExecutableError=void 0;var cA=Ir(),lA=Jc(),Im=Kc(),fA=Kc();Object.defineProperty(Wn,"ExecutableError",{enumerable:!0,get:function(){return fA.ExecutableError}});var dA=30*1e3,jm=5*1e3,Lm=120*1e3,hA="GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES",Um=1,Yc=class extends cA.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(this.command=e.credential_source.executable.command,!this.command)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(e.credential_source.executable.timeout_millis===void 0)this.timeoutMillis=dA;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<jm||this.timeoutMillis>Lm)throw new Error(`Timeout must be between ${jm} and ${Lm} milliseconds.`);this.outputFile=e.credential_source.executable.output_file,this.handler=new Im.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){if(process.env[hA]!=="1")throw new Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");let e;if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let n=this.getServiceAccountEmail();n&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",n),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>Um)throw new Error(`Version of executable is not currently supported, maximum supported version is ${Um}.`);if(!e.success)throw new Im.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new lA.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw new Error("Executable response is expired.");return e.subjectToken}};Wn.PluggableAuthClient=Yc});var Zc=J(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});Mi.ExternalAccountClient=void 0;var pA=Ir(),mA=Ic(),gA=Mc(),yA=Xc(),Qc=class{constructor(){throw new Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===pA.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new gA.AwsClient(e):e.credential_source?.executable?new yA.PluggableAuthClient(e):new mA.IdentityPoolClient(e):null}};Mi.ExternalAccountClient=Qc});var Hm=J(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.ExternalAccountAuthorizedUserClient=Jn.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;var Mm=pt(),qm=Dc(),$m=Ve(),_A=X("stream"),bA=Ir();Jn.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";var CA="https://sts.{universeDomain}/v1/oauthtoken",el=class r extends qm.OAuthClientAuthHandler{#e;constructor(e){super(e),this.#e=e.tokenRefreshEndpoint}async refreshToken(e,t){let n={...r.RETRY_CONFIG,url:this.#e,method:"POST",headers:t,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};Mm.AuthClient.setMethodName(n,"refreshToken"),this.applyClientAuthenticationOptions(n);try{let s=await this.transporter.request(n),a=s.data;return a.res=s,a}catch(s){throw s instanceof $m.GaxiosError&&s.response?(0,qm.getErrorFromOAuthErrorResponse)(s.response.data,s):s}}},tl=class extends Mm.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let t={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new el({tokenRefreshEndpoint:e.token_url??CA.replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:t}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,typeof e?.eagerRefreshThresholdMillis!="number"?this.eagerRefreshThresholdMillis=bA.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=$m.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let u=a.status,l=a.config.data instanceof _A.Readable;if(!t&&(u===401||u===403)&&!l&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+e.expires_in*1e3,res:e.res},e.refresh_token!==void 0&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};Jn.ExternalAccountAuthorizedUserClient=tl});var zm=J($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.GoogleAuth=$t.GoogleAuthExceptionMessages=void 0;var EA=X("child_process"),xo=X("fs"),AA=Ve(),Bo=bo(),wA=X("os"),rl=X("path"),DA=Co(),SA=Yu(),vA=Qu(),TA=Zu(),zn=_c(),Gm=Cc(),Vn=Ac(),RA=Zc(),No=Ir(),nl=pt(),Wm=Hm(),Jm=Lt();$t.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:`Unable to detect a Project Id in the current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_CREDENTIALS_FOUND:`Unable to find credentials in current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:`Unable to detect a Universe Domain in the current environment.
To learn more about Universe Domain retrieval, visit: 
https://cloud.google.com/compute/docs/metadata/predefined-metadata-keys`};var ol=class{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#e=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw new RangeError($t.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(e)this.getProjectIdAsync().then(t=>e(null,t),e);else return this.getProjectIdAsync()}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===$t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId(),e)return this._cachedProjectId=e,e;throw new Error($t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await Bo.universe("universe-domain"),e||=nl.DEFAULT_UNIVERSE}catch(t){if(t&&t?.response?.status===404)e=nl.DEFAULT_UNIVERSE;else throw t}return e}async getUniverseDomain(){let e=(0,Jm.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=nl.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let n;if(typeof e=="function"?t=e:n=e,t)this.getApplicationDefaultAsync(n).then(s=>t(null,s.credential,s.projectId),t);else return this.getApplicationDefaultAsync(n)}async getApplicationDefaultAsync(e={}){if(this.cachedCredential)return await this.#t(this.cachedCredential,null);let t;if(t=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e),t)return t instanceof zn.JWT?t.scopes=this.scopes:t instanceof No.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await this.#t(t);if(t=await this._tryGetApplicationCredentialsFromWellKnownFile(e),t)return t instanceof zn.JWT?t.scopes=this.scopes:t instanceof No.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await this.#t(t);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#t(new SA.Compute(e));throw new Error($t.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async#t(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let n=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:n}}async _checkIsGCE(){return this.checkIsGCE===void 0&&(this.checkIsGCE=Bo.getGCPResidency()||await Bo.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||t.length===0)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(n){throw n instanceof Error&&(n.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${n.message}`),n}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let s=process.env.HOME;s&&(t=rl.join(s,".config"))}return t&&(t=rl.join(t,"gcloud","application_default_credentials.json"),xo.existsSync(t)||(t=null)),t?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||e.length===0)throw new Error("The file path is invalid.");try{if(e=xo.realpathSync(e),!xo.lstatSync(e).isFile())throw new Error}catch(s){throw s instanceof Error&&(s.message=`The file at ${e} does not exist, or it is not a file. ${s.message}`),s}let n=xo.createReadStream(e);return this.fromStream(n,t)}fromImpersonatedJSON(e){if(!e)throw new Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==Vn.IMPERSONATED_ACCOUNT_TYPE)throw new Error(`The incoming JSON object does not have the "${Vn.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw new Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw new Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw new RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let n=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!n)throw new RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let s=this.getAnyScopes()??[];return new Vn.Impersonated({...e,sourceClient:t,targetPrincipal:n,targetScopes:Array.isArray(s)?s:[s]})}fromJSON(e,t={}){let n,s=(0,Jm.originalOrCamelOptions)(t).get("universe_domain");return e.type===Gm.USER_REFRESH_ACCOUNT_TYPE?(n=new Gm.UserRefreshClient(t),n.fromJSON(e)):e.type===Vn.IMPERSONATED_ACCOUNT_TYPE?n=this.fromImpersonatedJSON(e):e.type===No.EXTERNAL_ACCOUNT_TYPE?(n=RA.ExternalAccountClient.fromJSON({...e,...t}),n.scopes=this.getAnyScopes()):e.type===Wm.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?n=new Wm.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,n=new zn.JWT(t),this.setGapicJWTValues(n),n.fromJSON(e)),s&&(n.universeDomain=s),n}_cacheClientFromJSON(e,t){let n=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=n,n}fromStream(e,t={},n){let s={};if(typeof t=="function"?n=t:s=t,n)this.fromStreamAsync(e,s).then(a=>n(null,a),n);else return this.fromStreamAsync(e,s)}fromStreamAsync(e,t){return new Promise((n,s)=>{if(!e)throw new Error("Must pass in a stream containing the Google auth settings.");let a=[];e.setEncoding("utf8").on("error",s).on("data",u=>a.push(u)).on("end",()=>{try{try{let u=JSON.parse(a.join("")),l=this._cacheClientFromJSON(u,t);return n(l)}catch(u){if(!this.keyFilename)throw u;let l=new zn.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=l,this.setGapicJWTValues(l),n(l)}}catch(u){return s(u)}})})}fromAPIKey(e,t={}){return new zn.JWT({...t,apiKey:e})}_isWindows(){let e=wA.platform();return!!(e&&e.length>=3&&e.substring(0,3).toLowerCase()==="win")}async getDefaultServiceProjectId(){return new Promise(e=>{(0,EA.exec)("gcloud config config-helper --format json",(t,n)=>{if(!t&&n)try{let s=JSON.parse(n).configuration.properties.core.project;e(s);return}catch{}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let t=await this.getClient();if(t&&t.projectId)return t.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){return!this.jsonContent||this.jsonContent.type!==No.EXTERNAL_ACCOUNT_TYPE?null:await(await this.getClient()).getProjectId()}async getGCEProjectId(){try{return await Bo.project("project-id")}catch{return null}}getCredentials(e){if(e)this.getCredentialsAsync().then(t=>e(null,t),e);else return this.getCredentialsAsync()}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof Vn.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof No.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[t,n]=await Promise.all([Bo.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:t,universe_domain:n}}throw new Error($t.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#e=this.#e||this.#r();try{return await this.#e}finally{this.#e=null}}async#r(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=rl.resolve(this.keyFilename),t=xo.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}else if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await this.#t(e);return t}else{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw new Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new vA.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){return(await(await this.getClient()).getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,s=await(await this.getClient()).getRequestHeaders(t);return e.headers=AA.Gaxios.mergeHeaders(e.headers,s),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,TA.getEnv)()}async sign(e,t){let n=await this.getClient(),s=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${s}/v1/projects/-/serviceAccounts/`,n instanceof Vn.Impersonated)return(await n.sign(e)).signedBlob;let a=(0,DA.createCrypto)();if(n instanceof zn.JWT&&n.key)return await a.sign(n.key,e);let u=await this.getCredentials();if(!u.client_email)throw new Error("Cannot sign data without `client_email`.");return this.signBlob(a,u.client_email,e,t)}async signBlob(e,t,n,s){let a=new URL(s+`${t}:signBlob`);return(await this.request({method:"POST",url:a.href,data:{payload:e.encodeBase64StringUtf8(n)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}};$t.GoogleAuth=ol});var Vm=J($i=>{"use strict";Object.defineProperty($i,"__esModule",{value:!0});$i.IAMAuth=void 0;var sl=class{selector;token;constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}};$i.IAMAuth=sl});var Km=J(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.DownscopedClient=Zt.EXPIRATION_TIME_OFFSET=Zt.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;var kA=Ve(),FA=X("stream"),il=pt(),OA=Ai(),PA="urn:ietf:params:oauth:grant-type:token-exchange",xA="urn:ietf:params:oauth:token-type:access_token",BA="urn:ietf:params:oauth:token-type:access_token";Zt.MAX_ACCESS_BOUNDARY_RULES_COUNT=10;Zt.EXPIRATION_TIME_OFFSET=300*1e3;var al=class extends il.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,t={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof il.AuthClient?{}:e),e instanceof il.AuthClient?(this.authClient=e,this.credentialAccessBoundary=t):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length===0)throw new Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>Zt.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw new Error(`The provided access boundary has more than ${Zt.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let n of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(n.availablePermissions.length===0)throw new Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new OA.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw new Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(t)this.requestAsync(e).then(n=>t(null,n),n=>t(n,n.response));else return this.requestAsync(e)}async requestAsync(e,t=!1){let n;try{let s=await this.getRequestHeaders();e.headers=kA.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,s),n=await this.transporter.request(e)}catch(s){let a=s.response;if(a){let u=a.status,l=a.config.data instanceof FA.Readable;if(!t&&(u===401||u===403)&&!l&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw s}return n}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,t={grantType:PA,requestedTokenType:xA,subjectToken:e,subjectTokenType:BA},n=await this.stsCredential.exchangeToken(t,void 0,this.credentialAccessBoundary),s=this.authClient.credentials?.expiry_date||null,a=n.expires_in?new Date().getTime()+n.expires_in*1e3:s;return this.cachedDownscopedAccessToken={access_token:n.access_token,expiry_date:a,res:n.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return e.expiry_date?t>=e.expiry_date-this.eagerRefreshThresholdMillis:!1}};Zt.DownscopedClient=al});var Ym=J(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0});Hi.PassThroughClient=void 0;var NA=pt(),ul=class extends NA.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}};Hi.PassThroughClient=ul});var ll=J(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.GoogleAuth=ee.auth=ee.PassThroughClient=ee.ExecutableError=ee.PluggableAuthClient=ee.DownscopedClient=ee.BaseExternalAccountClient=ee.ExternalAccountClient=ee.IdentityPoolClient=ee.AwsRequestSigner=ee.AwsClient=ee.UserRefreshClient=ee.LoginTicket=ee.ClientAuthentication=ee.OAuth2Client=ee.CodeChallengeMethod=ee.Impersonated=ee.JWT=ee.JWTAccess=ee.IdTokenClient=ee.IAMAuth=ee.GCPEnv=ee.Compute=ee.DEFAULT_UNIVERSE=ee.AuthClient=ee.gaxios=ee.gcpMetadata=void 0;var Xm=zm();Object.defineProperty(ee,"GoogleAuth",{enumerable:!0,get:function(){return Xm.GoogleAuth}});ee.gcpMetadata=bo();ee.gaxios=Ve();var Qm=pt();Object.defineProperty(ee,"AuthClient",{enumerable:!0,get:function(){return Qm.AuthClient}});Object.defineProperty(ee,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return Qm.DEFAULT_UNIVERSE}});var IA=Yu();Object.defineProperty(ee,"Compute",{enumerable:!0,get:function(){return IA.Compute}});var jA=Zu();Object.defineProperty(ee,"GCPEnv",{enumerable:!0,get:function(){return jA.GCPEnv}});var LA=Vm();Object.defineProperty(ee,"IAMAuth",{enumerable:!0,get:function(){return LA.IAMAuth}});var UA=Qu();Object.defineProperty(ee,"IdTokenClient",{enumerable:!0,get:function(){return UA.IdTokenClient}});var qA=gc();Object.defineProperty(ee,"JWTAccess",{enumerable:!0,get:function(){return qA.JWTAccess}});var MA=_c();Object.defineProperty(ee,"JWT",{enumerable:!0,get:function(){return MA.JWT}});var $A=Ac();Object.defineProperty(ee,"Impersonated",{enumerable:!0,get:function(){return $A.Impersonated}});var cl=nn();Object.defineProperty(ee,"CodeChallengeMethod",{enumerable:!0,get:function(){return cl.CodeChallengeMethod}});Object.defineProperty(ee,"OAuth2Client",{enumerable:!0,get:function(){return cl.OAuth2Client}});Object.defineProperty(ee,"ClientAuthentication",{enumerable:!0,get:function(){return cl.ClientAuthentication}});var HA=Ju();Object.defineProperty(ee,"LoginTicket",{enumerable:!0,get:function(){return HA.LoginTicket}});var GA=Cc();Object.defineProperty(ee,"UserRefreshClient",{enumerable:!0,get:function(){return GA.UserRefreshClient}});var WA=Mc();Object.defineProperty(ee,"AwsClient",{enumerable:!0,get:function(){return WA.AwsClient}});var JA=Lc();Object.defineProperty(ee,"AwsRequestSigner",{enumerable:!0,get:function(){return JA.AwsRequestSigner}});var zA=Ic();Object.defineProperty(ee,"IdentityPoolClient",{enumerable:!0,get:function(){return zA.IdentityPoolClient}});var VA=Zc();Object.defineProperty(ee,"ExternalAccountClient",{enumerable:!0,get:function(){return VA.ExternalAccountClient}});var KA=Ir();Object.defineProperty(ee,"BaseExternalAccountClient",{enumerable:!0,get:function(){return KA.BaseExternalAccountClient}});var YA=Km();Object.defineProperty(ee,"DownscopedClient",{enumerable:!0,get:function(){return YA.DownscopedClient}});var Zm=Xc();Object.defineProperty(ee,"PluggableAuthClient",{enumerable:!0,get:function(){return Zm.PluggableAuthClient}});Object.defineProperty(ee,"ExecutableError",{enumerable:!0,get:function(){return Zm.ExecutableError}});var XA=Ym();Object.defineProperty(ee,"PassThroughClient",{enumerable:!0,get:function(){return XA.PassThroughClient}});var QA=new Xm.GoogleAuth;ee.auth=QA});import sw from"fastify";import iw from"@fastify/cors";var qf=zr(Ha(),1);import{readFileSync as a0,existsSync as Lf}from"fs";import{join as Uf}from"path";import{config as u0}from"dotenv";var gs=class{config={};options;constructor(e={jsonPath:"./config.json"}){this.options={envPath:e.envPath||".env",jsonPath:e.jsonPath,useEnvFile:!1,useJsonFile:e.useJsonFile!==!1,useEnvironmentVariables:e.useEnvironmentVariables!==!1,...e},this.loadConfig()}loadConfig(){this.options.useJsonFile&&this.options.jsonPath&&this.loadJsonConfig(),this.options.initialConfig&&(this.config={...this.config,...this.options.initialConfig}),this.options.useEnvFile&&this.loadEnvConfig(),this.config.LOG_FILE&&(process.env.LOG_FILE=this.config.LOG_FILE),this.config.LOG&&(process.env.LOG=this.config.LOG)}loadJsonConfig(){if(!this.options.jsonPath)return;let e=this.isAbsolutePath(this.options.jsonPath)?this.options.jsonPath:Uf(process.cwd(),this.options.jsonPath);if(Lf(e))try{let t=a0(e,"utf-8"),n=qf.default.parse(t);this.config={...this.config,...n},console.log(`Loaded JSON config from: ${e}`)}catch(t){console.warn(`Failed to load JSON config from ${e}:`,t)}else console.warn(`JSON config file not found: ${e}`)}loadEnvConfig(){let e=this.isAbsolutePath(this.options.envPath)?this.options.envPath:Uf(process.cwd(),this.options.envPath);if(Lf(e))try{let t=u0({path:e});t.parsed&&(this.config={...this.config,...this.parseEnvConfig(t.parsed)})}catch(t){console.warn(`Failed to load .env config from ${e}:`,t)}}loadEnvironmentVariables(){let e=this.parseEnvConfig(process.env);this.config={...this.config,...e}}parseEnvConfig(e){let t={};return Object.assign(t,e),t}isAbsolutePath(e){return e.startsWith("/")||e.includes(":")}get(e,t){let n=this.config[e];return n!==void 0?n:t}getAll(){return{...this.config}}getHttpsProxy(){return this.get("HTTPS_PROXY")||this.get("https_proxy")||this.get("httpsProxy")||this.get("PROXY_URL")}has(e){return this.config[e]!==void 0}set(e,t){this.config[e]=t}reload(){this.config={},this.loadConfig()}getConfigSummary(){let e=[];return this.options.initialConfig&&e.push("Initial Config"),this.options.useJsonFile&&this.options.jsonPath&&e.push(`JSON: ${this.options.jsonPath}`),this.options.useEnvFile&&e.push(`ENV: ${this.options.envPath}`),this.options.useEnvironmentVariables&&e.push("Environment Variables"),`Config sources: ${e.join(", ")}`}};function nt(r,e=500,t="internal_error",n="api_error"){let s=new Error(r);return s.statusCode=e,s.code=t,s.type=n,s}async function Mf(r,e,t){e.log.error(r);let n=r.statusCode||500,s={error:{message:r.message+r.stack||"Internal Server Error",type:r.type||"api_error",code:r.code||"internal_error"}};return t.code(n).send(s)}import{ProxyAgent as c0}from"undici";function $f(r,e,t,n){let s=new Headers({"Content-Type":"application/json"});t.headers&&Object.entries(t.headers).forEach(([h,d])=>{d&&s.set(h,d)});let a,u=AbortSignal.timeout(t.TIMEOUT??60*1e3*60);if(t.signal){let h=new AbortController,d=()=>h.abort();t.signal.addEventListener("abort",d),u.addEventListener("abort",d),a=h.signal}else a=u;let l={method:"POST",headers:s,body:JSON.stringify(e),signal:a};t.httpsProxy&&(l.dispatcher=new c0(new URL(t.httpsProxy).toString())),n?.debug({request:l,headers:Object.fromEntries(s.entries()),requestUrl:typeof r=="string"?r:r.toString(),useProxy:t.httpsProxy},"final request");let f=JSON.stringify(e);return console.log("[HTTP EGRESS DEBUG] ACTUAL REQUEST BODY BEING SENT:",f),console.log("[HTTP EGRESS DEBUG] REQUEST OBJECT KEYS:",Object.keys(e)),console.log("[HTTP EGRESS DEBUG] HAS REASONING PARAM:","reasoning"in e),console.log("[HTTP EGRESS DEBUG] HAS REASONING_EFFORT PARAM:","reasoning_effort"in e),"reasoning"in e&&e.model&&!/^(o3|o4|gpt-5)/.test(e.model)&&(console.error("[REASONING ASSERTION FAILED] Reasoning parameter found on non-reasoning model!"),console.error("[REASONING ASSERTION] Model:",e.model),console.error("[REASONING ASSERTION] Reasoning param:",e.reasoning),console.trace("[REASONING ASSERTION] Stack trace:")),fetch(typeof r=="string"?r:r.toString(),l)}var Hf="1.0.26";async function f0(r,e,t,n){let s=r.body,a=r.provider,u=t._server.providerService.getProvider(a);if(!u)throw nt(`Provider '${a}' not found`,404,"provider_not_found");let{requestBody:l,config:f,bypass:h}=await d0(s,u,n,r.headers),d=await p0(l,f,u,t,h,n),_=await m0(l,d,u,n,h);return g0(_,e,s)}async function d0(r,e,t,n){let s=r,a={},u=!1;if(u=h0(e,t,r),u&&(n instanceof Headers?n.delete("content-length"):delete n["content-length"],a.headers=n),!u&&typeof t.transformRequestOut=="function"){let l=await t.transformRequestOut(s);l.body?(s=l.body,a=l.config||{}):s=l}if(!u&&e.transformer?.use?.length)for(let l of e.transformer.use){if(!l||typeof l.transformRequestOut!="function")continue;let f=await l.transformRequestOut(s,e);f.body?(s=f.body,a={...a,...f.config}):s=f}if(!u&&e.transformer?.[r.model]?.use?.length)for(let l of e.transformer[r.model].use)!l||typeof l.transformRequestIn!="function"||(s=await l.transformRequestIn(s,e));return{requestBody:s,config:a,bypass:u}}function h0(r,e,t){return r.transformer?.use?.length===1&&r.transformer.use[0].name===e.name&&(!r.transformer?.[t.model]?.use.length||r.transformer?.[t.model]?.use.length===1&&r.transformer?.[t.model]?.use[0].name===e.name)}async function p0(r,e,t,n,s,a){let u=e.url||new URL(t.baseUrl);if(s&&typeof a.auth=="function"){let f=await a.auth(r,t);if(f.body){r=f.body;let h=e.headers||{};f.config?.headers&&(h={...h,...f.config.headers},delete h.host,delete f.config.headers),e={...e,...f.config,headers:h}}else r=f}let l=await $f(u,r,{httpsProxy:n._server.configService.getHttpsProxy(),...e,headers:{Authorization:`Bearer ${t.apiKey}`,...e?.headers||{}}},n.log);if(!l.ok){let f=await l.text();throw nt(`Error from provider(${t.name},${r.model}: ${l.status}): ${f}`,l.status,"provider_response_error")}return l}async function m0(r,e,t,n,s){let a=e;if(!s&&t.transformer?.use?.length)for(let u of Array.from(t.transformer.use).reverse())!u||typeof u.transformResponseOut!="function"||(a=await u.transformResponseOut(a));if(!s&&t.transformer?.[r.model]?.use?.length)for(let u of Array.from(t.transformer[r.model].use).reverse())!u||typeof u.transformResponseOut!="function"||(a=await u.transformResponseOut(a));return!s&&n.transformResponseIn&&(a=await n.transformResponseIn(a)),a}function g0(r,e,t){return r.ok||e.code(r.status),t.stream===!0?(e.header("Content-Type","text/event-stream"),e.header("Cache-Control","no-cache"),e.header("Connection","keep-alive"),e.send(r.body)):r.json()}var Gf=async r=>{r.get("/",async()=>({message:"LLMs API",version:Hf})),r.get("/health",async()=>({status:"ok",timestamp:new Date().toISOString()}));let e=r._server.transformerService.getTransformersWithEndpoint();for(let{transformer:t}of e)t.endPoint&&r.post(t.endPoint,async(n,s)=>f0(n,s,r,t));r.post("/providers",{schema:{body:{type:"object",properties:{id:{type:"string"},name:{type:"string"},type:{type:"string",enum:["openai","anthropic"]},baseUrl:{type:"string"},apiKey:{type:"string"},models:{type:"array",items:{type:"string"}}},required:["id","name","type","baseUrl","apiKey","models"]}}},async(t,n)=>{let{name:s,baseUrl:a,apiKey:u,models:l}=t.body;if(!s?.trim())throw nt("Provider name is required",400,"invalid_request");if(!a||!y0(a))throw nt("Valid base URL is required",400,"invalid_request");if(!u?.trim())throw nt("API key is required",400,"invalid_request");if(!l||!Array.isArray(l)||l.length===0)throw nt("At least one model is required",400,"invalid_request");if(r._server.providerService.getProvider(t.body.name))throw nt(`Provider with name '${t.body.name}' already exists`,400,"provider_exists");return r._server.providerService.registerProvider(t.body)}),r.get("/providers",async()=>r._server.providerService.getProviders()),r.get("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]}}},async t=>{let n=r._server.providerService.getProvider(t.params.id);if(!n)throw nt("Provider not found",404,"provider_not_found");return n}),r.put("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]},body:{type:"object",properties:{name:{type:"string"},type:{type:"string",enum:["openai","anthropic"]},baseUrl:{type:"string"},apiKey:{type:"string"},models:{type:"array",items:{type:"string"}},enabled:{type:"boolean"}}}}},async(t,n)=>{let s=r._server.providerService.updateProvider(t.params.id,t.body);if(!s)throw nt("Provider not found",404,"provider_not_found");return s}),r.delete("/providers/:id",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]}}},async t=>{if(!r._server.providerService.deleteProvider(t.params.id))throw nt("Provider not found",404,"provider_not_found");return{message:"Provider deleted successfully"}}),r.patch("/providers/:id/toggle",{schema:{params:{type:"object",properties:{id:{type:"string"}},required:["id"]},body:{type:"object",properties:{enabled:{type:"boolean"}},required:["enabled"]}}},async(t,n)=>{if(!r._server.providerService.toggleProvider(t.params.id,t.body.enabled))throw nt("Provider not found",404,"provider_not_found");return{message:`Provider ${t.body.enabled?"enabled":"disabled"} successfully`}})};function y0(r){try{return new URL(r),!0}catch{return!1}}var ys=class{constructor(e){this.providerService=e}registerProvider(e){return this.providerService.registerProvider(e)}getProviders(){return this.providerService.getProviders()}getProvider(e){return this.providerService.getProvider(e)}updateProvider(e,t){return this.providerService.updateProvider(e,t)}deleteProvider(e){return this.providerService.deleteProvider(e)}toggleProvider(e,t){return this.providerService.toggleProvider(e,t)}resolveRoute(e){let t=this.providerService.resolveModelRoute(e);if(!t)throw new Error(`Model ${e} not found. Available models: ${this.getAvailableModelNames().join(", ")}`);return t}async getAvailableModels(){return{object:"list",data:this.providerService.getAvailableModels().flatMap(t=>t.models.map(n=>({id:n,object:"model",provider:t.provider,created:Math.floor(Date.now()/1e3),owned_by:t.provider})))}}getAvailableModelNames(){return this.providerService.getModelRoutes().map(e=>e.fullModel)}getModelRoutes(){return this.providerService.getModelRoutes()}};function Wf(r,e={}){let{resolveEnvVariables:t=!0,throwOnMissing:n=!0}=e;if(!t)return r;let s=/^\$\{?([A-Z0-9_]+)\}?$/,a=r.match(s);if(!a)return r;let u=a[1],l=process.env[u];if(!l){if(n)throw new Error(`Environment variable '${u}' is not set. Please set ${u} in your environment or .env file.`);return r}return l}function Jf(r){if(!r||r.length<=8)return"***";let e=r.slice(0,4),t=r.slice(-4),n="*".repeat(Math.max(0,r.length-8));return`${e}${n}${t}`}var _s=class{constructor(e,t,n){this.configService=e;this.transformerService=t;this.logger=n;this.initializeCustomProviders()}providers=new Map;modelRoutes=new Map;initializeCustomProviders(){let e=this.configService.get("providers");if(e&&Array.isArray(e)){this.initializeFromProvidersArray(e);return}}initializeFromProvidersArray(e){e.forEach(t=>{try{if(!t.name||!t.api_base_url||!t.api_key)return;let n={};t.transformer&&Object.keys(t.transformer).forEach(a=>{a==="use"?Array.isArray(t.transformer.use)&&(n.use=t.transformer.use.map(u=>{if(Array.isArray(u)&&typeof u[0]=="string"){let l=this.transformerService.getTransformer(u[0]);if(l)return new l(u[1])}if(typeof u=="string"){let l=this.transformerService.getTransformer(u);return typeof l=="function"?new l:l}}).filter(u=>typeof u<"u")):Array.isArray(t.transformer[a]?.use)&&(n[a]={use:t.transformer[a].use.map(u=>{if(Array.isArray(u)&&typeof u[0]=="string"){let l=this.transformerService.getTransformer(u[0]);if(l)return new l(u[1])}if(typeof u=="string"){let l=this.transformerService.getTransformer(u);return typeof l=="function"?new l:l}}).filter(u=>typeof u<"u")})});let s=Wf(t.api_key,{resolveEnvVariables:!0,throwOnMissing:!0});this.registerProvider({name:t.name,baseUrl:t.api_base_url,apiKey:s,models:t.models||[],transformer:t.transformer?n:void 0}),this.logger.info(`${t.name} provider registered with API key: ${Jf(s)}`)}catch(n){this.logger.error(`${t.name} provider registered error: ${n}`)}})}registerProvider(e){let t={...e};return this.providers.set(t.name,t),e.models.forEach(n=>{let s=`${t.name},${n}`,a={provider:t.name,model:n,fullModel:s};this.modelRoutes.set(s,a),this.modelRoutes.has(n)||this.modelRoutes.set(n,a)}),t}getProviders(){return Array.from(this.providers.values())}getProvider(e){return this.providers.get(e)}updateProvider(e,t){let n=this.providers.get(e);if(!n)return null;let s={...n,...t,updatedAt:new Date};return this.providers.set(e,s),t.models&&(n.models.forEach(a=>{let u=`${n.id},${a}`;this.modelRoutes.delete(u),this.modelRoutes.delete(a)}),t.models.forEach(a=>{let u=`${n.name},${a}`,l={provider:n.name,model:a,fullModel:u};this.modelRoutes.set(u,l),this.modelRoutes.has(a)||this.modelRoutes.set(a,l)})),s}deleteProvider(e){let t=this.providers.get(e);return t?(t.models.forEach(n=>{let s=`${t.name},${n}`;this.modelRoutes.delete(s),this.modelRoutes.delete(n)}),this.providers.delete(e),!0):!1}toggleProvider(e,t){return!!this.providers.get(e)}resolveModelRoute(e){let t=this.modelRoutes.get(e);if(!t)return null;let n=this.providers.get(t.provider);return n?{provider:n,originalModel:e,targetModel:t.model}:null}getAvailableModelNames(){let e=[];return this.providers.forEach(t=>{t.models.forEach(n=>{e.push(n),e.push(`${t.name},${n}`)})}),e}getModelRoutes(){return Array.from(this.modelRoutes.values())}parseTransformerConfig(e){return e?Array.isArray(e)?e.reduce((t,n)=>{if(Array.isArray(n)){let[s,a={}]=n;t[s]=a}else t[n]={};return t},{}):e:{}}async getAvailableModels(){let e=[];return this.providers.forEach(t=>{t.models.forEach(n=>{e.push({id:n,object:"model",owned_by:t.name,provider:t.name}),e.push({id:`${t.name},${n}`,object:"model",owned_by:t.name,provider:t.name})})}),{object:"list",data:e}}};var ze=[];for(let r=0;r<256;++r)ze.push((r+256).toString(16).slice(1));function zf(r,e=0){return(ze[r[e+0]]+ze[r[e+1]]+ze[r[e+2]]+ze[r[e+3]]+"-"+ze[r[e+4]]+ze[r[e+5]]+"-"+ze[r[e+6]]+ze[r[e+7]]+"-"+ze[r[e+8]]+ze[r[e+9]]+"-"+ze[r[e+10]]+ze[r[e+11]]+ze[r[e+12]]+ze[r[e+13]]+ze[r[e+14]]+ze[r[e+15]]).toLowerCase()}import{randomFillSync as _0}from"crypto";var Cs=new Uint8Array(256),bs=Cs.length;function Ga(){return bs>Cs.length-16&&(_0(Cs),bs=0),Cs.slice(bs,bs+=16)}import{randomUUID as b0}from"crypto";var Wa={randomUUID:b0};function C0(r,e,t){if(Wa.randomUUID&&!e&&!r)return Wa.randomUUID();r=r||{};let n=r.random??r.rng?.()??Ga();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let s=0;s<16;++s)e[t+s]=n[s];return e}return zf(n)}var Tr=C0;var Vf=r=>r<=0?"none":r<=1024?"low":r<=8192?"medium":"high";var Es=class{name="Anthropic";endPoint="/v1/messages";async auth(e,t){return{body:e,config:{headers:{"x-api-key":t.apiKey,authorization:void 0}}}}async transformRequestOut(e){let t=[];if(e.system){if(typeof e.system=="string")t.push({role:"system",content:e.system});else if(Array.isArray(e.system)&&e.system.length){let a=e.system.filter(u=>u.type==="text"&&u.text).map(u=>({type:"text",text:u.text,cache_control:u.cache_control}));t.push({role:"system",content:a})}}JSON.parse(JSON.stringify(e.messages||[]))?.forEach((a,u)=>{if(a.role==="user"||a.role==="assistant"){if(typeof a.content=="string"){t.push({role:a.role,content:a.content});return}if(Array.isArray(a.content)){if(a.role==="user"){let l=a.content.filter(h=>h.type==="tool_result"&&h.tool_use_id);l.length&&l.forEach((h,d)=>{let _={role:"tool",content:typeof h.content=="string"?h.content:JSON.stringify(h.content),tool_call_id:h.tool_use_id,cache_control:h.cache_control};t.push(_)});let f=a.content.filter(h=>h.type==="text"&&h.text||h.type==="image"&&h.source);f.length&&t.push({role:"user",content:f.map(h=>h?.type==="image"?{type:"image_url",image_url:{url:h.source?.type==="base64"?h.source.data:h.source.url},media_type:h.source.media_type}:h)})}else if(a.role==="assistant"){let l={role:"assistant",content:null},f=a.content.filter(d=>d.type==="text"&&d.text);f.length&&(l.content=f.map(d=>d.text).join(`
`));let h=a.content.filter(d=>d.type==="tool_use"&&d.id);h.length&&(l.tool_calls=h.map(d=>({id:d.id,type:"function",function:{name:d.name,arguments:JSON.stringify(d.input||{})}}))),t.push(l)}return}}});let s={messages:t,model:e.model,max_tokens:e.max_tokens,temperature:e.temperature,stream:e.stream,tools:e.tools?.length?this.convertAnthropicToolsToUnified(e.tools):void 0,tool_choice:e.tool_choice};return e.thinking&&(s.reasoning={effort:Vf(e.thinking.budget_tokens),enabled:e.thinking.type==="enabled"}),e.tool_choice&&(e.tool_choice.type==="tool"?s.tool_choice={type:"function",function:{name:e.tool_choice.name}}:s.tool_choice=e.tool_choice.type),s}async transformResponseIn(e,t){if(e.headers.get("Content-Type")?.includes("text/event-stream")){if(!e.body)throw new Error("Stream response body is null");let s=await this.convertOpenAIStreamToAnthropic(e.body);return new Response(s,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}else{let s=await e.json(),a=this.convertOpenAIResponseToAnthropic(s);return new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}})}}convertAnthropicToolsToUnified(e){return e.map(t=>({type:"function",function:{name:t.name,description:t.description||"",parameters:t.input_schema}}))}async convertOpenAIStreamToAnthropic(e){return new ReadableStream({start:async n=>{let s=new TextEncoder,a=`msg_${Date.now()}`,u=null,l="unknown",f=!1,h=!1,d=!1,_=new Map,E=new Map,P=0,v=0,A=0,g=!1,b=!1,R=0,S=-1,I=H=>{if(!g)try{n.enqueue(H);let K=new TextDecoder().decode(H);this.logger.debug({dataStr:K},"send data")}catch(K){if(K instanceof TypeError&&K.message.includes("Controller is already closed"))g=!0;else throw this.logger.debug(`send data error: ${K.message}`),K}},L=()=>{if(!g)try{if(S>=0){let K={type:"content_block_stop",index:S};I(s.encode(`event: content_block_stop
data: ${JSON.stringify(K)}

`)),S=-1}u?(I(s.encode(`event: message_delta
data: ${JSON.stringify(u)}

`)),u=null):I(s.encode(`event: message_delta
data: ${JSON.stringify({type:"message_delta",delta:{stop_reason:"end_turn",stop_sequence:null},usage:{input_tokens:0,output_tokens:0,cache_read_input_tokens:0}})}

`));let H={type:"message_stop"};I(s.encode(`event: message_stop
data: ${JSON.stringify(H)}

`)),n.close(),g=!0}catch(H){if(H instanceof TypeError&&H.message.includes("Controller is already closed"))g=!0;else throw H}},U=null;try{U=e.getReader();let H=new TextDecoder,K="";for(;!g;){let{done:W,value:we}=await U.read();if(W)break;K+=H.decode(we,{stream:!0});let he=K.split(`
`);K=he.pop()||"";for(let fe of he){if(g||d)break;if(!fe.startsWith("data: "))continue;let ye=fe.slice(6);if(this.logger.debug(`recieved data: ${ye}`),ye!=="[DONE]")try{let re=JSON.parse(ye);if(P++,this.logger.debug({response:re},"Original Response"),re.error){let Z={type:"error",message:{type:"api_error",message:JSON.stringify(re.error)}};I(s.encode(`event: error
data: ${JSON.stringify(Z)}

`));continue}if(l=re.model||l,!f&&!g&&!d){f=!0;let Z={type:"message_start",message:{id:a,type:"message",role:"assistant",content:[],model:l,stop_reason:null,stop_sequence:null,usage:{input_tokens:0,output_tokens:0}}};I(s.encode(`event: message_start
data: ${JSON.stringify(Z)}

`))}let de=re.choices?.[0];if(re.usage&&(u?u.usage={input_tokens:re.usage?.prompt_tokens||0,output_tokens:re.usage?.completion_tokens||0,cache_read_input_tokens:re.usage?.cache_read_input_tokens||0}:u={type:"message_delta",delta:{stop_reason:"end_turn",stop_sequence:null},usage:{input_tokens:re.usage?.prompt_tokens||0,output_tokens:re.usage?.completion_tokens||0,cache_read_input_tokens:re.usage?.cache_read_input_tokens||0}}),!de)continue;if(de?.delta?.thinking&&!g&&!d){if(S>=0){let Z={type:"content_block_stop",index:S};I(s.encode(`event: content_block_stop
data: ${JSON.stringify(Z)}

`)),S=-1}if(!b){let Z={type:"content_block_start",index:R,content_block:{type:"thinking",thinking:""}};I(s.encode(`event: content_block_start
data: ${JSON.stringify(Z)}

`)),S=R,b=!0}if(de.delta.thinking.signature){let Z={type:"content_block_delta",index:R,delta:{type:"signature_delta",signature:de.delta.thinking.signature}};I(s.encode(`event: content_block_delta
data: ${JSON.stringify(Z)}

`));let ue={type:"content_block_stop",index:R};I(s.encode(`event: content_block_stop
data: ${JSON.stringify(ue)}

`)),S=-1,R++}else if(de.delta.thinking.content){let Z={type:"content_block_delta",index:R,delta:{type:"thinking_delta",thinking:de.delta.thinking.content||""}};I(s.encode(`event: content_block_delta
data: ${JSON.stringify(Z)}

`))}}if(de?.delta?.content&&!g&&!d){if(v++,S>=0&&!h){let ue={type:"content_block_stop",index:S};I(s.encode(`event: content_block_stop
data: ${JSON.stringify(ue)}

`)),S=-1}if(!h&&!d){h=!0;let Z={type:"content_block_start",index:R,content_block:{type:"text",text:""}};I(s.encode(`event: content_block_start
data: ${JSON.stringify(Z)}

`)),S=R}if(!g&&!d){let Z={type:"content_block_delta",index:S,delta:{type:"text_delta",text:de.delta.content}};I(s.encode(`event: content_block_delta
data: ${JSON.stringify(Z)}

`))}}if(de?.delta?.annotations?.length&&!g&&!d){if(S>=0&&h){let Z={type:"content_block_stop",index:S};I(s.encode(`event: content_block_stop
data: ${JSON.stringify(Z)}

`)),S=-1,h=!1}de?.delta?.annotations.forEach(Z=>{R++;let ue={type:"content_block_start",index:R,content_block:{type:"web_search_tool_result",tool_use_id:`srvtoolu_${Tr()}`,content:[{type:"web_search_result",title:Z.url_citation.title,url:Z.url_citation.url}]}};I(s.encode(`event: content_block_start
data: ${JSON.stringify(ue)}

`));let z={type:"content_block_stop",index:R};I(s.encode(`event: content_block_stop
data: ${JSON.stringify(z)}

`)),S=-1})}if(de?.delta?.tool_calls&&!g&&!d){A++;let Z=new Set;for(let ue of de.delta.tool_calls){if(g)break;let z=ue.index??0;if(Z.has(z))continue;if(Z.add(z),!E.has(z)){if(S>=0){let Ee={type:"content_block_stop",index:S};I(s.encode(`event: content_block_stop
data: ${JSON.stringify(Ee)}

`)),S=-1}let se=R;E.set(z,se),R++;let Ne=ue.id||`call_${Date.now()}_${z}`,Le=ue.function?.name||`tool_${z}`,G={type:"content_block_start",index:se,content_block:{type:"tool_use",id:Ne,name:Le,input:{}}};I(s.encode(`event: content_block_start
data: ${JSON.stringify(G)}

`)),S=se;let pe={id:Ne,name:Le,arguments:"",contentBlockIndex:se};_.set(z,pe)}else if(ue.id&&ue.function?.name){let se=_.get(z);se.id.startsWith("call_")&&se.name.startsWith("tool_")&&(se.id=ue.id,se.name=ue.function.name)}if(ue.function?.arguments&&!g&&!d){let se=E.get(z);if(se===void 0)continue;let Ne=_.get(z);Ne&&(Ne.arguments+=ue.function.arguments);try{let Le={type:"content_block_delta",index:se,delta:{type:"input_json_delta",partial_json:ue.function.arguments}};I(s.encode(`event: content_block_delta
data: ${JSON.stringify(Le)}

`))}catch{try{let G=ue.function.arguments.replace(/[\x00-\x1F\x7F-\x9F]/g,"").replace(/\\/g,"\\\\").replace(/"/g,'\\"'),pe={type:"content_block_delta",index:se,delta:{type:"input_json_delta",partial_json:G}};I(s.encode(`event: content_block_delta
data: ${JSON.stringify(pe)}

`))}catch(G){console.error(G)}}}}}if(de?.finish_reason&&!g&&!d){if(v===0&&A===0&&console.error("Warning: No content in the stream response!"),S>=0){let Z={type:"content_block_stop",index:S};I(s.encode(`event: content_block_stop
data: ${JSON.stringify(Z)}

`)),S=-1}g||(u={type:"message_delta",delta:{stop_reason:{stop:"end_turn",length:"max_tokens",tool_calls:"tool_use",content_filter:"stop_sequence"}[de.finish_reason]||"end_turn",stop_sequence:null},usage:{input_tokens:re.usage?.prompt_tokens||0,output_tokens:re.usage?.completion_tokens||0,cache_read_input_tokens:re.usage?.cache_read_input_tokens||0}});break}}catch(re){this.logger?.error(`parseError: ${re.name} message: ${re.message} stack: ${re.stack} data: ${ye}`)}}}L()}catch(H){if(!g)try{n.error(H)}catch(K){console.error(K)}}finally{if(U)try{U.releaseLock()}catch(H){console.error(H)}}},cancel:n=>{this.logger.debug(`cancle stream: ${n}`)}})}convertOpenAIResponseToAnthropic(e){this.logger.debug({response:e},"Original OpenAI response");try{let t=e.choices[0];if(!t)throw new Error("No choices found in OpenAI response");let n=[];if(t.message.annotations){let a=`srvtoolu_${Tr()}`;n.push({type:"server_tool_use",id:a,name:"web_search",input:{query:""}}),n.push({type:"web_search_tool_result",tool_use_id:a,content:t.message.annotations.map(u=>({type:"web_search_result",url:u.url_citation.url,title:u.url_citation.title}))})}t.message.content&&n.push({type:"text",text:t.message.content}),t.message.tool_calls&&t.message.tool_calls.length>0&&t.message.tool_calls.forEach((a,u)=>{let l={};try{let f=a.function.arguments||"{}";typeof f=="object"?l=f:typeof f=="string"&&(l=JSON.parse(f))}catch{l={text:a.function.arguments||""}}n.push({type:"tool_use",id:a.id,name:a.function.name,input:l})});let s={id:e.id,type:"message",role:"assistant",model:e.model,content:n,stop_reason:t.finish_reason==="stop"?"end_turn":t.finish_reason==="length"?"max_tokens":t.finish_reason==="tool_calls"?"tool_use":t.finish_reason==="content_filter"?"stop_sequence":"end_turn",stop_sequence:null,usage:{input_tokens:e.usage?.prompt_tokens||0,output_tokens:e.usage?.completion_tokens||0}};return this.logger.debug({result:s},"Conversion complete, final Anthropic response"),s}catch{throw nt(`Provider error: ${JSON.stringify(e)}`,500,"provider_error")}}};var Cn={TYPE_UNSPECIFIED:"TYPE_UNSPECIFIED",STRING:"STRING",NUMBER:"NUMBER",INTEGER:"INTEGER",BOOLEAN:"BOOLEAN",ARRAY:"ARRAY",OBJECT:"OBJECT",NULL:"NULL"};function E0(r,e){r.includes("null")&&(e.nullable=!0);let t=r.filter(n=>n!=="null");if(t.length===1){let n=t[0].toUpperCase();e.type=Object.values(Cn).includes(n)?n:Cn.TYPE_UNSPECIFIED}else{e.anyOf=[];for(let n of t){let s=n.toUpperCase();e.anyOf.push({type:Object.values(Cn).includes(s)?s:Cn.TYPE_UNSPECIFIED})}}}function io(r){let e={},t=["items"],n=["anyOf"],s=["properties"];if(r.type&&r.anyOf)throw new Error("type and anyOf cannot be both populated.");let a=r.anyOf;a!=null&&Array.isArray(a)&&a.length==2&&(a[0]&&a[0].type==="null"?(e.nullable=!0,r=a[1]):a[1]&&a[1].type==="null"&&(e.nullable=!0,r=a[0])),r.type&&Array.isArray(r.type)&&E0(r.type,e);for(let[u,l]of Object.entries(r))if(l!=null)if(u=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(Array.isArray(l))continue;let f=l.toUpperCase();e.type=Object.values(Cn).includes(f)?f:Cn.TYPE_UNSPECIFIED}else if(t.includes(u))e[u]=io(l);else if(n.includes(u)){let f=[];for(let h of l){if(h.type=="null"){e.nullable=!0;continue}f.push(io(h))}e[u]=f}else if(s.includes(u)){let f={};for(let[h,d]of Object.entries(l))f[h]=io(d);e[u]=f}else{if(u==="additionalProperties")continue;e[u]=l}return e}function A0(r){if(r.functionDeclarations)for(let e of r.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=io(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=io(e.response));return r}function As(r){let e=[],t=r.tools?.filter(u=>u.function.name!=="web_search")?.map(u=>({name:u.function.name,description:u.function.description,parametersJsonSchema:u.function.parameters}));t?.length&&e.push(A0({functionDeclarations:t})),r.tools?.find(u=>u.function.name==="web_search")&&e.push({googleSearch:{}});let a={contents:r.messages.map(u=>{let l;u.role==="assistant"?l="model":(["user","system","tool"].includes(u.role),l="user");let f=[];return typeof u.content=="string"?f.push({text:u.content}):Array.isArray(u.content)&&f.push(...u.content.map(h=>{if(h.type==="text")return{text:h.text||""};if(h.type==="image_url")return h.image_url.url.startsWith("http")?{file_data:{mime_type:h.media_type,file_uri:h.image_url.url}}:{inlineData:{mime_type:h.media_type,data:h.image_url.url}}})),Array.isArray(u.tool_calls)&&f.push(...u.tool_calls.map(h=>({functionCall:{id:h.id||`tool_${Math.random().toString(36).substring(2,15)}`,name:h.function.name,args:JSON.parse(h.function.arguments||"{}")}}))),{role:l,parts:f}}),tools:e.length?e:void 0};if(r.tool_choice){let u={functionCallingConfig:{}};r.tool_choice==="auto"?u.functionCallingConfig.mode="auto":r.tool_choice==="none"?u.functionCallingConfig.mode="none":r.tool_choice==="required"?u.functionCallingConfig.mode="any":r.tool_choice?.function?.name&&(u.functionCallingConfig.mode="any",u.functionCallingConfig.allowedFunctionNames=[r.tool_choice?.function?.name]),a.toolConfig=u}return a}function ws(r){let e=r.contents,t=r.tools,n=r.model,s=r.max_tokens,a=r.temperature,u=r.stream,l=r.tool_choice,f={messages:[],model:n,max_tokens:s,temperature:a,stream:u,tool_choice:l};return Array.isArray(e)&&e.forEach(h=>{typeof h=="string"?f.messages.push({role:"user",content:h}):typeof h.text=="string"?f.messages.push({role:"user",content:h.text||null}):h.role==="user"?f.messages.push({role:"user",content:h?.parts?.map(d=>({type:"text",text:d.text||""}))||[]}):h.role==="model"&&f.messages.push({role:"assistant",content:h?.parts?.map(d=>({type:"text",text:d.text||""}))||[]})}),Array.isArray(t)&&(f.tools=[],t.forEach(h=>{Array.isArray(h.functionDeclarations)&&h.functionDeclarations.forEach(d=>{f.tools.push({type:"function",function:{name:d.name,description:d.description,parameters:d.parameters}})})})),f}async function Ds(r,e,t){if(r.headers.get("Content-Type")?.includes("application/json")){let n=await r.json(),s=n.candidates[0].content?.parts?.filter(u=>u.functionCall)?.map(u=>({id:u.functionCall?.id||`tool_${Math.random().toString(36).substring(2,15)}`,type:"function",function:{name:u.functionCall?.name,arguments:JSON.stringify(u.functionCall?.args||{})}}))||[],a={id:n.responseId,choices:[{finish_reason:n.candidates[0].finishReason?.toLowerCase()||null,index:0,message:{content:n.candidates[0].content?.parts?.filter(u=>u.text)?.map(u=>u.text)?.join(`
`)||"",role:"assistant",tool_calls:s.length>0?s:void 0}}],created:parseInt(new Date().getTime()/1e3+"",10),model:n.modelVersion,object:"chat.completion",usage:{completion_tokens:n.usageMetadata.candidatesTokenCount,prompt_tokens:n.usageMetadata.promptTokenCount,cached_content_token_count:n.usageMetadata.cachedContentTokenCount||null,total_tokens:n.usageMetadata.totalTokenCount}};return new Response(JSON.stringify(a),{status:r.status,statusText:r.statusText,headers:r.headers})}else if(r.headers.get("Content-Type")?.includes("stream")){if(!r.body)return r;let n=new TextDecoder,s=new TextEncoder,a=(l,f)=>{if(l.startsWith("data: ")){let h=l.slice(6).trim();if(h){t?.debug({chunkStr:h},`${e} chunk:`);try{let d=JSON.parse(h);if(!d.candidates||!d.candidates[0]){log("Invalid chunk structure:",h);return}let _=d.candidates[0],E=_.content?.parts||[],P=E.filter(g=>g.functionCall).map(g=>({id:g.functionCall?.id||`tool_${Math.random().toString(36).substring(2,15)}`,type:"function",function:{name:g.functionCall?.name,arguments:JSON.stringify(g.functionCall?.args||{})}})),A={choices:[{delta:{role:"assistant",content:E.filter(g=>g.text).map(g=>g.text).join(`
`)||"",tool_calls:P.length>0?P:void 0},finish_reason:_.finishReason?.toLowerCase()||null,index:_.index||(P.length>0?1:0),logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.responseId||"",model:d.modelVersion||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usageMetadata?.candidatesTokenCount||0,prompt_tokens:d.usageMetadata?.promptTokenCount||0,cached_content_token_count:d.usageMetadata?.cachedContentTokenCount||null,total_tokens:d.usageMetadata?.totalTokenCount||0}};_?.groundingMetadata?.groundingChunks?.length&&(A.choices[0].delta.annotations=_.groundingMetadata.groundingChunks.map((g,b)=>{let R=_?.groundingMetadata?.groundingSupports?.filter(S=>S.groundingChunkIndices?.includes(b));return{type:"url_citation",url_citation:{url:g?.web?.uri||"",title:g?.web?.title||"",content:R?.[0]?.segment?.text||"",start_index:R?.[0]?.segment?.startIndex||0,end_index:R?.[0]?.segment?.endIndex||0}}})),f.enqueue(s.encode(`data: ${JSON.stringify(A)}

`))}catch(d){t?.error(`Error parsing ${e} stream chunk`,h,d.message)}}}},u=new ReadableStream({async start(l){let f=r.body.getReader(),h="";try{for(;;){let{done:d,value:_}=await f.read();if(d){h&&a(h,l);break}h+=n.decode(_,{stream:!0});let E=h.split(`
`);h=E.pop()||"";for(let P of E)a(P,l)}}catch(d){l.error(d)}finally{l.close()}}});return new Response(u,{status:r.status,statusText:r.statusText,headers:r.headers})}return r}var Ss=class{name="gemini";endPoint="/v1beta/models/:modelAndAction";async transformRequestIn(e,t){return{body:As(e),config:{url:new URL(`./${e.model}:${e.stream?"streamGenerateContent?alt=sse":"generateContent"}`,t.baseUrl),headers:{"x-goog-api-key":t.apiKey,Authorization:void 0}}}}transformRequestOut=ws;async transformResponseOut(e){return Ds(e,this.name,this.logger)}};async function ZA(){try{let{GoogleAuth:r}=await Promise.resolve().then(()=>zr(ll(),1));return(await(await new r({scopes:["https://www.googleapis.com/auth/cloud-platform"]}).getClient()).getAccessToken()).token||""}catch(r){throw console.error("Error getting access token:",r),new Error(`Failed to get access token for Vertex AI. Please ensure you have set up authentication using one of these methods:
1. Set GOOGLE_APPLICATION_CREDENTIALS to point to service account key file
2. Run "gcloud auth application-default login"
3. Use Google Cloud environment with default service account`)}}var Gi=class{name="vertex-gemini";async transformRequestIn(e,t){let n=process.env.GOOGLE_CLOUD_PROJECT,s=process.env.GOOGLE_CLOUD_LOCATION||"us-central1";if(!n&&process.env.GOOGLE_APPLICATION_CREDENTIALS)try{let l=(await import("fs")).readFileSync(process.env.GOOGLE_APPLICATION_CREDENTIALS,"utf8"),f=JSON.parse(l);f&&f.project_id&&(n=f.project_id)}catch(u){console.error("Error extracting project_id from GOOGLE_APPLICATION_CREDENTIALS:",u)}if(!n)throw new Error("Project ID is required for Vertex AI. Set GOOGLE_CLOUD_PROJECT environment variable or ensure project_id is in GOOGLE_APPLICATION_CREDENTIALS file.");let a=await ZA();return{body:As(e),config:{url:new URL(`./v1beta1/projects/${n}/locations/${s}/publishers/google/models/${e.model}:${e.stream?"streamGenerateContent":"generateContent"}`,t.baseUrl.endsWith("/")?t.baseUrl:t.baseUrl+"/"||`https://${s}-aiplatform.googleapis.com`),headers:{Authorization:`Bearer ${a}`,"x-goog-api-key":void 0}}}}transformRequestOut=ws;async transformResponseOut(e){return Ds(e,this.name)}};var Wi=class{name="deepseek";async transformRequestIn(e){return e.max_tokens&&e.max_tokens>8192&&(e.max_tokens=8192),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s="",a=!1,u="",l=new ReadableStream({async start(f){let h=e.body.getReader(),d=(E,P,v)=>{let A=E.split(`
`);for(let g of A)g.trim()&&P.enqueue(v.encode(g+`
`))},_=(E,P)=>{let{controller:v,encoder:A}=P;if(E.startsWith("data: ")&&E.trim()!=="data: [DONE]")try{let g=JSON.parse(E.slice(6));if(g.choices?.[0]?.delta?.reasoning_content){P.appendReasoningContent(g.choices[0].delta.reasoning_content);let b={...g,choices:[{...g.choices[0],delta:{...g.choices[0].delta,thinking:{content:g.choices[0].delta.reasoning_content}}}]};delete b.choices[0].delta.reasoning_content;let R=`data: ${JSON.stringify(b)}

`;v.enqueue(A.encode(R));return}if(g.choices?.[0]?.delta?.content&&P.reasoningContent()&&!P.isReasoningComplete()){P.setReasoningComplete(!0);let b=Date.now().toString(),R={...g,choices:[{...g.choices[0],delta:{...g.choices[0].delta,content:null,thinking:{content:P.reasoningContent(),signature:b}}}]};delete R.choices[0].delta.reasoning_content;let S=`data: ${JSON.stringify(R)}

`;v.enqueue(A.encode(S))}if(g.choices[0]?.delta?.reasoning_content&&delete g.choices[0].delta.reasoning_content,g.choices?.[0]?.delta&&Object.keys(g.choices[0].delta).length>0){P.isReasoningComplete()&&g.choices[0].index++;let b=`data: ${JSON.stringify(g)}

`;v.enqueue(A.encode(b))}}catch{v.enqueue(A.encode(E+`
`))}else v.enqueue(A.encode(E+`
`))};try{for(;;){let{done:E,value:P}=await h.read();if(E){u.trim()&&d(u,f,n);break}let v=t.decode(P,{stream:!0});u+=v;let A=u.split(`
`);u=A.pop()||"";for(let g of A)if(g.trim())try{_(g,{controller:f,encoder:n,reasoningContent:()=>s,appendReasoningContent:b=>s+=b,isReasoningComplete:()=>a,setReasoningComplete:b=>a=b})}catch(b){console.error("Error processing line:",g,b),f.enqueue(n.encode(g+`
`))}}}catch(E){console.error("Stream error:",E),f.error(E)}finally{try{h.releaseLock()}catch(E){console.error("Error releasing reader lock:",E)}f.close()}}});return new Response(l,{status:e.status,statusText:e.statusText,headers:{"Content-Type":e.headers.get("Content-Type")||"text/plain","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Ji=class{name="tooluse";transformRequestIn(e){return e.messages.push({role:"system",content:"<system-reminder>Tool mode is active. The user expects you to proactively execute the most suitable tool to help complete the task. \nBefore invoking a tool, you must carefully evaluate whether it matches the current task. If no available tool is appropriate for the task, you MUST call the `ExitTool` to exit tool mode \u2014 this is the only valid way to terminate tool mode.\nAlways prioritize completing the user's task effectively and efficiently by using tools whenever appropriate.</system-reminder>"}),e.tools?.length&&(e.tool_choice="required",e.tools.push({type:"function",function:{name:"ExitTool",description:`Use this tool when you are in tool mode and have completed the task. This is the only valid way to exit tool mode.
IMPORTANT: Before using this tool, ensure that none of the available tools are applicable to the current task. You must evaluate all available options \u2014 only if no suitable tool can help you complete the task should you use ExitTool to terminate tool mode.
Examples:
1. Task: "Use a tool to summarize this document" \u2014 Do not use ExitTool if a summarization tool is available.
2. Task: "What\u2019s the weather today?" \u2014 If no tool is available to answer, use ExitTool after reasoning that none can fulfill the task.`,parameters:{type:"object",properties:{response:{type:"string",description:"Your response will be forwarded to the user exactly as returned \u2014 the tool will not modify or post-process it in any way."}},required:["response"]}}})),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();if(t?.choices?.[0]?.message.tool_calls?.length&&t?.choices?.[0]?.message.tool_calls[0]?.function?.name==="ExitTool"){let n=t?.choices[0]?.message.tool_calls[0],s=JSON.parse(n.function.arguments||"{}");t.choices[0].message.content=s.response||"",delete t.choices[0].message.tool_calls}return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=-1,a="",u="",l=new ReadableStream({async start(f){let h=e.body.getReader(),d=(E,P,v)=>{let A=E.split(`
`);for(let g of A)g.trim()&&P.enqueue(v.encode(g+`
`))},_=(E,P)=>{let{controller:v,encoder:A,exitToolIndex:g,setExitToolIndex:b,appendExitToolResponse:R}=P;if(E.startsWith("data: ")&&E.trim()!=="data: [DONE]")try{let S=JSON.parse(E.slice(6));if(S.choices[0]?.delta?.tool_calls?.length){let I=S.choices[0].delta.tool_calls[0];if(I.function?.name==="ExitTool"){b(I.index);return}else if(g()>-1&&I.index===g()&&I.function.arguments){R(I.function.arguments);try{let L=JSON.parse(P.exitToolResponse());S.choices=[{delta:{role:"assistant",content:L.response||""}}];let U=`data: ${JSON.stringify(S)}

`;v.enqueue(A.encode(U))}catch{}return}}if(S.choices?.[0]?.delta&&Object.keys(S.choices[0].delta).length>0){let I=`data: ${JSON.stringify(S)}

`;v.enqueue(A.encode(I))}}catch{v.enqueue(A.encode(E+`
`))}else v.enqueue(A.encode(E+`
`))};try{for(;;){let{done:E,value:P}=await h.read();if(E){u.trim()&&d(u,f,n);break}let v=t.decode(P,{stream:!0});u+=v;let A=u.split(`
`);u=A.pop()||"";for(let g of A)if(g.trim())try{_(g,{controller:f,encoder:n,exitToolIndex:()=>s,setExitToolIndex:b=>s=b,exitToolResponse:()=>a,appendExitToolResponse:b=>a+=b})}catch(b){console.error("Error processing line:",g,b),f.enqueue(n.encode(g+`
`))}}}catch(E){console.error("Stream error:",E),f.error(E)}finally{try{h.releaseLock()}catch(E){console.error("Error releasing reader lock:",E)}f.close()}}});return new Response(l,{status:e.status,statusText:e.statusText,headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var zi=class{constructor(e){this.options=e}static TransformerName="openrouter";async transformRequestIn(e){return e.model.includes("claude")?e.messages.forEach(t=>{Array.isArray(t.content)&&t.content.forEach(n=>{n.type==="image_url"&&(n.image_url.url.startsWith("http")||(n.image_url.url=`data:${n.media_type};base64,${n.image_url.url}`),delete n.media_type)})}):e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control,n.type==="image_url"&&(n.image_url.url.startsWith("http")||(n.image_url.url=`data:${n.media_type};base64,${n.image_url.url}`),delete n.media_type)}):t.cache_control&&delete t.cache_control}),Object.assign(e,this.options||{}),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=!1,a="",u=!1,l=!1,f="",h=new ReadableStream({async start(d){let _=e.body.getReader(),E=(v,A,g)=>{let b=v.split(`
`);for(let R of b)R.trim()&&A.enqueue(g.encode(R+`
`))},P=(v,A)=>{let{controller:g,encoder:b}=A;if(v.startsWith("data: ")&&v.trim()!=="data: [DONE]"){let R=v.slice(6);try{let S=JSON.parse(R);if(S.usage&&(this.logger?.debug({usage:S.usage,hasToolCall:l},"usage"),S.choices[0].finish_reason=l?"tool_calls":"stop"),S.choices?.[0]?.finish_reason==="error"&&g.enqueue(b.encode(`data: ${JSON.stringify({error:S.choices?.[0].error})}

`)),S.choices?.[0]?.delta?.content&&!A.hasTextContent()&&A.setHasTextContent(!0),S.choices?.[0]?.delta?.reasoning){A.appendReasoningContent(S.choices[0].delta.reasoning);let L={...S,choices:[{...S.choices?.[0],delta:{...S.choices[0].delta,thinking:{content:S.choices[0].delta.reasoning}}}]};L.choices?.[0]?.delta&&delete L.choices[0].delta.reasoning;let U=`data: ${JSON.stringify(L)}

`;g.enqueue(b.encode(U));return}if(S.choices?.[0]?.delta?.content&&A.reasoningContent()&&!A.isReasoningComplete()){A.setReasoningComplete(!0);let L=Date.now().toString(),U={...S,choices:[{...S.choices?.[0],delta:{...S.choices[0].delta,content:null,thinking:{content:A.reasoningContent(),signature:L}}}]};U.choices?.[0]?.delta&&delete U.choices[0].delta.reasoning;let H=`data: ${JSON.stringify(U)}

`;g.enqueue(b.encode(H))}S.choices?.[0]?.delta?.reasoning&&delete S.choices[0].delta.reasoning,S.choices?.[0]?.delta?.tool_calls?.length&&!Number.isNaN(parseInt(S.choices?.[0]?.delta?.tool_calls[0].id,10))&&S.choices?.[0]?.delta?.tool_calls.forEach(L=>{L.id=`call_${Tr()}`}),S.choices?.[0]?.delta?.tool_calls?.length&&!l&&(l=!0),S.choices?.[0]?.delta?.tool_calls?.length&&A.hasTextContent()&&(typeof S.choices[0].index=="number"?S.choices[0].index+=1:S.choices[0].index=1);let I=`data: ${JSON.stringify(S)}

`;g.enqueue(b.encode(I))}catch{g.enqueue(b.encode(v+`
`))}}else g.enqueue(b.encode(v+`
`))};try{for(;;){let{done:v,value:A}=await _.read();if(v){f.trim()&&E(f,d,n);break}if(!A||A.length===0)continue;let g;try{g=t.decode(A,{stream:!0})}catch(R){console.warn("Failed to decode chunk",R);continue}if(g.length===0)continue;if(f+=g,f.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let R=f.split(`
`);f=R.pop()||"";for(let S of R)if(S.trim())try{P(S,{controller:d,encoder:n,hasTextContent:()=>s,setHasTextContent:I=>s=I,reasoningContent:()=>a,appendReasoningContent:I=>a+=I,isReasoningComplete:()=>u,setReasoningComplete:I=>u=I})}catch(I){console.error("Error processing line:",S,I),d.enqueue(n.encode(S+`
`))}continue}let b=f.split(`
`);f=b.pop()||"";for(let R of b)if(R.trim())try{P(R,{controller:d,encoder:n,hasTextContent:()=>s,setHasTextContent:S=>s=S,reasoningContent:()=>a,appendReasoningContent:S=>a+=S,isReasoningComplete:()=>u,setReasoningComplete:S=>u=S})}catch(S){console.error("Error processing line:",R,S),d.enqueue(n.encode(R+`
`))}}}catch(v){console.error("Stream error:",v),d.error(v)}finally{try{_.releaseLock()}catch(v){console.error("Error releasing reader lock:",v)}d.close()}}});return new Response(h,{status:e.status,statusText:e.statusText,headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Vi=class{name="openai";constructor(){}async transformRequestOut(e){return e.max_tokens&&(e.max_completion_tokens=e.max_tokens,delete e.max_tokens),e.temperature!==void 0&&e.temperature!==1&&delete e.temperature,e.reasoning&&(typeof e.reasoning=="object"?(e.reasoning_effort=e.reasoning.effort??"medium",delete e.reasoning):typeof e.reasoning=="string"&&delete e.reasoning),e.tools&&(e.tools.every(n=>n.function&&typeof n.function=="object"&&n.function.name&&n.function.parameters)?e.tools=e.tools.map(n=>{if(n.function?.parameters){let s={...n.function.parameters};return delete s.$schema,delete s.additionalProperties,{...n,function:{...n.function,parameters:s}}}return n}):e.tools=e.tools.map(n=>n.type==="custom"?{type:"custom",function:{name:n.name,description:n.description,parameters:n.input_schema}}:{type:"function",function:{name:n.name,description:n.description,parameters:n.input_schema}})),e.verbosity&&typeof e.verbosity=="string"&&(["low","medium","high"].includes(e.verbosity)||delete e.verbosity),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json"))try{let t=await e.json();if(this.logger?.info({hasChoices:!!t.choices,choicesLength:t.choices?.length||0,firstChoiceKeys:t.choices?.[0]?Object.keys(t.choices[0]):[],messageKeys:t.choices?.[0]?.message?Object.keys(t.choices[0].message):[],hasReasoningContent:!!t.choices?.[0]?.message?.reasoning_content,hasUsage:!!t.usage,model:t.model,verbosity:t.choices?.[0]?.message?.verbosity,reasoning_effort:t.choices?.[0]?.message?.reasoning_effort},"GPT-5 Response Structure Debug"),t.choices?.length>0){let n=t.choices[0];if(n.message?.reasoning_content){this.logger?.info({hasReasoningContent:!0,reasoningLength:n.message.reasoning_content.length,model:t.model},"\u2705 GPT-5 reasoning content detected - prepending to response");let s=n.message.content||"",a=`<reasoning>
${n.message.reasoning_content}
</reasoning>

`;n.message.content=a+s,n.message._raw_reasoning_content=n.message.reasoning_content}else this.logger?.debug({messageKeys:Object.keys(n.message||{}),contentPreview:n.message?.content?.substring(0,100)},"No reasoning content found in GPT-5 response")}return t.usage?.completion_tokens_details?.reasoning_tokens&&(this.logger?.debug({reasoningTokens:t.usage.completion_tokens_details.reasoning_tokens,totalTokens:t.usage.total_tokens},"GPT-5 reasoning tokens detected in usage"),fs.appendFileSync("/tmp/gpt5-response-debug.log",`[${new Date().toISOString()}] \u2705 REASONING TOKENS: ${t.usage.completion_tokens_details.reasoning_tokens}

`)),new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}catch(t){return this.logger?.error({error:t.message},"Failed to process GPT-5 response"),e}return e}get endPoint(){return"/chat/completions"}};var Ki=class{constructor(e){this.options=e;this.max_tokens=this.options?.max_tokens}static TransformerName="maxtoken";max_tokens;async transformRequestIn(e){return e.max_tokens&&e.max_tokens>this.max_tokens&&(e.max_tokens=this.max_tokens),e}};var Yi=class{name="groq";async transformRequestIn(e){return e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control}):t.cache_control&&delete t.cache_control}),Array.isArray(e.tools)&&e.tools.forEach(t=>{delete t.function.parameters.$schema}),e}async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s=!1,a="",u=!1,l="",f=new ReadableStream({async start(h){let d=e.body.getReader(),_=(P,v,A)=>{let g=P.split(`
`);for(let b of g)b.trim()&&v.enqueue(A.encode(b+`
`))},E=(P,v)=>{let{controller:A,encoder:g}=v;if(P.startsWith("data: ")&&P.trim()!=="data: [DONE]"){let b=P.slice(6);try{let R=JSON.parse(b);if(R.error)throw new Error(JSON.stringify(R));R.choices?.[0]?.delta?.content&&!v.hasTextContent()&&v.setHasTextContent(!0),R.choices?.[0]?.delta?.tool_calls?.length&&R.choices?.[0]?.delta?.tool_calls.forEach(I=>{I.id=`call_${Tr()}`}),R.choices?.[0]?.delta?.tool_calls?.length&&v.hasTextContent()&&(typeof R.choices[0].index=="number"?R.choices[0].index+=1:R.choices[0].index=1);let S=`data: ${JSON.stringify(R)}

`;A.enqueue(g.encode(S))}catch{A.enqueue(g.encode(P+`
`))}}else A.enqueue(g.encode(P+`
`))};try{for(;;){let{done:P,value:v}=await d.read();if(P){l.trim()&&_(l,h,n);break}if(!v||v.length===0)continue;let A;try{A=t.decode(v,{stream:!0})}catch(b){console.warn("Failed to decode chunk",b);continue}if(A.length===0)continue;if(l+=A,l.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let b=l.split(`
`);l=b.pop()||"";for(let R of b)if(R.trim())try{E(R,{controller:h,encoder:n,hasTextContent:()=>s,setHasTextContent:S=>s=S,reasoningContent:()=>a,appendReasoningContent:S=>a+=S,isReasoningComplete:()=>u,setReasoningComplete:S=>u=S})}catch(S){console.error("Error processing line:",R,S),h.enqueue(n.encode(R+`
`))}continue}let g=l.split(`
`);l=g.pop()||"";for(let b of g)if(b.trim())try{E(b,{controller:h,encoder:n,hasTextContent:()=>s,setHasTextContent:R=>s=R,reasoningContent:()=>a,appendReasoningContent:R=>a+=R,isReasoningComplete:()=>u,setReasoningComplete:R=>u=R})}catch(R){console.error("Error processing line:",b,R),h.enqueue(n.encode(b+`
`))}}}catch(P){console.error("Stream error:",P),h.error(P)}finally{try{d.releaseLock()}catch(P){console.error("Error releasing reader lock:",P)}h.close()}}});return new Response(f,{status:e.status,statusText:e.statusText,headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var Xi=class{name="cleancache";async transformRequestIn(e){return Array.isArray(e.messages)&&e.messages.forEach(t=>{Array.isArray(t.content)?t.content.forEach(n=>{n.cache_control&&delete n.cache_control}):t.cache_control&&delete t.cache_control}),e}};var ag=zr(Ha(),1);var yr=class extends Error{constructor(e,t){super(`${e} at position ${t}`),this.position=t}};function eg(r){return/^[0-9A-Fa-f]$/.test(r)}function Lr(r){return r>="0"&&r<="9"}function tg(r){return r>=" "}function Io(r){return`,:[]/{}()
+`.includes(r)}function fl(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="_"||r==="$"}function dl(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="_"||r==="$"||r>="0"&&r<="9"}var hl=/^(http|https|ftp|mailto|file|data|irc):\/\/$/,pl=/^[A-Za-z0-9-._~:/?#@!$&'()*+;=]$/;function ml(r){return`,[]/{}
+`.includes(r)}function gl(r){return jo(r)||ew.test(r)}var ew=/^[[{\w-]$/;function rg(r){return r===`
`||r==="\r"||r==="	"||r==="\b"||r==="\f"}function jr(r,e){let t=r.charCodeAt(e);return t===32||t===10||t===9||t===13}function ng(r,e){let t=r.charCodeAt(e);return t===32||t===9||t===13}function og(r,e){let t=r.charCodeAt(e);return t===160||t>=8192&&t<=8202||t===8239||t===8287||t===12288}function jo(r){return yl(r)||Qi(r)}function yl(r){return r==='"'||r==="\u201C"||r==="\u201D"}function _l(r){return r==='"'}function Qi(r){return r==="'"||r==="\u2018"||r==="\u2019"||r==="`"||r==="\xB4"}function bl(r){return r==="'"}function Kn(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r.lastIndexOf(e);return n!==-1?r.substring(0,n)+(t?"":r.substring(n+1)):r}function kt(r,e){let t=r.length;if(!jr(r,t-1))return r+e;for(;jr(r,t-1);)t--;return r.substring(0,t)+e+r.substring(t)}function sg(r,e,t){return r.substring(0,e)+r.substring(e+t)}function ig(r){return/[,\n][ \t\r]*$/.test(r)}var tw={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},rw={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function Cl(r){let e=0,t="";h(["```","[```","{```"]),a()||re(),h(["```","```]","```}"]);let s=_(",");for(s&&u(),gl(r[e])&&ig(t)?(s||(t=kt(t,",")),b()):s&&(t=Kn(t,","));r[e]==="}"||r[e]==="]";)e++,u();if(e>=r.length)return t;ye();function a(){u();let z=A()||g()||R()||I()||L()||H(!1)||K();return u(),z}function u(){let z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,oe=e,se=l(z);do se=f(),se&&(se=l(z));while(se);return e>oe}function l(z){let oe=z?jr:ng,se="";for(;;)if(oe(r,e))se+=r[e],e++;else if(og(r,e))se+=" ",e++;else break;return se.length>0?(t+=se,!0):!1}function f(){if(r[e]==="/"&&r[e+1]==="*"){for(;e<r.length&&!nw(r,e);)e++;return e+=2,!0}if(r[e]==="/"&&r[e+1]==="/"){for(;e<r.length&&r[e]!==`
`;)e++;return!0}return!1}function h(z){if(d(z)){if(fl(r[e]))for(;e<r.length&&dl(r[e]);)e++;return u(),!0}return!1}function d(z){for(let oe of z){let se=e+oe.length;if(r.slice(e,se)===oe)return e=se,!0}return!1}function _(z){return r[e]===z?(t+=r[e],e++,!0):!1}function E(z){return r[e]===z?(e++,!0):!1}function P(){return E("\\")}function v(){return u(),r[e]==="."&&r[e+1]==="."&&r[e+2]==="."?(e+=3,u(),E(","),!0):!1}function A(){if(r[e]==="{"){t+="{",e++,u(),E(",")&&u();let z=!0;for(;e<r.length&&r[e]!=="}";){let oe;if(z?(oe=!0,z=!1):(oe=_(","),oe||(t=kt(t,",")),u()),v(),!(R()||H(!0))){r[e]==="}"||r[e]==="{"||r[e]==="]"||r[e]==="["||r[e]===void 0?t=Kn(t,","):de();break}u();let Ne=_(":"),Le=e>=r.length;Ne||(gl(r[e])||Le?t=kt(t,":"):Z()),a()||(Ne||Le?t+="null":Z())}return r[e]==="}"?(t+="}",e++):t=kt(t,"}"),!0}return!1}function g(){if(r[e]==="["){t+="[",e++,u(),E(",")&&u();let z=!0;for(;e<r.length&&r[e]!=="]";)if(z?z=!1:_(",")||(t=kt(t,",")),v(),!a()){t=Kn(t,",");break}return r[e]==="]"?(t+="]",e++):t=kt(t,"]"),!0}return!1}function b(){let z=!0,oe=!0;for(;oe;)z?z=!1:_(",")||(t=kt(t,",")),oe=a();oe||(t=Kn(t,",")),t=`[
${t}
]`}function R(){let z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,se=r[e]==="\\";if(se&&(e++,se=!0),jo(r[e])){let Ne=_l(r[e])?_l:bl(r[e])?bl:Qi(r[e])?Qi:yl,Le=e,G=t.length,pe='"';for(e++;;){if(e>=r.length){let Ee=W(e-1);return!z&&Io(r.charAt(Ee))?(e=Le,t=t.substring(0,G),R(!0)):(pe=kt(pe,'"'),t+=pe,!0)}if(e===oe)return pe=kt(pe,'"'),t+=pe,!0;if(Ne(r[e])){let Ee=e,er=pe.length;if(pe+='"',e++,t+=pe,u(!1),z||e>=r.length||Io(r[e])||jo(r[e])||Lr(r[e]))return S(),!0;let xe=W(Ee-1),Ie=r.charAt(xe);if(Ie===",")return e=Le,t=t.substring(0,G),R(!1,xe);if(Io(Ie))return e=Le,t=t.substring(0,G),R(!0);t=t.substring(0,G),e=Ee+1,pe=`${pe.substring(0,er)}\\${pe.substring(er)}`}else if(z&&ml(r[e])){if(r[e-1]===":"&&hl.test(r.substring(Le+1,e+2)))for(;e<r.length&&pl.test(r[e]);)pe+=r[e],e++;return pe=kt(pe,'"'),t+=pe,S(),!0}else if(r[e]==="\\"){let Ee=r.charAt(e+1);if(rw[Ee]!==void 0)pe+=r.slice(e,e+2),e+=2;else if(Ee==="u"){let xe=2;for(;xe<6&&eg(r[e+xe]);)xe++;xe===6?(pe+=r.slice(e,e+6),e+=6):e+xe>=r.length?e=r.length:ue()}else pe+=Ee,e+=2}else{let Ee=r.charAt(e);Ee==='"'&&r[e-1]!=="\\"?(pe+=`\\${Ee}`,e++):rg(Ee)?(pe+=tw[Ee],e++):(tg(Ee)||fe(Ee),pe+=Ee,e++)}se&&P()}}return!1}function S(){let z=!1;for(u();r[e]==="+";){z=!0,e++,u(),t=Kn(t,'"',!0);let oe=t.length;R()?t=sg(t,oe,1):t=kt(t,'"')}return z}function I(){let z=e;if(r[e]==="-"){if(e++,we())return he(z),!0;if(!Lr(r[e]))return e=z,!1}for(;Lr(r[e]);)e++;if(r[e]==="."){if(e++,we())return he(z),!0;if(!Lr(r[e]))return e=z,!1;for(;Lr(r[e]);)e++}if(r[e]==="e"||r[e]==="E"){if(e++,(r[e]==="-"||r[e]==="+")&&e++,we())return he(z),!0;if(!Lr(r[e]))return e=z,!1;for(;Lr(r[e]);)e++}if(!we())return e=z,!1;if(e>z){let oe=r.slice(z,e),se=/^0\d/.test(oe);return t+=se?`"${oe}"`:oe,!0}return!1}function L(){return U("true","true")||U("false","false")||U("null","null")||U("True","true")||U("False","false")||U("None","null")}function U(z,oe){return r.slice(e,e+z.length)===z?(t+=oe,e+=z.length,!0):!1}function H(z){let oe=e;if(fl(r[e])){for(;e<r.length&&dl(r[e]);)e++;let se=e;for(;jr(r,se);)se++;if(r[se]==="(")return e=se+1,a(),r[e]===")"&&(e++,r[e]===";"&&e++),!0}for(;e<r.length&&!ml(r[e])&&!jo(r[e])&&(!z||r[e]!==":");)e++;if(r[e-1]===":"&&hl.test(r.substring(oe,e+2)))for(;e<r.length&&pl.test(r[e]);)e++;if(e>oe){for(;jr(r,e-1)&&e>0;)e--;let se=r.slice(oe,e);return t+=se==="undefined"?"null":JSON.stringify(se),r[e]==='"'&&e++,!0}}function K(){if(r[e]==="/"){let z=e;for(e++;e<r.length&&(r[e]!=="/"||r[e-1]==="\\");)e++;return e++,t+=`"${r.substring(z,e)}"`,!0}}function W(z){let oe=z;for(;oe>0&&jr(r,oe);)oe--;return oe}function we(){return e>=r.length||Io(r[e])||jr(r,e)}function he(z){t+=`${r.slice(z,e)}0`}function fe(z){throw new yr(`Invalid character ${JSON.stringify(z)}`,e)}function ye(){throw new yr(`Unexpected character ${JSON.stringify(r[e])}`,e)}function re(){throw new yr("Unexpected end of json string",r.length)}function de(){throw new yr("Object key expected",e)}function Z(){throw new yr("Colon expected",e)}function ue(){let z=r.slice(e,e+6);throw new yr(`Invalid unicode character "${z}"`,e)}}function nw(r,e){return r[e]==="*"&&r[e+1]==="/"}function El(r,e){if(!r||r.trim()===""||r==="{}")return"{}";try{return JSON.parse(r),e?.debug("\u5DE5\u5177\u8C03\u7528\u53C2\u6570\u6807\u51C6JSON\u89E3\u6790\u6210\u529F / Tool arguments standard JSON parsing successful"),r}catch(t){try{let n=ag.default.parse(r);return e?.debug("\u5DE5\u5177\u8C03\u7528\u53C2\u6570JSON5\u89E3\u6790\u6210\u529F / Tool arguments JSON5 parsing successful"),JSON.stringify(n)}catch(n){try{let s=Cl(r);return e?.debug("\u5DE5\u5177\u8C03\u7528\u53C2\u6570\u5B89\u5168\u4FEE\u590D\u6210\u529F / Tool arguments safely repaired"),s}catch(s){return e?.error(`JSON\u89E3\u6790\u5931\u8D25 / JSON parsing failed: ${t.message}. JSON5\u89E3\u6790\u5931\u8D25 / JSON5 parsing failed: ${n.message}. JSON\u4FEE\u590D\u5931\u8D25 / JSON repair failed: ${s.message}. \u8F93\u5165\u6570\u636E / Input data: ${JSON.stringify(r)}`),e?.debug("\u8FD4\u56DE\u5B89\u5168\u7684\u7A7A\u5BF9\u8C61\u4F5C\u4E3A\u540E\u5907\u65B9\u6848 / Returning safe empty object as fallback"),"{}"}}}}var Zi=class{name="enhancetool";async transformResponseOut(e){if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();if(t?.choices?.[0]?.message?.tool_calls?.length)for(let n of t.choices[0].message.tool_calls)n.function?.arguments&&(n.function.arguments=El(n.function.arguments,this.logger));return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s={},a=!1,u="",l=!1,f=!1,h="",d=new ReadableStream({async start(_){let E=e.body.getReader(),P=(g,b,R)=>{let S=g.split(`
`);for(let I of S)I.trim()&&b.enqueue(R.encode(I+`
`))},v=(g,b,R)=>{let S="";try{S=El(s.arguments||"",this.logger)}catch(H){console.error(`${H.message} ${H.stack}  \u5DE5\u5177\u8C03\u7528\u53C2\u6570\u89E3\u6790\u5931\u8D25: ${JSON.stringify(s)}`),S=s.arguments||""}let I={role:"assistant",tool_calls:[{function:{name:s.name,arguments:S},id:s.id,index:s.index,type:"function"}]},L={...g,choices:[{...g.choices[0],delta:I}]};L.choices[0].delta.content!==void 0&&delete L.choices[0].delta.content;let U=`data: ${JSON.stringify(L)}

`;b.enqueue(R.encode(U))},A=(g,b)=>{let{controller:R,encoder:S}=b;if(g.startsWith("data: ")&&g.trim()!=="data: [DONE]"){let I=g.slice(6);try{let L=JSON.parse(I);if(L.choices?.[0]?.delta?.tool_calls?.length){let H=L.choices[0].delta.tool_calls[0];if(typeof s.index>"u"){s={index:H.index,name:H.function?.name||"",id:H.id||"",arguments:H.function?.arguments||""},H.function?.arguments&&(H.function.arguments="");let K=`data: ${JSON.stringify(L)}

`;R.enqueue(S.encode(K));return}else if(s.index===H.index){H.function?.arguments&&(s.arguments+=H.function.arguments);return}else{v(L,R,S),s={index:H.index,name:H.function?.name||"",id:H.id||"",arguments:H.function?.arguments||""};return}}if(L.choices?.[0]?.finish_reason==="tool_calls"&&s.index!==void 0){v(L,R,S),s={};return}L.choices?.[0]?.delta?.tool_calls?.length&&b.hasTextContent()&&(typeof L.choices[0].index=="number"?L.choices[0].index+=1:L.choices[0].index=1);let U=`data: ${JSON.stringify(L)}

`;R.enqueue(S.encode(U))}catch{R.enqueue(S.encode(g+`
`))}}else R.enqueue(S.encode(g+`
`))};try{for(;;){let{done:g,value:b}=await E.read();if(g){h.trim()&&P(h,_,n);break}if(!b||b.length===0)continue;let R;try{R=t.decode(b,{stream:!0})}catch(I){console.warn("Failed to decode chunk",I);continue}if(R.length===0)continue;if(h+=R,h.length>1e6){console.warn("Buffer size exceeds limit, processing partial data");let I=h.split(`
`);h=I.pop()||"";for(let L of I)if(L.trim())try{A(L,{controller:_,encoder:n,hasTextContent:()=>a,setHasTextContent:U=>a=U,reasoningContent:()=>u,appendReasoningContent:U=>u+=U,isReasoningComplete:()=>l,setReasoningComplete:U=>l=U})}catch(U){console.error("Error processing line:",L,U),_.enqueue(n.encode(L+`
`))}continue}let S=h.split(`
`);h=S.pop()||"";for(let I of S)if(I.trim())try{A(I,{controller:_,encoder:n,hasTextContent:()=>a,setHasTextContent:L=>a=L,reasoningContent:()=>u,appendReasoningContent:L=>u+=L,isReasoningComplete:()=>l,setReasoningComplete:L=>l=L})}catch(L){console.error("Error processing line:",I,L),_.enqueue(n.encode(I+`
`))}}}catch(g){console.error("Stream error:",g),_.error(g)}finally{try{E.releaseLock()}catch(g){console.error("Error releasing reader lock:",g)}_.close()}}});return new Response(d,{status:e.status,statusText:e.statusText,headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var ea=class{constructor(e){this.options=e;this.enable=this.options?.enable??!0}static TransformerName="reasoning";enable;async transformRequestOut(e){if(!this.enable)return e;if(e.messages){let t=e.messages[e.messages.length-1];if(t?.role==="user"&&typeof t.content=="string"){let n=t.content,s={"Quick:":{effort:"low",verbosity:"low"},"Deep:":{effort:"high",verbosity:"medium"},"Explain:":{effort:"medium",verbosity:"high"},"Brief:":{effort:"medium",verbosity:"low"}},a={"#quick":{effort:"low",verbosity:"low"},"#deep":{effort:"high",verbosity:"medium"},"#explain":{effort:"medium",verbosity:"high"},"#brief":{effort:"medium",verbosity:"low"}},u=n,l=!1;for(let[f,h]of Object.entries(s))if(n.startsWith(f)){e.reasoning_effort||(e.reasoning_effort=h.effort),e.verbosity||(e.verbosity=h.verbosity),u=n.substring(f.length).trim(),l=!0,console.log(`[REASONING TRANSFORMER] Applied prefix token "${f}" -> effort: ${h.effort}, verbosity: ${h.verbosity}`),this.logger?.info({token:f,params:h},"Applied reasoning token from prompt prefix");break}for(let[f,h]of Object.entries(a))if(n.includes(f)){e.reasoning_effort||(e.reasoning_effort=h.effort),e.verbosity||(e.verbosity=h.verbosity),u=u.replace(f,"").trim(),l=!0,console.log(`[REASONING TRANSFORMER] Applied hashtag token "${f}" -> effort: ${h.effort}, verbosity: ${h.verbosity}`),this.logger?.info({hashtag:f,params:h},"Applied reasoning hashtag from prompt");break}l&&(t.content=u)}}if(e.reasoning&&console.log("[REASONING TRANSFORMER] Input reasoning:",JSON.stringify(e.reasoning)),(e.thinking?.type==="enabled"||e.enable_thinking)&&(console.log("[REASONING TRANSFORMER] Converting thinking to reasoning_effort"),e.reasoning_effort="medium",delete e.thinking,delete e.enable_thinking),e.reasoning&&typeof e.reasoning=="object"){if(console.log("[REASONING TRANSFORMER] Processing reasoning object:",JSON.stringify(e.reasoning)),"max_tokens"in e.reasoning){let t=e.reasoning.max_tokens,n=t>1e3?"high":t>500?"medium":"minimal";console.log(`[REASONING TRANSFORMER] Converting max_tokens ${t} to effort: ${n}`),e.reasoning_effort=n}else"effort"in e.reasoning?(console.log("[REASONING TRANSFORMER] Converting reasoning.effort to reasoning_effort"),e.reasoning_effort=e.reasoning.effort):(console.log("[REASONING TRANSFORMER] Unknown reasoning format, removing to avoid API error:",JSON.stringify(e.reasoning)),delete e.reasoning);delete e.reasoning}return e.reasoning_effort?console.log("[REASONING TRANSFORMER] Final reasoning_effort parameter:",e.reasoning_effort):console.log("[REASONING TRANSFORMER] No reasoning_effort parameter in final request"),e}async transformResponseOut(e){if(!this.enable)return e;if(e.headers.get("Content-Type")?.includes("application/json")){let t=await e.json();this.logger?.info({responseKeys:Object.keys(t),messageKeys:t.choices?.[0]?.message?Object.keys(t.choices[0].message):"none",hasReasoning:!!t.choices?.[0]?.message?.reasoning,hasReasoningContent:!!t.choices?.[0]?.message?.reasoning_content,reasoningTokens:t.usage?.completion_tokens_details?.reasoning_tokens,model:t.model},"REASONING TRANSFORMER RESPONSE DEBUG");let n=t.choices?.[0]?.message,s=n?.reasoning_content||n?.reasoning;if(s){let a={...t,choices:[{...t.choices[0],message:{...n,content:[{type:"thinking",content:s},{type:"text",text:n.content||""}]}}]};return delete a.choices[0].message.reasoning,delete a.choices[0].message.reasoning_content,this.logger?.info({reasoningLength:s.length,convertedToThinking:!0,model:t.model},"\u2705 REASONING CONTENT EXTRACTED AND CONVERTED TO THINKING FORMAT"),new Response(JSON.stringify(a),{status:e.status,statusText:e.statusText,headers:e.headers})}return new Response(JSON.stringify(t),{status:e.status,statusText:e.statusText,headers:e.headers})}else if(e.headers.get("Content-Type")?.includes("stream")){if(!e.body)return e;let t=new TextDecoder,n=new TextEncoder,s="",a=!1,u="",l=new ReadableStream({async start(f){let h=e.body.getReader(),d=(E,P,v)=>{let A=E.split(`
`);for(let g of A)g.trim()&&P.enqueue(v.encode(g+`
`))},_=(E,P)=>{let{controller:v,encoder:A}=P;if(this.logger?.debug({line:E},"Processing reason line"),E.startsWith("data: ")&&E.trim()!=="data: [DONE]")try{let g=JSON.parse(E.slice(6));if(g.choices?.[0]?.delta?.reasoning_content){P.appendReasoningContent(g.choices[0].delta.reasoning_content);let b={...g,choices:[{...g.choices[0],delta:{...g.choices[0].delta,thinking:{content:g.choices[0].delta.reasoning_content}}}]};delete b.choices[0].delta.reasoning_content;let R=`data: ${JSON.stringify(b)}

`;v.enqueue(A.encode(R));return}if((g.choices?.[0]?.delta?.content||g.choices?.[0]?.delta?.tool_calls)&&P.reasoningContent()&&!P.isReasoningComplete()){P.setReasoningComplete(!0);let b=Date.now().toString(),R={...g,choices:[{...g.choices[0],delta:{...g.choices[0].delta,content:null,thinking:{content:P.reasoningContent(),signature:b}}}]};delete R.choices[0].delta.reasoning_content;let S=`data: ${JSON.stringify(R)}

`;v.enqueue(A.encode(S))}if(g.choices?.[0]?.delta?.reasoning_content&&delete g.choices[0].delta.reasoning_content,g.choices?.[0]?.delta&&Object.keys(g.choices[0].delta).length>0){P.isReasoningComplete()&&g.choices[0].index++;let b=`data: ${JSON.stringify(g)}

`;v.enqueue(A.encode(b))}}catch{v.enqueue(A.encode(E+`
`))}else v.enqueue(A.encode(E+`
`))};try{for(;;){let{done:E,value:P}=await h.read();if(E){u.trim()&&d(u,f,n);break}let v=t.decode(P,{stream:!0});u+=v;let A=u.split(`
`);u=A.pop()||"";for(let g of A)if(g.trim())try{_(g,{controller:f,encoder:n,reasoningContent:()=>s,appendReasoningContent:b=>s+=b,isReasoningComplete:()=>a,setReasoningComplete:b=>a=b})}catch(b){console.error("Error processing line:",g,b),f.enqueue(n.encode(g+`
`))}}}catch(E){console.error("Stream error:",E),f.error(E)}finally{try{h.releaseLock()}catch(E){console.error("Error releasing reader lock:",E)}f.close()}}});return new Response(l,{status:e.status,statusText:e.statusText,headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}return e}};var ta=class{constructor(e){this.options=e;this.max_tokens=this.options?.max_tokens,this.temperature=this.options?.temperature,this.top_p=this.options?.top_p,this.top_k=this.options?.top_k,this.repetition_penalty=this.options?.repetition_penalty}name="sampling";max_tokens;temperature;top_p;top_k;repetition_penalty;async transformRequestIn(e){return e.max_tokens&&e.max_tokens>this.max_tokens&&(e.max_tokens=this.max_tokens),typeof this.temperature<"u"&&(e.temperature=this.temperature),typeof this.top_p<"u"&&(e.top_p=this.top_p),typeof this.top_k<"u"&&(e.top_k=this.top_k),typeof this.repetition_penalty<"u"&&(e.repetition_penalty=this.repetition_penalty),e}};var ra=class{static TransformerName="maxcompletiontokens";async transformRequestIn(e){return e.max_tokens&&(e.max_completion_tokens=e.max_tokens,delete e.max_tokens),e}};function ug(r){let e=[];for(let n=0;n<r.messages.length;n++){let s=r.messages[n],a=n===r.messages.length-1,u=s.role==="assistant",l=[];typeof s.content=="string"?l.push({type:"text",text:s.content}):Array.isArray(s.content)&&s.content.forEach(f=>{f.type==="text"?l.push({type:"text",text:f.text||""}):f.type==="image_url"&&l.push({type:"image",source:{type:"base64",media_type:f.media_type||"image/jpeg",data:f.image_url.url}})}),!(!a&&l.length===0&&!s.tool_calls&&!s.content)&&(a&&u&&l.length===0&&s.tool_calls&&l.push({type:"text",text:""}),e.push({role:s.role==="assistant"?"assistant":"user",content:l}))}let t={anthropic_version:"vertex-2023-10-16",messages:e,max_tokens:r.max_tokens||1e3,stream:r.stream||!1,...r.temperature&&{temperature:r.temperature}};return r.tools&&r.tools.length>0&&(t.tools=r.tools.map(n=>({name:n.function.name,description:n.function.description,input_schema:n.function.parameters}))),r.tool_choice&&(r.tool_choice==="auto"||r.tool_choice==="none"?t.tool_choice=r.tool_choice:typeof r.tool_choice=="string"&&(t.tool_choice={type:"tool",name:r.tool_choice})),t}function cg(r){let e=r,n={messages:e.messages.map(s=>{let a=s.content.map(u=>u.type==="text"?{type:"text",text:u.text||""}:u.type==="image"&&u.source?{type:"image_url",image_url:{url:u.source.data},media_type:u.source.media_type}:{type:"text",text:""});return{role:s.role,content:a}}),model:r.model||"claude-sonnet-4@20250514",max_tokens:e.max_tokens,temperature:e.temperature,stream:e.stream};return e.tools&&e.tools.length>0&&(n.tools=e.tools.map(s=>({type:"function",function:{name:s.name,description:s.description,parameters:{type:"object",properties:s.input_schema.properties,required:s.input_schema.required,additionalProperties:s.input_schema.additionalProperties,$schema:s.input_schema.$schema}}}))),e.tool_choice&&(typeof e.tool_choice=="string"?n.tool_choice=e.tool_choice:e.tool_choice.type==="tool"&&(n.tool_choice=e.tool_choice.name)),n}async function lg(r,e,t){if(r.headers.get("Content-Type")?.includes("application/json")){let n=await r.json(),s;n.tool_use&&n.tool_use.length>0&&(s=n.tool_use.map(u=>({id:u.id,type:"function",function:{name:u.name,arguments:JSON.stringify(u.input)}})));let a={id:n.id,choices:[{finish_reason:n.stop_reason||null,index:0,message:{content:n.content[0]?.text||"",role:"assistant",...s&&{tool_calls:s}}}],created:parseInt(new Date().getTime()/1e3+"",10),model:n.model,object:"chat.completion",usage:{completion_tokens:n.usage.output_tokens,prompt_tokens:n.usage.input_tokens,total_tokens:n.usage.input_tokens+n.usage.output_tokens}};return new Response(JSON.stringify(a),{status:r.status,statusText:r.statusText,headers:r.headers})}else if(r.headers.get("Content-Type")?.includes("stream")){if(!r.body)return r;let n=new TextDecoder,s=new TextEncoder,a=(l,f)=>{if(l.startsWith("data: ")){let h=l.slice(6).trim();if(h){t?.debug({chunkStr:h},`${e} chunk:`);try{let d=JSON.parse(h);if(d.type==="content_block_delta"&&d.delta?.type==="text_delta"){let _={choices:[{delta:{role:"assistant",content:d.delta.text||""},finish_reason:null,index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};f.enqueue(s.encode(`data: ${JSON.stringify(_)}

`))}else if(d.type==="content_block_delta"&&d.delta?.type==="input_json_delta"){let _={choices:[{delta:{tool_calls:[{index:d.index||0,function:{arguments:d.delta.partial_json||""}}]},finish_reason:null,index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};f.enqueue(s.encode(`data: ${JSON.stringify(_)}

`))}else if(d.type==="content_block_start"&&d.content_block?.type==="tool_use"){let _={choices:[{delta:{tool_calls:[{index:d.index||0,id:d.content_block.id,type:"function",function:{name:d.content_block.name,arguments:""}}]},finish_reason:null,index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};f.enqueue(s.encode(`data: ${JSON.stringify(_)}

`))}else if(d.type==="message_delta"){let _={choices:[{delta:{},finish_reason:d.delta?.stop_reason==="tool_use"?"tool_calls":d.delta?.stop_reason==="max_tokens"?"length":d.delta?.stop_reason==="stop_sequence"?"content_filter":"stop",index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};f.enqueue(s.encode(`data: ${JSON.stringify(_)}

`))}else if(d.type==="message_stop")f.enqueue(s.encode(`data: [DONE]

`));else{let _={choices:[{delta:{role:"assistant",content:d.content?.[0]?.text||""},finish_reason:d.stop_reason?.toLowerCase()||null,index:0,logprobs:null}],created:parseInt(new Date().getTime()/1e3+"",10),id:d.id||"",model:d.model||"",object:"chat.completion.chunk",system_fingerprint:"fp_a49d71b8a1",usage:{completion_tokens:d.usage?.output_tokens||0,prompt_tokens:d.usage?.input_tokens||0,total_tokens:(d.usage?.input_tokens||0)+(d.usage?.output_tokens||0)}};f.enqueue(s.encode(`data: ${JSON.stringify(_)}

`))}}catch(d){t?.error(`Error parsing ${e} stream chunk`,h,d.message)}}}},u=new ReadableStream({async start(l){let f=r.body.getReader(),h="";try{for(;;){let{done:d,value:_}=await f.read();if(d){h&&a(h,l);break}h+=n.decode(_,{stream:!0});let E=h.split(`
`);h=E.pop()||"";for(let P of E)a(P,l)}}catch(d){l.error(d)}finally{l.close()}}});return new Response(u,{status:r.status,statusText:r.statusText,headers:r.headers})}return r}async function ow(){try{let{GoogleAuth:r}=await Promise.resolve().then(()=>zr(ll(),1));return(await(await new r({scopes:["https://www.googleapis.com/auth/cloud-platform"]}).getClient()).getAccessToken()).token||""}catch(r){throw console.error("Error getting access token:",r),new Error(`Failed to get access token for Vertex AI. Please ensure you have set up authentication using one of these methods:
1. Set GOOGLE_APPLICATION_CREDENTIALS to point to service account key file
2. Run "gcloud auth application-default login"
3. Use Google Cloud environment with default service account`)}}var na=class{name="vertex-claude";async transformRequestIn(e,t){let n=process.env.GOOGLE_CLOUD_PROJECT,s=process.env.GOOGLE_CLOUD_LOCATION||"us-east5";if(!n&&process.env.GOOGLE_APPLICATION_CREDENTIALS)try{let l=(await import("fs")).readFileSync(process.env.GOOGLE_APPLICATION_CREDENTIALS,"utf8"),f=JSON.parse(l);f&&f.project_id&&(n=f.project_id)}catch(u){console.error("Error extracting project_id from GOOGLE_APPLICATION_CREDENTIALS:",u)}if(!n)throw new Error("Project ID is required for Vertex AI. Set GOOGLE_CLOUD_PROJECT environment variable or ensure project_id is in GOOGLE_APPLICATION_CREDENTIALS file.");let a=await ow();return{body:ug(e),config:{url:new URL(`/v1/projects/${n}/locations/${s}/publishers/anthropic/models/${e.model}:${e.stream?"streamRawPredict":"rawPredict"}`,`https://${s}-aiplatform.googleapis.com`).toString(),headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}}}async transformRequestOut(e){return cg(e)}async transformResponseOut(e){return lg(e,this.name,this.logger)}};function Al(r){return typeof r=="string"?r:Array.isArray(r)?r.map(e=>typeof e=="string"?e:e.type==="text"&&e.text?e.text:"").join(""):""}var oa=class{name="cerebras";async transformRequestIn(e,t){let n=JSON.parse(JSON.stringify(e));return n.messages&&Array.isArray(n.messages)&&(n.messages=n.messages.map(s=>{let a={...s};return s.content!==void 0&&(a.content=Al(s.content)),s.role==="system"&&s.content!==void 0&&(a.content=Al(s.content)),a})),n.system!==void 0&&(n.system=Al(n.system)),{body:n,config:{headers:{Authorization:`Bearer ${t.apiKey}`,"Content-Type":"application/json"}}}}async transformResponseOut(e){return e}};var sa=class{name="streamoptions";async transformRequestIn(e){return e.stream&&(e.stream_options={include_usage:!0}),e}};var fg={AnthropicTransformer:Es,GeminiTransformer:Ss,VertexGeminiTransformer:Gi,VertexClaudeTransformer:na,DeepseekTransformer:Wi,TooluseTransformer:Ji,OpenrouterTransformer:zi,OpenAITransformer:Vi,MaxTokenTransformer:Ki,GroqTransformer:Yi,CleancacheTransformer:Xi,EnhanceToolTransformer:Zi,ReasoningTransformer:ea,SamplingTransformer:ta,MaxCompletionTokens:ra,CerebrasTransformer:oa,StreamOptionsTransformer:sa};var ia=class{constructor(e,t){this.configService=e;this.logger=t}transformers=new Map;registerTransformer(e,t){this.transformers.set(e,t),this.logger.info(`register transformer: ${e}${t.endPoint?` (endpoint: ${t.endPoint})`:" (no endpoint)"}`)}getTransformer(e){return this.transformers.get(e)}getAllTransformers(){return new Map(this.transformers)}getTransformersWithEndpoint(){let e=[];return this.transformers.forEach((t,n)=>{t.endPoint&&e.push({name:n,transformer:t})}),e}getTransformersWithoutEndpoint(){let e=[];return this.transformers.forEach((t,n)=>{t.endPoint||e.push({name:n,transformer:t})}),e}removeTransformer(e){return this.transformers.delete(e)}hasTransformer(e){return this.transformers.has(e)}async registerTransformerFromConfig(e){try{if(e.path){let t=X(X.resolve(e.path));if(t){let n=new t(e.options);if(n&&typeof n=="object"&&(n.logger=this.logger),!n.name)throw new Error(`Transformer instance from ${e.path} does not have a name property.`);return this.registerTransformer(n.name,n),!0}}return!1}catch(t){return this.logger.error(`load transformer (${e.path}) 
error: ${t.message}
stack: ${t.stack}`),!1}}async initialize(){try{await this.registerDefaultTransformersInternal(),await this.loadFromConfig()}catch(e){this.logger.error(`TransformerService init error: ${e.message}
Stack: ${e.stack}`)}}async registerDefaultTransformersInternal(){try{Object.values(fg).forEach(e=>{if("TransformerName"in e&&typeof e.TransformerName=="string")this.registerTransformer(e.TransformerName,e);else{let t=new e;t&&typeof t=="object"&&(t.logger=this.logger),this.registerTransformer(t.name,t)}})}catch(e){this.logger.error({error:e},"transformer regist error:")}}async loadFromConfig(){let e=this.configService.get("transformers",[]);for(let t of e)await this.registerTransformerFromConfig(t)}};function aw(r){let e=sw({bodyLimit:52428800,logger:r});return e.setErrorHandler(Mf),e.register(iw),e}var wl=class{app;configService;llmService;providerService;transformerService;constructor(e={}){this.app=aw(e.logger??!0),this.configService=new gs(e),this.transformerService=new ia(this.configService,this.app.log),this.transformerService.initialize().finally(()=>{this.providerService=new _s(this.configService,this.transformerService,this.app.log),this.llmService=new ys(this.providerService)})}async register(e,t){await this.app.register(e,t)}addHook(e,t){this.app.addHook(e,t)}async start(){try{this.app._server=this,this.app.addHook("preHandler",(n,s,a)=>{n.body&&(n.log.info({body:n.body},"request body"),n.body.stream,n.body.stream||(n.body.stream=!1)),a()}),this.app.addHook("preHandler",async(n,s)=>{if(!(n.url.startsWith("/api")||n.method!=="POST"))try{let a=n.body;if(!a||!a.model)return s.code(400).send({error:"Missing model in request body"});let[u,l]=a.model.split(",");a.model=l,n.provider=u;return}catch(a){return n.log.error("Error in modelProviderMiddleware:",a),s.code(500).send({error:"Internal server error"})}}),this.app.register(Gf);let e=await this.app.listen({port:parseInt(this.configService.get("PORT")||"3000",10),host:this.configService.get("HOST")||"127.0.0.1"});this.app.log.info(`\u{1F680} LLMs API server listening on ${e}`);let t=async n=>{this.app.log.info(`Received ${n}, shutting down gracefully...`),await this.app.close(),process.exit(0)};process.on("SIGINT",()=>t("SIGINT")),process.on("SIGTERM",()=>t("SIGTERM"))}catch(e){this.app.log.error(`Error starting server: ${e}`),process.exit(1)}}},aR=wl;export{aR as default};
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

gtoken/build/cjs/src/index.cjs:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)
*/
//# sourceMappingURL=server.mjs.map
